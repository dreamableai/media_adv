/*! For license information please see mediadc-node_modules_moment_locale_sync_recursive_-src_views_CollectorDetails_vue.js.LICENSE.txt */
(self.webpackChunkmediadc=self.webpackChunkmediadc||[]).push([["node_modules_moment_locale_sync_recursive_-src_views_CollectorDetails_vue"],{84440:(e,n,i)=>{"use strict";i.d(n,{Z:()=>l});var s=i(88982),a=i(30381),r=i.n(a),o=[t("mediadc","Photos"),t("mediadc","Videos"),t("mediadc","Photos&Videos")];const l={methods:{formatBytes:s.td,parseUnixTimestamp:function(t){return r().unix(Number(t)).format("YYYY-MM-DD HH:mm:ss")},getStatusBadge:function(t){return null==t?"":""!==t.errors?"error":0===Number(t.py_pid)&&0===Number(t.finished_time)&&Number(t.updated_time)>0&&Number(t.files_scanned)>0?"terminated":Number(t.py_pid)>0?r()().unix()>Number(t.updated_time)+24?"error":"running":Number(t.finished_time)>0&&0===Number(t.py_pid)?"finished":"pending"},parseTargetMtype:function(t){if(t)try{return o[Number(JSON.parse(t.collector_settings).target_mtype)]}catch(t){return""}return""}}}},88982:(t,e,n)=>{"use strict";n.d(e,{zW:()=>l,WU:()=>o,td:()=>d});var i=n(79753),s=n(22200),a=n(4820);function r(t,e,n,i,s,a,r){try{var o=t[a](r),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,s)}var o=function(t){return window.DOMParser?(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("oc:fileid")[0].innerHTML:-1},l=function(){var t,e=(t=regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat((0,i.generateRemoteUrl)("dav"),"/files/").concat((0,s.getCurrentUser)().uid).concat(e),t.next=3,(0,a.default)({method:"PROPFIND",url:n,data:'<?xml version="1.0"?>\n\t<d:propfind xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns"\n\t\t\t\txmlns:nc="http://nextcloud.org/ns"\n\t\t\t\txmlns:ocs="http://open-collaboration-services.org/ns">\n\t\t<d:prop>\n\t\t\t<oc:fileid />\n\t\t\t<d:getcontenttype />\n\t\t</d:prop>\n\t</d:propfind>',headers:{details:!0,depth:0}});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function o(t){r(a,i,s,o,l,"next",t)}function l(t){r(a,i,s,o,l,"throw",t)}o(void 0)}))});return function(t){return e.apply(this,arguments)}}(),d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 B";var n=1024,i=e<0?0:e,s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/Math.pow(n,a)).toFixed(i))+" "+s[a]}},75723:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(23645),s=n.n(i)()(!0);s.push([t.id,"\n.file-thumb[data-v-5ff2eb84] {\n\tdisplay: flex;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\nimg[data-v-5ff2eb84] {\n\twidth: 100%;\n\theight: auto;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n\tcursor: pointer;\n}\n.placeholder[data-v-5ff2eb84] {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcursor: pointer;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\nbody.theme--dark .placeholder[data-v-5ff2eb84] {\n\tbackground-color: #fff;\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsFile.vue"],names:[],mappings:";AA0HA;CACA,aAAA;CACA,2BAAA;CACA,4BAAA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,2BAAA;CACA,4BAAA;CACA,eAAA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,eAAA;CACA,2BAAA;CACA,4BAAA;AACA;AAEA;CACA,sBAAA;AACA",sourcesContent:['\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class="file-thumb" @click="openFile(file)">\n\t\t<div v-if="file.filempart === \'image\'" style="display: flex;">\n\t\t\t<img v-show="loaded"\n\t\t\t\t:key="file.filepath"\n\t\t\t\t:src="imageUrl"\n\t\t\t\t:alt="file.filename"\n\t\t\t\t:title="file.filepath"\n\t\t\t\t@load="onLoad">\n\t\t</div>\n\t\t<div v-show="!loaded && file.filempart === \'video\'"\n\t\t\tclass="placeholder"\n\t\t\t:style="\'min-height: \' + detailsGridSize + \'px\'"\n\t\t\t:title="file.filepath">\n\t\t\t<svg width="50%"\n\t\t\t\theight="50%"\n\t\t\t\tversion="1.1"\n\t\t\t\tviewBox="-31 0 512 512"\n\t\t\t\txmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m440.59 206.68h-341.17l327.7-94.93c2.5469-0.73828 4.6953-2.4609 5.9766-4.7812 1.2812-2.3242 1.5859-5.0586 0.84766-7.6055l-17.148-59.199c-6.8516-23.645-28.867-40.16-53.539-40.16-5.1992 0-10.379 0.73828-15.402 2.1914l-307.68 89.129c-14.23 4.1211-26.023 13.582-33.215 26.633-7.1875 13.051-8.875 28.078-4.7539 42.305l16.754 57.836v238.25c0 30.688 24.965 55.652 55.648 55.652h120.16c5.5234 0 10-4.4766 10-10s-4.4766-10-10-10h-120.16c-19.66 0-35.652-15.992-35.652-35.652v-136.09h391.63v136.09c2.1e-4 19.66-15.992 35.652-35.652 35.652h-120.16c-5.5195 0-10 4.4766-10 10s4.4805 10 10 10h120.16c30.688 0 55.652-24.965 55.652-55.652v-239.67c0-5.5234-4.4766-10-10-10zm-176.33 93.586 42.488-73.586h55.262l-42.484 73.586zm-78.359 0 42.488-73.586h55.262l-42.484 73.586zm-78.355 0 42.484-73.586h55.266l-42.488 73.586zm37.18-129.46-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543l71.148 68.336-53.309 15.441c-0.375-0.54688-0.81641-1.0664-1.3125-1.543zm134-125.84 71.148 68.336-53.309 15.441c-0.375-0.54688-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543zm-75.266 21.805 71.148 68.332-53.309 15.445c-0.375-0.54687-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.37891 0.54297 0.81641 1.0625 1.3125 1.543zm149.96-45.367c3.2109-0.92969 6.5195-1.4023 9.8359-1.4023 15.824 0 29.938 10.578 34.328 25.727l14.367 49.59-40.121 11.621c-0.3789-0.54688-0.8164-1.0625-1.3164-1.543l-71.145-68.332zm-328.94 106.2c4.6094-8.3711 12.16-14.434 21.262-17.07l5.875-1.7031c0.37891 0.54688 0.81641 1.0664 1.3125 1.543l71.148 68.336-88.293 25.578-14.367-49.59c-2.6367-9.0976-1.5469-18.719 3.0625-27.094zm14.48 99.074h87.973l-42.484 73.586h-45.488zm303.66 73.586 42.484-73.586h45.488v73.586z" />\n\t\t\t\t<path d="m303.92 405.11c0-3.5742-1.9062-6.875-5-8.6602l-87.855-50.723c-3.0938-1.7852-6.9062-1.7852-10 0-3.0938 1.7852-5 5.0859-5 8.6602v101.45c0 3.5703 1.9062 6.8711 5 8.6562 1.5469 0.89453 3.2734 1.3438 5 1.3438 1.7266 0 3.4531-0.44922 5-1.3438l87.855-50.719c3.0938-1.7852 5-5.0859 5-8.6602zm-87.855 33.402v-66.805l57.855 33.402z" />\n\t\t\t\t<path d="m234.77 492c-5.5078 0-10 4.4922-10 10s4.4922 10 10 10c5.5117 0 10-4.4922 10-10s-4.4883-10-10-10z" />\n\t\t\t</svg>\n\t\t</div>\n\t\t<div v-show="!loaded && file.filempart === \'image\'"\n\t\t\tclass="placeholder"\n\t\t\t:style="\'min-height: \' + detailsGridSize + \'px\'">\n\t\t\t<svg width="50%"\n\t\t\t\tenable-background="new 0 0 512 512"\n\t\t\t\tversion="1.1"\n\t\t\t\tviewBox="0 0 512 512"\n\t\t\t\txml:space="preserve"\n\t\t\t\txmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m446.58 0h-381.15c-36.076 0-65.425 29.35-65.425 65.426v381.15c0 36.075 29.349 65.425 65.425 65.425h381.15c36.076 0 65.425-29.35 65.425-65.426v-381.15c0-36.076-29.349-65.426-65.425-65.426zm35.267 446.58c0 19.447-15.821 35.267-35.267 35.267h-381.15c-19.447 0-35.268-15.821-35.268-35.267v-55.007l99.255-84.451c3.622-3.082 8.906-3.111 12.562-0.075l62.174 51.628c5.995 4.977 14.795 4.569 20.304-0.946l147.73-147.95c2.67-2.675 5.783-2.935 7.408-2.852 1.62 0.083 4.695 0.661 7.078 3.596l95.176 117.19v118.87zm0-166.71-71.766-88.366c-7.117-8.764-17.666-14.122-28.942-14.701-11.268-0.57-22.317 3.672-30.294 11.662l-138.01 138.22-51.59-42.839c-14.959-12.422-36.563-12.293-51.373 0.308l-79.712 67.822v-286.55c0-19.447 15.821-35.268 35.268-35.268h381.15c19.447 0 35.267 15.821 35.267 35.268v214.44z" />\n\t\t\t\t<path d="m161.17 62.995c-40.095 0-72.713 32.62-72.713 72.713 0 40.094 32.619 72.713 72.713 72.713s72.713-32.619 72.713-72.713-32.618-72.713-72.713-72.713zm0 115.27c-23.466 0-42.556-19.091-42.556-42.556 0-23.466 19.09-42.556 42.556-42.556s42.556 19.091 42.556 42.556-19.09 42.556-42.556 42.556z" />\n\t\t\t</svg>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { generateRemoteUrl } from \'@nextcloud/router\'\nimport { mapGetters } from \'vuex\'\nimport { getCurrentUser } from \'@nextcloud/auth\'\n\nexport default {\n\tname: \'DetailsFile\',\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloaded: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\timageUrl() {\n\t\t\treturn generateRemoteUrl(`dav/files${this.file.filepath.replace(\'files/\', \'\')}`)\n\t\t},\n\t\t...mapGetters([\n\t\t\t\'detailsGridSize\',\n\t\t]),\n\t},\n\tmethods: {\n\t\topenFile(file) {\n\t\t\tconst filesList = this.files.map(file => ({\n\t\t\t\tbasename: file.filename,\n\t\t\t\tfileid: file.fileid,\n\t\t\t\tfilename: file.filepath.replace(`/${getCurrentUser().uid}/files`, \'\'),\n\t\t\t\tgetcontentlength: file.filesize,\n\t\t\t\tgetcontenttype: file.filemtype,\n\t\t\t\tmime: file.filemtype,\n\t\t\t\tsize: file.filesize,\n\t\t\t}))\n\t\t\tOCA.Viewer.open({\n\t\t\t\tpath: file.filepath.replace(`/${getCurrentUser().uid}/files`, \'\'),\n\t\t\t\tlist: filesList.map(file => ({\n\t\t\t\t\t...file,\n\t\t\t\t\tlist: filesList,\n\t\t\t\t})),\n\t\t\t})\n\t\t},\n\t\tonLoad() {\n\t\t\tconsole.debug(\'[DetailsFile] loaded\')\n\t\t\tthis.loaded = true\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.file-thumb {\n\tdisplay: flex;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\n\nimg {\n\twidth: 100%;\n\theight: auto;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n\tcursor: pointer;\n}\n\n.placeholder {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcursor: pointer;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\n\nbody.theme--dark .placeholder {\n\tbackground-color: #fff;\n}\n</style>\n'],sourceRoot:""}]);const a=s},52605:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(23645),s=n.n(i)()(!0);s.push([t.id,"\n.details-group[data-v-4505d2f6] {\n\tborder-top: 1px solid #dadada;\n\tborder-bottom: 1px solid #dadada;\n\tmargin: 10px 0;\n}\nbody.theme--dark .details-group[data-v-4505d2f6] {\n\tborder-color: #717171;\n}\n.details-group-files[data-v-4505d2f6] {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: center;\n\tmax-height: 90vh;\n\toverflow-y: scroll;\n}\n.file[data-v-4505d2f6] {\n\tdisplay: flex;\n\theight: 100%;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\twidth: 192px;\n\tborder-radius: 5px;\n\tborder: 1px solid #dadada;\n\ttransition: box-shadow .3s;\n\tmargin: 10px;\n}\nbody.theme--dark .file[data-v-4505d2f6] {\n\tborder-color: #717171;\n}\n@media (max-width: 540px) {\n.file[data-v-4505d2f6] {\n\t\tmax-width: 192px;\n}\n.pagination[data-v-4505d2f6] {\n\t\ttext-align: center;\n}\n}\n.file[data-v-4505d2f6]:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .25);\n}\n.file-info[data-v-4505d2f6] {\n\twidth: 100%;\n\tpadding: 5px 10px;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tbackground-color: #000;\n\ttext-align: center;\n\tborder-bottom-left-radius: 5px;\n\tborder-bottom-right-radius: 5px;\n\tcolor: #fff;\n}\n.filename[data-v-4505d2f6] {\n\twidth: 100%;\n\toverflow-x: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n.delete-file-btn[data-v-4505d2f6] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tbackground-image: var(--icon-delete-fff);\n}\n.delete-file-btn[data-v-4505d2f6]:hover {\n\tbackground-color: #eee;\n}\n.delete-file-btn[data-v-4505d2f6]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .delete-file-btn[data-v-4505d2f6] {\n\tbackground-image: var(--icon-delete-000);\n}\n.delete-file-btn[data-v-4505d2f6]:hover, body.theme--dark .delete-file-btn[data-v-4505d2f6]:hover {\n\tbackground-image: var(--icon-delete-e9322d);\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsGroupList.vue"],names:[],mappings:";AA4FA;CACA,6BAAA;CACA,gCAAA;CACA,cAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,aAAA;CACA,eAAA;CACA,uBAAA;CACA,gBAAA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,YAAA;CACA,sBAAA;CACA,8BAAA;CACA,YAAA;CACA,kBAAA;CACA,yBAAA;CACA,0BAAA;CACA,YAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;AACA;EACA,gBAAA;AACA;AAEA;EACA,kBAAA;AACA;AACA;AAEA;CACA,yCAAA;AACA;AAEA;CACA,WAAA;CACA,iBAAA;CACA,aAAA;CACA,sBAAA;CACA,mBAAA;CACA,sBAAA;CACA,kBAAA;CACA,8BAAA;CACA,+BAAA;CACA,WAAA;AACA;AAEA;CACA,WAAA;CACA,kBAAA;CACA,uBAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,wCAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,wCAAA;AACA;AAEA;CACA,2CAAA;AACA",sourcesContent:['\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-if="!loadingFiles" class="details-group">\n\t\t<div class="details-group-files">\n\t\t\t<div v-for="file in files"\n\t\t\t\t:key="file.fileid"\n\t\t\t\tclass="file"\n\t\t\t\t:style="\'width: \' + detailsGridSize + \'px;\'">\n\t\t\t\t<DetailsFile :file="file" :files="files" />\n\t\t\t\t<div class="file-info">\n\t\t\t\t\t<span class="filename">{{ file.filename }}</span>\n\t\t\t\t\t<span class="owner">{{ file.fileowner }}</span>\n\t\t\t\t\t<span class="size">{{ formatBytes(Number(file.filesize)) }}</span>\n\t\t\t\t\t<span class="delete-file-btn icon-delete-white" @click="deleteGroupFile(file)" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div v-else>\n\t\t<span class="icon-loading" style="width: 20px; height: 20px; display: flex; margin: 20px auto;" />\n\t</div>\n</template>\n\n<script>\nimport axios from \'@nextcloud/axios\'\nimport { generateUrl } from \'@nextcloud/router\'\nimport Formats from \'../../mixins/Formats\'\nimport { mapGetters } from \'vuex\'\nimport DetailsFile from \'./DetailsFile\'\nimport { emit } from \'@nextcloud/event-bus\'\n\nexport default {\n\tname: \'DetailsGroupList\',\n\tcomponents: { DetailsFile },\n\tmixins: [Formats],\n\tprops: {\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tloadingFiles: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t\'detailsGridSize\',\n\t\t]),\n\t},\n\tmethods: {\n\t\tdeleteGroupFile(file) {\n\t\t\tif (confirm(t(\'mediadc\', \'Are you sure, you want delete this file?\'))) {\n\t\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${file.taskId}/files/${file.detailId}/${file.fileid}`))\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\tconst files = this.files\n\t\t\t\t\t\tconst fileidIndex = files.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\t\tfiles.splice(fileidIndex, 1)\n\t\t\t\t\t\tthis.$emit(\'update:files\', files)\n\t\t\t\t\t\temit(\'updateTaskInfo\')\n\t\t\t\t\t\tthis.$store.dispatch(\'setTask\', res.data.task)\n\t\t\t\t\t})\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.details-group {\n\tborder-top: 1px solid #dadada;\n\tborder-bottom: 1px solid #dadada;\n\tmargin: 10px 0;\n}\n\nbody.theme--dark .details-group {\n\tborder-color: #717171;\n}\n\n.details-group-files {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: center;\n\tmax-height: 90vh;\n\toverflow-y: scroll;\n}\n\n.file {\n\tdisplay: flex;\n\theight: 100%;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\twidth: 192px;\n\tborder-radius: 5px;\n\tborder: 1px solid #dadada;\n\ttransition: box-shadow .3s;\n\tmargin: 10px;\n}\n\nbody.theme--dark .file {\n\tborder-color: #717171;\n}\n\n@media (max-width: 540px) {\n\t.file {\n\t\tmax-width: 192px;\n\t}\n\n\t.pagination {\n\t\ttext-align: center;\n\t}\n}\n\n.file:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .25);\n}\n\n.file-info {\n\twidth: 100%;\n\tpadding: 5px 10px;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tbackground-color: #000;\n\ttext-align: center;\n\tborder-bottom-left-radius: 5px;\n\tborder-bottom-right-radius: 5px;\n\tcolor: #fff;\n}\n\n.filename {\n\twidth: 100%;\n\toverflow-x: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.delete-file-btn {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tbackground-image: var(--icon-delete-fff);\n}\n\n.delete-file-btn:hover {\n\tbackground-color: #eee;\n}\n\n.delete-file-btn:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .delete-file-btn {\n\tbackground-image: var(--icon-delete-000);\n}\n\n.delete-file-btn:hover, body.theme--dark .delete-file-btn:hover {\n\tbackground-image: var(--icon-delete-e9322d);\n}\n</style>\n'],sourceRoot:""}]);const a=s},17157:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(23645),s=n.n(i)()(!0);s.push([t.id,"\n.task-details[data-v-7f69bd38] {\n\twidth: 100%;\n\tpadding: 10px 20px 20px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n\tmargin: 0 auto;\n}\n.task-details-heading[data-v-7f69bd38] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n@media (max-width: 540px) {\n.task-details-heading[data-v-7f69bd38] {\n\t\tflex-direction: column;\n\t\ttext-align: center;\n}\n}\n.pagination[data-v-7f69bd38] {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin: 10px 0;\n}\n.pagination-button[data-v-7f69bd38] {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n.sorting[data-v-7f69bd38] {\n\tdisplay: flex;\n}\n.toggle-sorting-button[data-v-7f69bd38] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n\tcursor: pointer;\n}\n.pagination-button[data-v-7f69bd38]:hover, .toggle-sorting-button[data-v-7f69bd38]:hover {\n\tbackground-color: #eee;\n}\n.pagination-button[data-v-7f69bd38]:active, .toggle-sorting-button[data-v-7f69bd38]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .pagination-button[data-v-7f69bd38]:hover, body.theme--dark .toggle-sorting-button[data-v-7f69bd38]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .pagination-button[data-v-7f69bd38]:active, body.theme--dark .toggle-sorting-button[data-v-7f69bd38]:active {\n\tbackground-color: #5b5b5b;\n}\nbody.theme--dark .task-details[data-v-7f69bd38] {\n\tborder-color: #717171;\n}\n.task-details-row[data-v-7f69bd38] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tborder: 1px solid #dedede;\n\tborder-radius: 5px;\n\tmargin-bottom: 5px;\n\ttransition: height .3s;\n}\nbody.theme--dark .task-details-row[data-v-7f69bd38] {\n\tborder-color: #717171;\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsList.vue"],names:[],mappings:";AAsHA;CACA,WAAA;CACA,uBAAA;CACA,yBAAA;CACA,kBAAA;CACA,iBAAA;CACA,kBAAA;CACA,cAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;AACA;AAEA;AACA;EACA,sBAAA;EACA,kBAAA;AACA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,cAAA;AACA;AAEA;CACA,aAAA;CACA,aAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,kBAAA;CACA,iBAAA;AACA;AAEA;CACA,aAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,iBAAA;CACA,eAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,yBAAA;CACA,kBAAA;CACA,kBAAA;CACA,sBAAA;AACA;AAEA;CACA,qBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class=\"task-details\">\n\t\t<div class=\"task-details-heading\">\n\t\t\t<h3>\n\t\t\t\t{{ t('mediadc', 'Duplicates list') }}\n\t\t\t\t<span v-if=\"getStatusBadge(task) === 'finished'\">\n\t\t\t\t\t- {{ details.length }} {{ t('mediadc', 'group(s)') }}\n\t\t\t\t\t({{ filestotal }} {{ t('mediadc', 'file(s)') }} - {{ formatBytes(filessize) }})\n\t\t\t\t</span>\n\t\t\t</h3>\n\t\t\t<div v-if=\"details.length > itemsPerPage\" class=\"pagination\">\n\t\t\t\t<span :class=\"!sorted ? 'icon-triangle-s toggle-sorting-button' : 'icon-triangle-n toggle-sorting-button'\" @click=\"toggleSorting\" />\n\t\t\t\t<span class=\"icon-view-previous pagination-button\"\n\t\t\t\t\t@click=\"prevGroupsPage()\" />\n\t\t\t\t<span>{{ t('mediadc', 'Page:') }}&nbsp;</span>\n\t\t\t\t<span>{{ page + 1 }}/{{ Math.ceil(details.length / itemsPerPage) }}</span>\n\t\t\t\t<span class=\"icon-view-next pagination-button\"\n\t\t\t\t\t@click=\"nextGroupsPage()\" />\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"details.length > 0\">\n\t\t\t<div v-for=\"detail in paginatedDetails[page]\"\n\t\t\t\tv-show=\"JSON.parse(detail.group_files_ids).length > 1\"\n\t\t\t\t:key=\"detail.id\"\n\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t<DetailsListItem :detail=\"detail\" />\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else>\n\t\t\t<strong>{{ t('mediadc', 'No duplicates found.') }}</strong>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { showWarning } from '@nextcloud/dialogs'\nimport { mapGetters } from 'vuex'\nimport Formats from '../../mixins/Formats'\nimport DetailsListItem from './DetailsListItem'\n\nexport default {\n\tname: 'DetailsList',\n\tcomponents: { DetailsListItem },\n\tmixins: [Formats],\n\tprops: {\n\t\tfilessize: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tfilestotal: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tpage: 0,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'details',\n\t\t\t'sorted',\n\t\t\t'paginatedDetails',\n\t\t\t'itemsPerPage',\n\t\t]),\n\t},\n\tbeforeMount() {\n\t\tthis.$emit('update:loading', false)\n\t},\n\tmethods: {\n\t\tprevGroupsPage() {\n\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page -= 1\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'First page reached!'))\n\t\t\t}\n\t\t},\n\t\tnextGroupsPage() {\n\t\t\tif (this.page < Math.ceil(this.details.length / this.itemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'Last page reached!'))\n\t\t\t}\n\t\t},\n\t\ttoggleSorting() {\n\t\t\tthis.$store.dispatch('setSorted', !this.sorted)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.task-details {\n\twidth: 100%;\n\tpadding: 10px 20px 20px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n\tmargin: 0 auto;\n}\n\n.task-details-heading {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n@media (max-width: 540px) {\n\t.task-details-heading {\n\t\tflex-direction: column;\n\t\ttext-align: center;\n\t}\n}\n\n.pagination {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin: 10px 0;\n}\n\n.pagination-button {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n\n.sorting {\n\tdisplay: flex;\n}\n\n.toggle-sorting-button {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n\tcursor: pointer;\n}\n\n.pagination-button:hover, .toggle-sorting-button:hover {\n\tbackground-color: #eee;\n}\n\n.pagination-button:active, .toggle-sorting-button:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .pagination-button:hover, body.theme--dark .toggle-sorting-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .pagination-button:active, body.theme--dark .toggle-sorting-button:active {\n\tbackground-color: #5b5b5b;\n}\n\nbody.theme--dark .task-details {\n\tborder-color: #717171;\n}\n\n.task-details-row {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tborder: 1px solid #dedede;\n\tborder-radius: 5px;\n\tmargin-bottom: 5px;\n\ttransition: height .3s;\n}\n\nbody.theme--dark .task-details-row {\n\tborder-color: #717171;\n}\n</style>\n"],sourceRoot:""}]);const a=s},1660:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(23645),s=n.n(i)()(!0);s.push([t.id,"\n.details-list-item[data-v-e647c532] {\n\twidth: 100%;\n\tpadding: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tflex-direction: column;\n}\n.details-list-item-title[data-v-e647c532] {\n\tdisplay: flex;\n\talign-items: center;\n}\n.details-list-item-title .group-info[data-v-e647c532] {\n\tcursor: pointer;\n}\n.details-list-item-title .group-info[data-v-e647c532]:hover {\n\ttext-decoration: underline;\n}\n.pagination[data-v-e647c532] {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin: 10px 0;\n}\n.pagination-button[data-v-e647c532] {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n.pagination-button[data-v-e647c532]:hover {\n\tbackground-color: #eee;\n}\n.pagination-button[data-v-e647c532]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .pagination-button[data-v-e647c532]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .pagination-button[data-v-e647c532]:active {\n\tbackground-color: #5b5b5b;\n}\n.open-details-btn[data-v-e647c532] {\n\tdisplay: inline-flex;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 10px;\n}\n.delete-group-btn[data-v-e647c532] {\n\tvisibility: hidden;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n@media (max-width: 540px) {\n.delete-group-btn[data-v-e647c532] {\n\t\tvisibility: visible;\n}\n}\n.details-list-item:hover .delete-group-btn[data-v-e647c532] {\n\tvisibility: visible;\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsListItem.vue"],names:[],mappings:";AAwKA;CACA,WAAA;CACA,aAAA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,sBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;CACA,eAAA;AACA;AAEA;CACA,0BAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,cAAA;AACA;AAEA;CACA,aAAA;CACA,aAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,kBAAA;CACA,iBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,oBAAA;CACA,WAAA;CACA,YAAA;CACA,cAAA;AACA;AAEA;CACA,kBAAA;CACA,eAAA;CACA,cAAA;AACA;AAEA;AACA;EACA,mBAAA;AACA;AACA;AAEA;CACA,mBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class=\"details-list-item\">\n\t\t<div class=\"details-list-item-title\">\n\t\t\t<span class=\"icon-projects\" style=\"margin: 0 10px 0 0;\" />\n\t\t\t<span class=\"group-info\" @click=\"openDetailFiles(detail)\">\n\t\t\t\t{{ t('mediadc', 'Duplicate group') }} #{{ detail.id }} ({{ JSON.parse(detail.group_files_ids).length }}\n\t\t\t\t{{ t('mediadc', 'file(s)') }}{{ files.length > 0 ? ' - ' + formatBytes(getGroupFilesSize(files)) : '' }})\n\t\t\t</span>\n\t\t\t<span :class=\"!opened ? 'icon-triangle-s open-details-btn' : 'icon-triangle-n open-details-btn'\" />\n\t\t\t<span class=\"icon-delete delete-group-btn\" @click=\"deleteTaskDetail(detail)\" />\n\t\t</div>\n\t\t<div v-if=\"opened && JSON.parse(detail.group_files_ids).length > itemsPerPage\" class=\"pagination\">\n\t\t\t<span class=\"icon-view-previous pagination-button\"\n\t\t\t\t@click=\"openPrevDetailFiles(detail)\" />\n\t\t\t<span>{{ t('mediadc', 'Page:') }}&nbsp;</span>\n\t\t\t<span>{{ page + 1 }}/{{ Math.ceil(JSON.parse(detail.group_files_ids).length / itemsPerPage) }}</span>\n\t\t\t<span class=\"icon-view-next pagination-button\"\n\t\t\t\t@click=\"openNextDetailFiles(detail)\" />\n\t\t</div>\n\t\t<DetailsGroupList v-show=\"opened\" :files=\"files\" :loading-files=\"loadingFiles\" />\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport DetailsGroupList from './DetailsGroupList'\nimport Formats from '../../mixins/Formats'\nimport { mapGetters } from 'vuex'\nimport { showError, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { emit } from '@nextcloud/event-bus'\n\nexport default {\n\tname: 'DetailsListItem',\n\tcomponents: { DetailsGroupList },\n\tmixins: [Formats],\n\tprops: {\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\topened: false,\n\t\t\tpage: 0,\n\t\t\ttotalPages: 0,\n\t\t\titemsPerPage: 10,\n\t\t\tloadingFiles: false,\n\t\t\tfiles: [],\n\t\t\tpaginatedFiles: {},\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'details',\n\t\t]),\n\t},\n\tmethods: {\n\t\topenDetailFiles(detail) {\n\t\t\tif (!this.opened) {\n\t\t\t\tif (this.files.length === 0) {\n\t\t\t\t\tconst taskId = detail.task_id\n\t\t\t\t\tconst detailId = detail.id\n\t\t\t\t\tthis.loadingFiles = true\n\t\t\t\t\tthis.opened = true\n\t\t\t\t\tif (!(this.page in this.paginatedFiles)) {\n\t\t\t\t\t\tthis.loadFilesInfo(taskId, detailId)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\t\t\tthis.loadingFiles = false\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.opened = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.opened = false\n\t\t\t}\n\t\t},\n\t\topenNextDetailFiles(detail) {\n\t\t\tif (this.page < Math.ceil(JSON.parse(detail.group_files_ids).length / this.itemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t\tconst taskId = detail.task_id\n\t\t\t\tconst detailId = detail.id\n\t\t\t\tthis.loadingFiles = true\n\t\t\t\tif (!(this.page in this.paginatedFiles)) {\n\t\t\t\t\tthis.loadFilesInfo(taskId, detailId)\n\t\t\t\t} else {\n\t\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\t\tthis.loadingFiles = false\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'Last page reached!'))\n\t\t\t}\n\t\t},\n\t\topenPrevDetailFiles(detail) {\n\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page -= 1\n\t\t\t\tconst taskId = detail.task_id\n\t\t\t\tconst detailId = detail.id\n\t\t\t\tthis.loadingFiles = true\n\t\t\t\tif (!(this.page in this.paginatedFiles)) {\n\t\t\t\t\tthis.loadFilesInfo(taskId, detailId)\n\t\t\t\t} else {\n\t\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\t\tthis.loadingFiles = false\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'First page reached!'))\n\t\t\t}\n\t\t},\n\t\tloadFilesInfo(taskId, detailId) {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${taskId}/files/${detailId}?limit=${this.itemsPerPage}&page=${this.page}`)).then(res => {\n\t\t\t\tthis.paginatedFiles[this.page] = res.data.map(file => ({\n\t\t\t\t\t...file,\n\t\t\t\t\ttaskId,\n\t\t\t\t\tdetailId,\n\t\t\t\t}))\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\tthis.loadingFiles = false\n\t\t\t})\n\t\t},\n\t\tgetGroupFilesSize(groupFiles) {\n\t\t\treturn groupFiles.reduce((sum, file) => sum + file.filesize, 0)\n\t\t},\n\t\tdeleteTaskDetail(detail) {\n\t\t\tif (confirm(t('mediadc', 'Are you sure, you want remove this group without deleting files?'))) {\n\t\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${detail.task_id}/detail/${detail.id}`)).then(res => {\n\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\tthis.$store.dispatch('deleteDetail', detail)\n\t\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\t\tshowSuccess(t('mediadc', 'Duplicate group succesffully removed'))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowError(t('mediadc', 'Some error occured while deleting duplicate group'))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.details-list-item {\n\twidth: 100%;\n\tpadding: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tflex-direction: column;\n}\n\n.details-list-item-title {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.details-list-item-title .group-info {\n\tcursor: pointer;\n}\n\n.details-list-item-title .group-info:hover {\n\ttext-decoration: underline;\n}\n\n.pagination {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin: 10px 0;\n}\n\n.pagination-button {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n\n.pagination-button:hover {\n\tbackground-color: #eee;\n}\n\n.pagination-button:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .pagination-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .pagination-button:active {\n\tbackground-color: #5b5b5b;\n}\n\n.open-details-btn {\n\tdisplay: inline-flex;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 10px;\n}\n\n.delete-group-btn {\n\tvisibility: hidden;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n\n@media (max-width: 540px) {\n\t.delete-group-btn {\n\t\tvisibility: visible;\n\t}\n}\n\n.details-list-item:hover .delete-group-btn {\n\tvisibility: visible;\n}\n</style>\n"],sourceRoot:""}]);const a=s},37032:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(23645),s=n.n(i)()(!0);s.push([t.id,"\n.blackout[data-v-4aff1f56] {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.3);\n\tz-index: 999;\n}\n.edit-task-block[data-v-4aff1f56] {\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tbox-shadow: 0 0 4px 0 rgba(0, 0, 0, .05);\n\tpadding: 20px;\n\twidth: 100%;\n\tmax-width: 600px;\n\tposition: absolute;\n\tbackground-color: #fff;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n}\n.selection-container[data-v-4aff1f56] {\n\twidth: 100%;\n\tdisplay: flex;\n}\n@media (max-width: 767px) {\n.selection-container[data-v-4aff1f56] {\n\t\tflex-wrap: wrap;\n}\n}\n@media (max-width: 540px) {\n.edit-task-block[data-v-4aff1f56] {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(50% + calc(100% - 96vh));\n}\n}\n.block[data-v-4aff1f56] {\n\twidth: 100%;\n\theight: 100%;\n\tmax-height: 200px;\n\toverflow-y: scroll;\n\tpadding: 10px 15px;\n\tmargin: 5px 10px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\n.block[data-v-4aff1f56]:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .05)\n}\n.target-directory[data-v-4aff1f56], .custom-mask[data-v-4aff1f56] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 0;\n\tborder-bottom: 1px solid #dadada;\n}\n.delete-button[data-v-4aff1f56] {\n\tdisplay: inline-flex;\n\twidth: 15px;\n\theight: 15px;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n.close-edit-button[data-v-4aff1f56] {\n\tposition: absolute;\n\ttop: 15px;\n\tright: 15px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\topacity: 0.5;\n}\n.close-edit-button[data-v-4aff1f56]:hover, .close-edit-button[data-v-4aff1f56]:active {\n\topacity: 1;\n}\nbody.theme--dark .actions-menu-button[data-v-4aff1f56]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .close-edit-button[data-v-4aff1f56]:active {\n\tbackground-color: #5b5b5b;\n}\nbody.theme--dark .edit-task-block[data-v-4aff1f56], body.theme--dark .block[data-v-4aff1f56] {\n\tborder-color: #717171;\n}\nbody.theme--dark .edit-task-block[data-v-4aff1f56] {\n\tbackground-color: #111;\n}\n","",{version:3,sources:["webpack://src/components/tasks/TasksEdit.vue"],names:[],mappings:";AA0XA;CACA,eAAA;CACA,MAAA;CACA,OAAA;CACA,QAAA;CACA,SAAA;CACA,oCAAA;CACA,YAAA;AACA;AAEA;CACA,yBAAA;CACA,kBAAA;CACA,wCAAA;CACA,aAAA;CACA,WAAA;CACA,gBAAA;CACA,kBAAA;CACA,sBAAA;CACA,QAAA;CACA,SAAA;CACA,gCAAA;AACA;AAEA;CACA,WAAA;CACA,aAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;AAEA;AACA;EACA,WAAA;EACA,YAAA;EACA,kBAAA;EACA,kCAAA;AACA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,iBAAA;CACA,kBAAA;CACA,kBAAA;CACA,gBAAA;CACA,yBAAA;CACA,kBAAA;AACA;AAEA;CACA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,cAAA;CACA,gCAAA;AACA;AAEA;CACA,oBAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,cAAA;AACA;AAEA;CACA,kBAAA;CACA,SAAA;CACA,WAAA;CACA,aAAA;CACA,kBAAA;CACA,eAAA;CACA,YAAA;AACA;AAEA;CACA,UAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,sBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-show=\"opened\" class=\"blackout\">\n\t\t<div class=\"edit-task-block\">\n\t\t\t<span class=\"icon-close close-edit-button\" @click=\"closeEditTaskDialog\" />\n\t\t\t<h2>{{ t('mediadc', 'Edit task') }}</h2>\n\t\t\t<div class=\"selection-container\">\n\t\t\t\t<div class=\"block target-directories-block\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Target directories') }}</h3>\n\t\t\t\t\t<div v-if=\"targetDirectoriesIds.length > 0\">\n\t\t\t\t\t\t<div v-for=\"fileid in targetDirectoriesIds\" :key=\"fileid\" class=\"selected-target-directories-list\">\n\t\t\t\t\t\t\t<div class=\"target-directory\">\n\t\t\t\t\t\t\t\t<span style=\"overflow-y: scroll; white-space: nowrap;\">{{ targetDirectoriesPaths[fileid] }}</span>\n\t\t\t\t\t\t\t\t<span class=\"delete-button icon-delete\" @click=\"removeTargetDirectory(fileid)\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<span>{{ t('mediadc', 'Not selected') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br>\n\t\t\t\t\t<button @click=\"openDirectoriesExplorer\">\n\t\t\t\t\t\t<span class=\"icon-add\" />\n\t\t\t\t\t\t{{ t('mediadc', 'Select') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"block\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Exclude directories') }}</h3>\n\t\t\t\t\t<div v-if=\"excludeDirectoriesPaths.length > 0\">\n\t\t\t\t\t\t<div v-for=\"fileid in Object.keys(excludeFileIds)\" :key=\"fileid\" class=\"selected-excluded-directories-list\">\n\t\t\t\t\t\t\t<div class=\"target-directory\">\n\t\t\t\t\t\t\t\t<span style=\"overflow-y: scroll;\">{{ excludeFileIds[fileid] }}</span>\n\t\t\t\t\t\t\t\t<span class=\"delete-button icon-delete\" @click=\"removeExcludeDirectory(fileid)\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<span>{{ t('mediadc', 'Not selected') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br>\n\t\t\t\t\t<button @click=\"openExcludeExplorer\">\n\t\t\t\t\t\t<span class=\"icon-add\" />\n\t\t\t\t\t\t{{ t('mediadc', 'Select') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"selection-container\">\n\t\t\t\t<div class=\"block\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Custom exclude mask') }}</h3>\n\t\t\t\t\t<div v-if=\"customExcludeList.length > 0\" class=\"custom-masks-list\">\n\t\t\t\t\t\t<div v-for=\"(mask, index) in customExcludeList\" :key=\"index\" class=\"custom-mask\">\n\t\t\t\t\t\t\t<span>{{ mask }}</span>\n\t\t\t\t\t\t\t<span class=\"icon-delete\" style=\"cursor: pointer;\" @click=\"deleteCustomMask(mask)\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<span>{{ t('mediadc', 'Not added') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"addingCustomMask\" style=\"display: flex; align-items: center;\">\n\t\t\t\t\t\t<input id=\"custom-exclude-mask\"\n\t\t\t\t\t\t\tref=\"customExcludeMask\"\n\t\t\t\t\t\t\tv-model=\"customExcludeMask\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t@keyup.enter=\"addCustomMask\"\n\t\t\t\t\t\t\t@keyup.esc=\"cancelAddingCustomMask\">\n\t\t\t\t\t\t<span class=\"icon-checkmark\" style=\"width: 18px; height: 18px; margin: 0 5px; display: inline-block; cursor: pointer;\" @click=\"addCustomMask\" />\n\t\t\t\t\t\t<span class=\"icon-close\" style=\"width: 18px; height: 18px; margin: 0 5px; display: inline-block; cursor: pointer;\" @click=\"cancelAddingCustomMask\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style=\"display: flex; align-items: center; margin: 20px 0;\">\n\t\t\t\t\t\t<button @click=\"addNewMask\">\n\t\t\t\t\t\t\t<span class=\"icon-add\" />\n\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Add mask') }}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"block\">\n\t\t\t\t\t<h3 style=\"margin: 5px 0;\">\n\t\t\t\t\t\t{{ t('mediadc', 'Target Mime Type') }}\n\t\t\t\t\t</h3>\n\t\t\t\t\t<select id=\"target_mtype\"\n\t\t\t\t\t\tv-model=\"targetMimeType\"\n\t\t\t\t\t\tname=\"target_mtype\">\n\t\t\t\t\t\t<option :value=\"0\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Photos') }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option :value=\"1\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Videos') }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option :value=\"2\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Photos and Videos') }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<h3 style=\"margin: 5px 0;\">\n\t\t\t\t\t\t{{ t('mediadc', 'Similarity threshold') }}\n\t\t\t\t\t</h3>\n\t\t\t\t\t<input v-model=\"similarity_threshold\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tmin=\"50\"\n\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\tstyle=\"margin: 0 0 10px;\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button v-if=\"!runningTask\"\n\t\t\t\tstyle=\"margin: 10px 5px 0\"\n\t\t\t\t:disabled=\"Object.keys(targetDirectoriesPaths).length === 0\"\n\t\t\t\t@click=\"restartTask\">\n\t\t\t\t{{ t('mediadc', 'Restart task') }}\n\t\t\t</button>\n\t\t\t<button v-else disabled>\n\t\t\t\t<span class=\"icon-loading\" />\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { generateUrl } from '@nextcloud/router'\nimport { getFilePickerBuilder, showWarning, showSuccess } from '@nextcloud/dialogs'\nimport axios from '@nextcloud/axios'\nimport { requestFileInfo, getFileId } from '../../utils/files'\nimport { mapGetters } from 'vuex'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { emit } from '@nextcloud/event-bus'\n\nexport default {\n\tname: 'TasksEdit',\n\tprops: {\n\t\topened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\ttargetDirectoriesPaths: {},\n\t\t\ttargetDirectoriesIds: [],\n\t\t\texcludeDirectoriesPaths: [],\n\t\t\texcludeFileIds: {},\n\t\t\ttargetMimeType: 0,\n\t\t\tsimilarity_threshold: 90,\n\t\t\tcustomExcludeList: [],\n\t\t\tcustomExcludeMask: '',\n\t\t\taddingCustomMask: false,\n\t\t\trunningTask: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'settings',\n\t\t\t'settingByName',\n\t\t\t'tasks',\n\t\t\t'task',\n\t\t\t'taskInfo',\n\t\t]),\n\t},\n\tbeforeMount() {\n\t\tthis.similarity_threshold = this.settingByName('similarity_threshold') !== undefined\n\t\t\t? this.settingByName('similarity_threshold').value\n\t\t\t: 90\n\t\tthis.targetMimeType = JSON.parse(this.task.collector_settings).target_mtype\n\t\tthis.similarity_threshold = JSON.parse(this.task.collector_settings).similarity_threshold\n\t\tthis.parseTaskSettings()\n\t},\n\tmethods: {\n\t\tparseTaskSettings() {\n\t\t\tif (this.taskInfo !== null && 'target_directories' in this.taskInfo) {\n\t\t\t\tthis.taskInfo.target_directories.forEach(dir => {\n\t\t\t\t\tthis.targetDirectoriesIds.push(dir.fileid.toString())\n\t\t\t\t\tthis.targetDirectoriesPaths[dir.fileid.toString()] = dir.filepath.replace(`/${getCurrentUser().uid}/files`, '')\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (this.taskInfo !== null && 'exclude_directories' in this.taskInfo) {\n\t\t\t\tthis.taskInfo.exclude_directories.forEach(dir => {\n\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir.filepath.replace())\n\t\t\t\t\tthis.excludeFileIds[dir.fileid.toString()] = dir.filepath.replace(`/${getCurrentUser().uid}/files`, '')\n\t\t\t\t})\n\t\t\t\tthis.customExcludeList = JSON.parse(this.task.exclude_list).user.mask\n\t\t\t}\n\t\t},\n\t\tgetDirectoriesPicker(title) {\n\t\t\treturn getFilePickerBuilder(title)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.addMimeTypeFilter('httpd/unix-directory')\n\t\t\t\t.setModal(true)\n\t\t\t\t.setType(1)\n\t\t\t\t.allowDirectories(true)\n\t\t\t\t.build()\n\t\t},\n\t\tgetFilesPicker(title) {\n\t\t\treturn getFilePickerBuilder(title)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.setModal(true)\n\t\t\t\t.setType(1)\n\t\t\t\t.allowDirectories(true)\n\t\t\t\t.build()\n\t\t},\n\t\topenDirectoriesExplorer() {\n\t\t\tthis.getDirectoriesPicker(t('mediadc', 'Choose target directory')).pick().then(dir => {\n\t\t\t\tif (dir.startsWith('/')) {\n\t\t\t\t\trequestFileInfo(dir).then(res => {\n\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\tif (!(fileid in this.targetDirectoriesPaths)) {\n\t\t\t\t\t\t\t\tthis.targetDirectoriesIds.push(fileid)\n\t\t\t\t\t\t\t\tthis.targetDirectoriesPaths[fileid.toString()] = dir\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tshowWarning(t('mediadc', 'This directory already selected'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\trequestFileInfo('/').then(res => {\n\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\tif (!(fileid in this.targetDirectoriesPaths)) {\n\t\t\t\t\t\t\t\tthis.targetDirectoriesIds.push(fileid)\n\t\t\t\t\t\t\t\tthis.targetDirectoriesPaths[fileid.toString()] = '/'\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tshowWarning(t('mediadc', 'This directory already selected'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tthis.targetDirectoriesPaths.push('/')\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\topenExcludeExplorer() {\n\t\t\tthis.getDirectoriesPicker(t('mediadc', 'Choose directory to exclude')).pick().then(dir => {\n\t\t\t\tif (Object.values(this.excludeFileIds).findIndex(targetDir => targetDir === dir) === -1) {\n\t\t\t\t\tif (dir.startsWith('/')) {\n\t\t\t\t\t\trequestFileInfo(dir).then(res => {\n\t\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir)\n\t\t\t\t\t\t\t\tthis.excludeFileIds[fileid.toString()] = dir\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\trequestFileInfo('/').then(res => {\n\t\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir)\n\t\t\t\t\t\t\t\tthis.excludeFileIds[fileid.toString()] = '/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tshowWarning(t('mediadc', 'This directory already excluded'))\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\trestartTask() {\n\t\t\tthis.runningTask = true\n\t\t\tthis.getSettings().then(res => {\n\t\t\t\tthis.$store.dispatch('setSettings', res.data)\n\t\t\t\taxios.post(generateUrl('/apps/mediadc/api/v1/tasks/restart'), {\n\t\t\t\t\ttaskId: this.task.id,\n\t\t\t\t\ttargetDirectoryIds: JSON.stringify(this.targetDirectoriesIds),\n\t\t\t\t\texcludeList: {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tmask: this.customExcludeList,\n\t\t\t\t\t\t\tfileid: Object.keys(this.excludeFileIds).map(item => Number(item)),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadmin: JSON.parse(this.settingByName('exclude_list').value) || { mask: [], fileid: [] },\n\t\t\t\t\t},\n\t\t\t\t\tcollectorSettings: {\n\t\t\t\t\t\thashing_algorithm: JSON.parse(this.settingByName('hashing_algorithm').value) || 'dhash',\n\t\t\t\t\t\tsimilarity_threshold: Number(this.similarity_threshold),\n\t\t\t\t\t\thash_size: Number(this.settingByName('hash_size').value) || 64,\n\t\t\t\t\t\ttarget_mtype: this.targetMimeType,\n\t\t\t\t\t},\n\t\t\t\t}).then(res => {\n\t\t\t\t\tthis.runningTask = false\n\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\tthis.runningTask = false\n\t\t\t\t\t\tthis.closeEditTaskDialog()\n\t\t\t\t\t\temit('restartTask')\n\t\t\t\t\t\tshowSuccess(t('mediadc', 'Task successfully restarted!'))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowWarning('Some error occured while running Collector Task. Try again.')\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\tremoveTargetDirectory(fileid) {\n\t\t\tdelete this.targetDirectoriesPaths[fileid]\n\t\t\tconst fileidIndex = this.targetDirectoriesIds.findIndex(id => id === fileid)\n\t\t\tthis.targetDirectoriesIds.splice(fileidIndex, 1)\n\t\t},\n\t\tremoveExcludeDirectory(fileid) {\n\t\t\tif (fileid in this.excludeFileIds) {\n\t\t\t\tconst dirIndex = this.excludeDirectoriesPaths.findIndex(dir => dir === this.excludeFileIds[fileid])\n\t\t\t\tthis.excludeDirectoriesPaths.splice(dirIndex, 1)\n\t\t\t\tdelete this.excludeFileIds[fileid]\n\t\t\t}\n\t\t},\n\t\tremoveExcludeFileid(fileid) {\n\t\t\tdelete this.excludeFileIds[fileid]\n\t\t},\n\t\taddNewMask() {\n\t\t\tthis.addingCustomMask = true\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$refs.customExcludeMask.focus()\n\t\t\t}, 100)\n\t\t},\n\t\taddCustomMask() {\n\t\t\tif (this.customExcludeMask.length > 0) {\n\t\t\t\tif (this.customExcludeList.findIndex(mask => mask === this.customExcludeMask) === -1) {\n\t\t\t\t\tthis.customExcludeList.push(this.customExcludeMask)\n\t\t\t\t\tthis.customExcludeMask = ''\n\t\t\t\t\tthis.addingCustomMask = false\n\t\t\t\t} else {\n\t\t\t\t\tshowWarning(t('mediadc', 'This mask already exists!'))\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'Enter custom mask!'))\n\t\t\t}\n\t\t},\n\t\tcancelAddingCustomMask() {\n\t\t\tthis.customExcludeMask = ''\n\t\t\tthis.addingCustomMask = false\n\t\t},\n\t\tdeleteCustomMask(mask) {\n\t\t\tconst maskIndex = this.customExcludeList.findIndex(m => m === mask)\n\t\t\tthis.customExcludeList.splice(maskIndex, 1)\n\t\t},\n\t\tasync getTasks() {\n\t\t\taxios.get(generateUrl('/apps/mediadc/api/v1/tasks')).then(res => {\n\t\t\t\tthis.$store.dispatch('setTasks', res.data)\n\t\t\t\tthis.$emit('update:loading', false)\n\t\t\t})\n\t\t},\n\t\tresetForm() {\n\t\t\tthis.targetDirectoriesPaths = {}\n\t\t\tthis.targetDirectoriesIds = []\n\t\t\tthis.excludeDirectoriesNames = []\n\t\t\tthis.excludeFileIds = {}\n\t\t\tthis.targetMimeType = 0\n\t\t\tthis.similarity_threshold = this.settingByName('similarity_threshold') !== undefined\n\t\t\t\t? this.settingByName('similarity_threshold').value\n\t\t\t\t: 90\n\t\t\tthis.customExcludeList = []\n\t\t\tthis.runningTask = false\n\t\t},\n\t\tcloseEditTaskDialog() {\n\t\t\tthis.$emit('update:opened', false)\n\t\t},\n\t\tasync getSettings() {\n\t\t\treturn axios.get(generateUrl('/apps/mediadc/api/v1/settings'))\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.blackout {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.3);\n\tz-index: 999;\n}\n\n.edit-task-block {\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tbox-shadow: 0 0 4px 0 rgba(0, 0, 0, .05);\n\tpadding: 20px;\n\twidth: 100%;\n\tmax-width: 600px;\n\tposition: absolute;\n\tbackground-color: #fff;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n}\n\n.selection-container {\n\twidth: 100%;\n\tdisplay: flex;\n}\n\n@media (max-width: 767px) {\n\t.selection-container {\n\t\tflex-wrap: wrap;\n\t}\n}\n\n@media (max-width: 540px) {\n\t.edit-task-block {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(50% + calc(100% - 96vh));\n\t}\n}\n\n.block {\n\twidth: 100%;\n\theight: 100%;\n\tmax-height: 200px;\n\toverflow-y: scroll;\n\tpadding: 10px 15px;\n\tmargin: 5px 10px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\n\n.block:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .05)\n}\n\n.target-directory, .custom-mask {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 0;\n\tborder-bottom: 1px solid #dadada;\n}\n\n.delete-button {\n\tdisplay: inline-flex;\n\twidth: 15px;\n\theight: 15px;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n\n.close-edit-button {\n\tposition: absolute;\n\ttop: 15px;\n\tright: 15px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\topacity: 0.5;\n}\n\n.close-edit-button:hover, .close-edit-button:active {\n\topacity: 1;\n}\n\nbody.theme--dark .actions-menu-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .close-edit-button:active {\n\tbackground-color: #5b5b5b;\n}\n\nbody.theme--dark .edit-task-block, body.theme--dark .block {\n\tborder-color: #717171;\n}\n\nbody.theme--dark .edit-task-block {\n\tbackground-color: #111;\n}\n</style>\n"],sourceRoot:""}]);const a=s},84806:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(23645),s=n.n(i)()(!0);s.push([t.id,"\n.container[data-v-0b7bbf6c] {\n\tpadding: 0 20px;\n\twidth: 100%;\n\tmax-width: 1440px;\n\tmargin: 0 auto;\n\tmax-height: 100%;\n}\n@media (min-width: 1920px) {\n.container[data-v-0b7bbf6c] {\n\t\tmax-width: 80vw;\n}\n}\nh2[data-v-0b7bbf6c] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\tmargin: 20px auto;\n\ttext-align: center;\n}\n.collapse-task-status-btn[data-v-0b7bbf6c] {\n\tdisplay: inline-flex;\n\tcursor: pointer;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 10px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n.task-details-heading p[data-v-0b7bbf6c] {\n\ttext-align: center;\n}\n.details-row[data-v-0b7bbf6c] {\n\tdisplay: flex;\n\tmargin: 0 10px 20px;\n}\n@media (max-width: 767px) {\n.details-row[data-v-0b7bbf6c] {\n\t\tflex-wrap: wrap;\n}\n.task-details-heading[data-v-0b7bbf6c] {\n\t\tflex-direction: column;\n}\n}\n.task-status-row[data-v-0b7bbf6c] {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-wrap: wrap;\n}\n.task-status[data-v-0b7bbf6c] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tmargin: 20px;\n\tpadding: 10px;\n}\n.actions-menu-button[data-v-0b7bbf6c] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n.actions-menu-button[data-v-0b7bbf6c]:hover, .collapse-task-status-btn[data-v-0b7bbf6c]:hover {\n\tbackground-color: #eee;\n}\n.actions-menu-button[data-v-0b7bbf6c]:active, .collapse-task-status-btn[data-v-0b7bbf6c]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .actions-menu-button[data-v-0b7bbf6c]:hover, body.theme--dark .collapse-task-status-btn[data-v-0b7bbf6c]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .actions-menu-button[data-v-0b7bbf6c]:active, body.theme--dark .collapse-task-status-btn[data-v-0b7bbf6c]:active {\n\tbackground-color: #5b5b5b;\n}\nbody.theme--dark .task-status[data-v-0b7bbf6c], body.theme--dark .task-info[data-v-0b7bbf6c] {\n\tborder-color: #717171;\n}\n.task-info[data-v-0b7bbf6c] {\n\tmargin: 20px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tpadding: 10px 20px;\n\theight: 100%;\n\tmax-height: 94px;\n\tmax-width: 50%;\n\toverflow-y: scroll;\n}\n@media (max-width: 767px) {\n.details-row[data-v-0b7bbf6c] {\n\t\tmargin: 0 0 20px;\n}\n.task-status[data-v-0b7bbf6c] {\n\t\tflex-direction: column;\n\t\tmargin: 0 0 20px;\n\t\twidth: 100%;\n}\n.task-info[data-v-0b7bbf6c] {\n\t\tmax-width: 100%;\n\t\tmargin: 0;\n}\n}\n.task-info h3[data-v-0b7bbf6c] {\n\tmargin: 0 0 5px 0;\n}\n.target-directory-row[data-v-0b7bbf6c] {\n\toverflow-x: scroll;\n\twhite-space: nowrap;\n}\n.badge[data-v-0b7bbf6c] {\n\tdisplay: inline-flex;\n\tpadding: 0 10px;\n\tbackground-color: #eee;\n\tborder-radius: 20px;\n\tmargin-right: 20px;\n}\n@media (max-width: 540px) {\n.task-status-row[data-v-0b7bbf6c] {\n\t\tflex-direction: column;\n\t\tmargin: 20px 0;\n}\n.badge[data-v-0b7bbf6c] {\n\t\tmargin-right: 0;\n\t\tmargin-top: 10px;\n\t\tmargin-bottom: 10px;\n}\n}\n.badge.finished[data-v-0b7bbf6c] {\n\tbackground-color: #49b382;\n\tcolor: #fff;\n}\n.badge.running[data-v-0b7bbf6c], .badge.pending[data-v-0b7bbf6c] {\n\tbackground-color: #dadada;\n\tcolor: #000;\n}\n.badge.error[data-v-0b7bbf6c] {\n\tbackground-color: #bd3f3f;\n\tcolor: #fff;\n}\n.badge.terminated[data-v-0b7bbf6c] {\n\tbackground-color: #f17b1b;\n\tcolor: #fff;\n}\n.errors[data-v-0b7bbf6c] {\n\tmargin: 20px;\n\tborder: 1px solid #bd3f3f;\n\tborder-radius: 5px;\n\tpadding: 10px;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n.error-row[data-v-0b7bbf6c] {\n\tborder-bottom: 1px solid #bd3f3f;\n\tpadding: 5px 0;\n\tmax-height: 100%;\n\toverflow-y: scroll;\n}\n","",{version:3,sources:["webpack://src/views/CollectorDetails.vue"],names:[],mappings:";AA+SA;CACA,eAAA;CACA,WAAA;CACA,iBAAA;CACA,cAAA;CACA,gBAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;AAEA;CACA,oBAAA;CACA,mBAAA;CACA,uBAAA;CACA,WAAA;CACA,iBAAA;CACA,kBAAA;AACA;AAEA;CACA,oBAAA;CACA,eAAA;CACA,WAAA;CACA,YAAA;CACA,cAAA;CACA,aAAA;CACA,kBAAA;CACA,iBAAA;AACA;AAEA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;EACA,sBAAA;AACA;AACA;AAEA;CACA,aAAA;CACA,uBAAA;CACA,mBAAA;CACA,eAAA;AACA;AAEA;CACA,oBAAA;CACA,mBAAA;CACA,yBAAA;CACA,kBAAA;CACA,YAAA;CACA,aAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,eAAA;CACA,iBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,cAAA;CACA,yBAAA;CACA,kBAAA;CACA,kBAAA;CACA,YAAA;CACA,gBAAA;CACA,cAAA;CACA,kBAAA;AACA;AAEA;AACA;EACA,gBAAA;AACA;AAEA;EACA,sBAAA;EACA,gBAAA;EACA,WAAA;AACA;AAEA;EACA,eAAA;EACA,SAAA;AACA;AACA;AAEA;CACA,iBAAA;AACA;AAEA;CACA,kBAAA;CACA,mBAAA;AACA;AAEA;CACA,oBAAA;CACA,eAAA;CACA,sBAAA;CACA,mBAAA;CACA,kBAAA;AACA;AAEA;AACA;EACA,sBAAA;EACA,cAAA;AACA;AAEA;EACA,eAAA;EACA,gBAAA;EACA,mBAAA;AACA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,YAAA;CACA,yBAAA;CACA,kBAAA;CACA,aAAA;CACA,iBAAA;CACA,kBAAA;AACA;AAEA;CACA,gCAAA;CACA,cAAA;CACA,gBAAA;CACA,kBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-if=\"!loading\" class=\"container\">\n\t\t<TasksEdit v-if=\"editingTask\" :opened.sync=\"editingTask\" />\n\t\t<div class=\"task-details\">\n\t\t\t<div class=\"task-details-heading\">\n\t\t\t\t<h2>\n\t\t\t\t\t{{ rootTitle }}\n\t\t\t\t\t<span :class=\"!collapsedStatus\n\t\t\t\t\t\t\t? 'icon-triangle-n collapse-task-status-btn'\n\t\t\t\t\t\t\t: 'icon-triangle-s collapse-task-status-btn'\"\n\t\t\t\t\t\t@click=\"collapseTaskStatus\" />\n\t\t\t\t</h2>\n\t\t\t\t<div v-show=\"!collapsedStatus\" class=\"task-details-description\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ t('mediadc', 'Here you can view task details, manage task (stop or restart), ' +\n\t\t\t\t\t\t\t'delete found duplicated photos and videos.') }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ t('mediadc', 'Deleted files are placed in the trash, so that they can be restored in case of need.') }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-show=\"!collapsedStatus\" class=\"task-status-row\">\n\t\t\t\t<div class=\"task-status\">\n\t\t\t\t\t<span :class=\"'badge ' + getStatusBadge(task)\">{{ getStatusBadge(task) }}</span>\n\t\t\t\t\t<div style=\"display: flex; flex-direction: column;\">\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<b>{{ parseTargetMtype(task) }}</b> {{ task.files_scanned !== task.files_total ? `${task.files_scanned}/` : '' }}{{ task.files_total }} file(s)\n\t\t\t\t\t\t\t({{ formatBytes(Number(task.files_total_size)) }})\n\t\t\t\t\t\t\t({{ task !== null && 'collector_settings' in task ? t('mediadc', 'precision: ') + JSON.parse(task.collector_settings).similarity_threshold + '%' : '' }})\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<b>{{ t('mediadc', 'Deleted: ') }} </b>\n\t\t\t\t\t\t\t{{ task.deleted_files_count }} {{ t('mediadc', 'file(s)') }}\n\t\t\t\t\t\t\t({{ formatBytes(Number(task.deleted_files_size)) }})\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{{ parseUnixTimestamp(task.created_time) }}\n\t\t\t\t\t\t\t{{ Number(task.finished_time) > 0 ? ' - ' + parseUnixTimestamp(task.finished_time) : '' }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"app-content-list-menu\" style=\"margin: 0 0 0 10px; position: relative;\">\n\t\t\t\t\t\t<div class=\"icon-more actions-menu-button\" @click=\"openActionsPopup\" />\n\t\t\t\t\t\t<div :class=\"actionsOpened ? 'popovermenu open' : 'popovermenu'\"\n\t\t\t\t\t\t\tstyle=\"right: -1px;\">\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-history\" @click=\"restartTask(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Restart') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-rename\" @click=\"openEditTaskDialog(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Edit') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-pause\" @click=\"terminateTask(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Stop') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-delete\" @click=\"deleteTask(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Delete') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"task-info\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Target directories') }}</h3>\n\t\t\t\t\t<div class=\"target-directories-list\">\n\t\t\t\t\t\t<div v-for=\"dir in taskInfo.target_directories\" :key=\"dir.fileid\" class=\"target-directory-row\">\n\t\t\t\t\t\t\t<b>[{{ dir.fileowner }}] {{ dir.filepath.replace(`/${dir.fileowner}/files`, '') }}</b> ({{ formatBytes(dir.filesize) }})\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"isValidUser\" class=\"details-row\">\n\t\t\t\t<DetailsList :filessize=\"filessize\" :filestotal=\"filestotal\" />\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<p style=\"text-align: center;\">\n\t\t\t\t\t<b>{{ t('mediadc', 'You are not allowed to manage other user\\'s tasks.') }}</b>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div v-if=\"task.errors !== undefined && task.errors.length > 0\" class=\"errors\">\n\t\t\t\t<h3>{{ t('mediadc', 'Task errors') }}</h3>\n\t\t\t\t<div v-for=\"error in task.errors.split('\\\\n')\" :key=\"error\" class=\"error-row\">\n\t\t\t\t\t{{ error }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { mapGetters } from 'vuex'\nimport Formats from '../mixins/Formats'\nimport { generateUrl } from '@nextcloud/router'\nimport DetailsList from '../components/details/DetailsList'\nimport { showSuccess, showError, showWarning } from '@nextcloud/dialogs'\nimport Configure from '../mixins/Configure'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport TasksEdit from '../components/tasks/TasksEdit'\n\nexport default {\n\tname: 'CollectorDetails',\n\tcomponents: {\n\t\tDetailsList,\n\t\tTasksEdit,\n\t},\n\tmixins: [\n\t\tFormats,\n\t\tConfigure,\n\t],\n\tprops: {\n\t\trootTitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tupdater: null,\n\t\t\tstatsUpdater: null,\n\t\t\tfilessize: 0,\n\t\t\tfilestotal: 0,\n\t\t\tactionsOpened: false,\n\t\t\tcollapsedStatus: false,\n\t\t\teditingTask: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'taskInfo',\n\t\t\t'details',\n\t\t\t'settingByName',\n\t\t]),\n\t\tisValidUser() {\n\t\t\treturn getCurrentUser().uid === this.task.owner\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tthis.$emit('update:loading', true)\n\t\tthis.getTaskDetails()\n\t\tthis.getTaskInfo()\n\t\tsubscribe('restartTask', () => {\n\t\t\tthis.getTaskInfo()\n\t\t\tthis.getTaskDetails()\n\t\t\tthis.filessize = 0\n\t\t\tthis.filestotal = 0\n\t\t})\n\t\tsubscribe('updateTaskInfo', this.getDetailFilesTotalSize)\n\t\tthis.updater = setInterval(this.getTaskDetails, 5000)\n\t},\n\tbeforeDestroy() {\n\t\tclearInterval(this.updater)\n\t\tunsubscribe('updateTaskInfo', this.getTaskInfo)\n\t\tunsubscribe('restartTask')\n\t},\n\tmethods: {\n\t\tterminateTask(task) {\n\t\t\tthis.toggleActionsPopup()\n\t\t\tif (this.isValidUser) {\n\t\t\t\tthis.terminating = true\n\t\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${task.id}/terminate`)).then(res => {\n\t\t\t\t\tshowSuccess(t('mediadc', 'Task terminated'))\n\t\t\t\t\tthis.terminating = false\n\t\t\t\t\tthis.getTaskDetails()\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'You are not allowed to terminate this task'))\n\t\t\t}\n\t\t},\n\t\trestartTask(task) {\n\t\t\tthis.toggleActionsPopup()\n\t\t\tif (this.isValidUser) {\n\t\t\t\tthis.restarting = true\n\t\t\t\tthis.getSettings().then(() => {\n\t\t\t\t\taxios.post(generateUrl('/apps/mediadc/api/v1/tasks/restart'), {\n\t\t\t\t\t\ttaskId: task.id,\n\t\t\t\t\t\ttargetDirectoryIds: task.target_directory_ids,\n\t\t\t\t\t\texcludeList: {\n\t\t\t\t\t\t\tuser: JSON.parse(task.exclude_list).user,\n\t\t\t\t\t\t\tadmin: JSON.parse(this.settingByName('exclude_list').value),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcollectorSettings: {\n\t\t\t\t\t\t\thashing_algorithm: JSON.parse(this.settingByName('hashing_algorithm').value) || 'dhash',\n\t\t\t\t\t\t\tsimilarity_threshold: Number(JSON.parse(this.task.collector_settings).similarity_threshold),\n\t\t\t\t\t\t\thash_size: Number(this.settingByName('hash_size').value) || 64,\n\t\t\t\t\t\t\ttarget_mtype: Number(JSON.parse(this.task.collector_settings).target_mtype),\n\t\t\t\t\t\t},\n\t\t\t\t\t}).then(res => {\n\t\t\t\t\t\tthis.restarting = false\n\t\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\t\tshowSuccess(t('mediadc', 'Task successfully restarted with previous settings!'))\n\t\t\t\t\t\t\tthis.getTaskDetails()\n\t\t\t\t\t\t\tthis.filessize = 0\n\t\t\t\t\t\t\tthis.filestotal = 0\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tshowError('Some error occured while restarting Collector Task. Try again.')\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(err => {\n\t\t\t\t\t\tthis.restarting = false\n\t\t\t\t\t\tconsole.debug(err)\n\t\t\t\t\t\tshowError('Some error occured while running Collector Task. Try again.')\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'You are not allowed to restart this task'))\n\t\t\t}\n\t\t},\n\t\tdeleteTask(task) {\n\t\t\tthis.toggleActionsPopup()\n\t\t\tif (this.isValidUser) {\n\t\t\t\tif (confirm(t('mediadc', 'Are sure, you want delete this task?'))) {\n\t\t\t\t\tthis.deleting = true\n\t\t\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${task.id}`)).then(res => {\n\t\t\t\t\t\tthis.$router.push({ name: 'collector' })\n\t\t\t\t\t\tshowSuccess(t('mediadc', 'Task successfully deleted'))\n\t\t\t\t\t\tthis.deleting = false\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshowWarning(t('mediadc', 'You are not allowed to delete this task'))\n\t\t\t}\n\t\t},\n\t\tasync getTaskDetails() {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${this.$route.params.taskId}`)).then(res => {\n\t\t\t\tif ('success' in res.data && res.data.success) {\n\t\t\t\t\tthis.$store.dispatch('setTask', res.data.collectorTask)\n\t\t\t\t\tthis.$store.dispatch('setDetails', res.data.collectorTaskDetails)\n\t\t\t\t\tif (this.getStatusBadge(this.task) === 'finished'\n\t\t\t\t\t\t&& this.filestotal === 0 && this.filessize === 0) {\n\t\t\t\t\t\tthis.getDetailFilesTotalSize()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.$emit('update:loading', false)\n\t\t\t})\n\t\t},\n\t\tasync getTaskInfo() {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${this.$route.params.taskId}/info`)).then(res => {\n\t\t\t\tthis.$store.dispatch('setTaskInfo', res.data.collectorTaskInfo)\n\t\t\t})\n\t\t},\n\t\tasync getDetailFilesTotalSize() {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${this.$route.params.taskId}/filestotal`)).then(res => {\n\t\t\t\tthis.filessize = res.data.filessize\n\t\t\t\tthis.filestotal = res.data.filestotal\n\t\t\t})\n\t\t},\n\t\topenActionsPopup() {\n\t\t\tdocument.addEventListener('click', this.toggleActionsPopup)\n\t\t},\n\t\ttoggleActionsPopup() {\n\t\t\tif (this.actionsOpened) {\n\t\t\t\tdocument.removeEventListener('click', this.toggleActionsPopup)\n\t\t\t}\n\t\t\tthis.actionsOpened = !this.actionsOpened\n\t\t},\n\t\tcollapseTaskStatus() {\n\t\t\tthis.collapsedStatus = !this.collapsedStatus\n\t\t},\n\t\topenEditTaskDialog() {\n\t\t\tthis.editingTask = true\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.container {\n\tpadding: 0 20px;\n\twidth: 100%;\n\tmax-width: 1440px;\n\tmargin: 0 auto;\n\tmax-height: 100%;\n}\n\n@media (min-width: 1920px) {\n\t.container {\n\t\tmax-width: 80vw;\n\t}\n}\n\nh2 {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\tmargin: 20px auto;\n\ttext-align: center;\n}\n\n.collapse-task-status-btn {\n\tdisplay: inline-flex;\n\tcursor: pointer;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 10px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n\n.task-details-heading p {\n\ttext-align: center;\n}\n\n.details-row {\n\tdisplay: flex;\n\tmargin: 0 10px 20px;\n}\n\n@media (max-width: 767px) {\n\t.details-row {\n\t\tflex-wrap: wrap;\n\t}\n\t.task-details-heading {\n\t\tflex-direction: column;\n\t}\n}\n\n.task-status-row {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-wrap: wrap;\n}\n\n.task-status {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tmargin: 20px;\n\tpadding: 10px;\n}\n\n.actions-menu-button {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n\n.actions-menu-button:hover, .collapse-task-status-btn:hover {\n\tbackground-color: #eee;\n}\n\n.actions-menu-button:active, .collapse-task-status-btn:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .actions-menu-button:hover, body.theme--dark .collapse-task-status-btn:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .actions-menu-button:active, body.theme--dark .collapse-task-status-btn:active {\n\tbackground-color: #5b5b5b;\n}\n\nbody.theme--dark .task-status, body.theme--dark .task-info {\n\tborder-color: #717171;\n}\n\n.task-info {\n\tmargin: 20px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tpadding: 10px 20px;\n\theight: 100%;\n\tmax-height: 94px;\n\tmax-width: 50%;\n\toverflow-y: scroll;\n}\n\n@media (max-width: 767px) {\n\t.details-row {\n\t\tmargin: 0 0 20px;\n\t}\n\n\t.task-status {\n\t\tflex-direction: column;\n\t\tmargin: 0 0 20px;\n\t\twidth: 100%;\n\t}\n\n\t.task-info {\n\t\tmax-width: 100%;\n\t\tmargin: 0;\n\t}\n}\n\n.task-info h3 {\n\tmargin: 0 0 5px 0;\n}\n\n.target-directory-row {\n\toverflow-x: scroll;\n\twhite-space: nowrap;\n}\n\n.badge {\n\tdisplay: inline-flex;\n\tpadding: 0 10px;\n\tbackground-color: #eee;\n\tborder-radius: 20px;\n\tmargin-right: 20px;\n}\n\n@media (max-width: 540px) {\n\t.task-status-row {\n\t\tflex-direction: column;\n\t\tmargin: 20px 0;\n\t}\n\n\t.badge {\n\t\tmargin-right: 0;\n\t\tmargin-top: 10px;\n\t\tmargin-bottom: 10px;\n\t}\n}\n\n.badge.finished {\n\tbackground-color: #49b382;\n\tcolor: #fff;\n}\n\n.badge.running, .badge.pending {\n\tbackground-color: #dadada;\n\tcolor: #000;\n}\n\n.badge.error {\n\tbackground-color: #bd3f3f;\n\tcolor: #fff;\n}\n\n.badge.terminated {\n\tbackground-color: #f17b1b;\n\tcolor: #fff;\n}\n\n.errors {\n\tmargin: 20px;\n\tborder: 1px solid #bd3f3f;\n\tborder-radius: 5px;\n\tpadding: 10px;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n\n.error-row {\n\tborder-bottom: 1px solid #bd3f3f;\n\tpadding: 5px 0;\n\tmax-height: 100%;\n\toverflow-y: scroll;\n}\n</style>\n"],sourceRoot:""}]);const a=s},46700:(t,e,n)=>{var i={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":94470,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":94470,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function s(t){var e=a(t);return n(e)}function a(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}s.keys=function(){return Object.keys(i)},s.resolve=a,t.exports=s,s.id=46700},86615:(e,n,i)=>{"use strict";i.r(n),i.d(n,{default:()=>at});var s=i(4820),a=i(20629),r=i(84440),o=i(79753),l=i(26932),d=i(22200),c=i(25108);function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const h={name:"DetailsFile",props:{file:{type:Object,required:!0},files:{type:Array,required:!0}},data:function(){return{loaded:!1}},computed:p({imageUrl:function(){return(0,o.generateRemoteUrl)("dav/files".concat(this.file.filepath.replace("files/","")))}},(0,a.Se)(["detailsGridSize"])),methods:{openFile:function(t){var e=this.files.map((function(t){return{basename:t.filename,fileid:t.fileid,filename:t.filepath.replace("/".concat((0,d.getCurrentUser)().uid,"/files"),""),getcontentlength:t.filesize,getcontenttype:t.filemtype,mime:t.filemtype,size:t.filesize}}));OCA.Viewer.open({path:t.filepath.replace("/".concat((0,d.getCurrentUser)().uid,"/files"),""),list:e.map((function(t){return p(p({},t),{},{list:e})}))})},onLoad:function(){c.debug("[DetailsFile] loaded"),this.loaded=!0}}};var f=i(93379),m=i.n(f),g=i(75723),v={insert:"head",singleton:!1};m()(g.Z,v);g.Z.locals;var b=i(51900);const C=(0,b.Z)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"file-thumb",on:{click:function(e){return t.openFile(t.file)}}},["image"===t.file.filempart?n("div",{staticStyle:{display:"flex"}},[n("img",{directives:[{name:"show",rawName:"v-show",value:t.loaded,expression:"loaded"}],key:t.file.filepath,attrs:{src:t.imageUrl,alt:t.file.filename,title:t.file.filepath},on:{load:t.onLoad}})]):t._e(),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.loaded&&"video"===t.file.filempart,expression:"!loaded && file.filempart === 'video'"}],staticClass:"placeholder",style:"min-height: "+t.detailsGridSize+"px",attrs:{title:t.file.filepath}},[n("svg",{attrs:{width:"50%",height:"50%",version:"1.1",viewBox:"-31 0 512 512",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"m440.59 206.68h-341.17l327.7-94.93c2.5469-0.73828 4.6953-2.4609 5.9766-4.7812 1.2812-2.3242 1.5859-5.0586 0.84766-7.6055l-17.148-59.199c-6.8516-23.645-28.867-40.16-53.539-40.16-5.1992 0-10.379 0.73828-15.402 2.1914l-307.68 89.129c-14.23 4.1211-26.023 13.582-33.215 26.633-7.1875 13.051-8.875 28.078-4.7539 42.305l16.754 57.836v238.25c0 30.688 24.965 55.652 55.648 55.652h120.16c5.5234 0 10-4.4766 10-10s-4.4766-10-10-10h-120.16c-19.66 0-35.652-15.992-35.652-35.652v-136.09h391.63v136.09c2.1e-4 19.66-15.992 35.652-35.652 35.652h-120.16c-5.5195 0-10 4.4766-10 10s4.4805 10 10 10h120.16c30.688 0 55.652-24.965 55.652-55.652v-239.67c0-5.5234-4.4766-10-10-10zm-176.33 93.586 42.488-73.586h55.262l-42.484 73.586zm-78.359 0 42.488-73.586h55.262l-42.484 73.586zm-78.355 0 42.484-73.586h55.266l-42.488 73.586zm37.18-129.46-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543l71.148 68.336-53.309 15.441c-0.375-0.54688-0.81641-1.0664-1.3125-1.543zm134-125.84 71.148 68.336-53.309 15.441c-0.375-0.54688-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543zm-75.266 21.805 71.148 68.332-53.309 15.445c-0.375-0.54687-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.37891 0.54297 0.81641 1.0625 1.3125 1.543zm149.96-45.367c3.2109-0.92969 6.5195-1.4023 9.8359-1.4023 15.824 0 29.938 10.578 34.328 25.727l14.367 49.59-40.121 11.621c-0.3789-0.54688-0.8164-1.0625-1.3164-1.543l-71.145-68.332zm-328.94 106.2c4.6094-8.3711 12.16-14.434 21.262-17.07l5.875-1.7031c0.37891 0.54688 0.81641 1.0664 1.3125 1.543l71.148 68.336-88.293 25.578-14.367-49.59c-2.6367-9.0976-1.5469-18.719 3.0625-27.094zm14.48 99.074h87.973l-42.484 73.586h-45.488zm303.66 73.586 42.484-73.586h45.488v73.586z"}}),t._v(" "),n("path",{attrs:{d:"m303.92 405.11c0-3.5742-1.9062-6.875-5-8.6602l-87.855-50.723c-3.0938-1.7852-6.9062-1.7852-10 0-3.0938 1.7852-5 5.0859-5 8.6602v101.45c0 3.5703 1.9062 6.8711 5 8.6562 1.5469 0.89453 3.2734 1.3438 5 1.3438 1.7266 0 3.4531-0.44922 5-1.3438l87.855-50.719c3.0938-1.7852 5-5.0859 5-8.6602zm-87.855 33.402v-66.805l57.855 33.402z"}}),t._v(" "),n("path",{attrs:{d:"m234.77 492c-5.5078 0-10 4.4922-10 10s4.4922 10 10 10c5.5117 0 10-4.4922 10-10s-4.4883-10-10-10z"}})])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.loaded&&"image"===t.file.filempart,expression:"!loaded && file.filempart === 'image'"}],staticClass:"placeholder",style:"min-height: "+t.detailsGridSize+"px"},[n("svg",{attrs:{width:"50%","enable-background":"new 0 0 512 512",version:"1.1",viewBox:"0 0 512 512","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"m446.58 0h-381.15c-36.076 0-65.425 29.35-65.425 65.426v381.15c0 36.075 29.349 65.425 65.425 65.425h381.15c36.076 0 65.425-29.35 65.425-65.426v-381.15c0-36.076-29.349-65.426-65.425-65.426zm35.267 446.58c0 19.447-15.821 35.267-35.267 35.267h-381.15c-19.447 0-35.268-15.821-35.268-35.267v-55.007l99.255-84.451c3.622-3.082 8.906-3.111 12.562-0.075l62.174 51.628c5.995 4.977 14.795 4.569 20.304-0.946l147.73-147.95c2.67-2.675 5.783-2.935 7.408-2.852 1.62 0.083 4.695 0.661 7.078 3.596l95.176 117.19v118.87zm0-166.71-71.766-88.366c-7.117-8.764-17.666-14.122-28.942-14.701-11.268-0.57-22.317 3.672-30.294 11.662l-138.01 138.22-51.59-42.839c-14.959-12.422-36.563-12.293-51.373 0.308l-79.712 67.822v-286.55c0-19.447 15.821-35.268 35.268-35.268h381.15c19.447 0 35.267 15.821 35.267 35.268v214.44z"}}),t._v(" "),n("path",{attrs:{d:"m161.17 62.995c-40.095 0-72.713 32.62-72.713 72.713 0 40.094 32.619 72.713 72.713 72.713s72.713-32.619 72.713-72.713-32.618-72.713-72.713-72.713zm0 115.27c-23.466 0-42.556-19.091-42.556-42.556 0-23.466 19.09-42.556 42.556-42.556s42.556 19.091 42.556 42.556-19.09 42.556-42.556 42.556z"}})])])])}),[],!1,null,"5ff2eb84",null).exports;var k=i(74854);function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const w={name:"DetailsGroupList",components:{DetailsFile:C},mixins:[r.Z],props:{files:{type:Array,required:!0},loadingFiles:{type:Boolean,required:!0}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){y(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},(0,a.Se)(["detailsGridSize"])),methods:{deleteGroupFile:function(e){var n=this;confirm(t("mediadc","Are you sure, you want delete this file?"))&&s.default.delete((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(e.taskId,"/files/").concat(e.detailId,"/").concat(e.fileid))).then((function(t){var i=n.files,s=i.findIndex((function(t){return t.fileid===e.fileid}));i.splice(s,1),n.$emit("update:files",i),(0,k.emit)("updateTaskInfo"),n.$store.dispatch("setTask",t.data.task)}))}}},_=w;var T=i(52605),E={insert:"head",singleton:!1};m()(T.Z,E);T.Z.locals;function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){B(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const D={name:"DetailsListItem",components:{DetailsGroupList:(0,b.Z)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.loadingFiles?n("div",[n("span",{staticClass:"icon-loading",staticStyle:{width:"20px",height:"20px",display:"flex",margin:"20px auto"}})]):n("div",{staticClass:"details-group"},[n("div",{staticClass:"details-group-files"},t._l(t.files,(function(e){return n("div",{key:e.fileid,staticClass:"file",style:"width: "+t.detailsGridSize+"px;"},[n("DetailsFile",{attrs:{file:e,files:t.files}}),t._v(" "),n("div",{staticClass:"file-info"},[n("span",{staticClass:"filename"},[t._v(t._s(e.filename))]),t._v(" "),n("span",{staticClass:"owner"},[t._v(t._s(e.fileowner))]),t._v(" "),n("span",{staticClass:"size"},[t._v(t._s(t.formatBytes(Number(e.filesize))))]),t._v(" "),n("span",{staticClass:"delete-file-btn icon-delete-white",on:{click:function(n){return t.deleteGroupFile(e)}}})])],1)})),0)])}),[],!1,null,"4505d2f6",null).exports},mixins:[r.Z],props:{detail:{type:Object,required:!0}},data:function(){return{opened:!1,page:0,totalPages:0,itemsPerPage:10,loadingFiles:!1,files:[],paginatedFiles:{}}},computed:P({},(0,a.Se)(["task","details"])),methods:{openDetailFiles:function(t){if(this.opened)this.opened=!1;else if(0===this.files.length){var e=t.task_id,n=t.id;this.loadingFiles=!0,this.opened=!0,this.page in this.paginatedFiles?(this.files=this.paginatedFiles[this.page],this.loadingFiles=!1):this.loadFilesInfo(e,n)}else this.opened=!0},openNextDetailFiles:function(e){if(this.page<Math.ceil(JSON.parse(e.group_files_ids).length/this.itemsPerPage)-1){this.page+=1;var n=e.task_id,i=e.id;this.loadingFiles=!0,this.page in this.paginatedFiles?(this.files=this.paginatedFiles[this.page],this.loadingFiles=!1):this.loadFilesInfo(n,i)}else(0,l.K2)(t("mediadc","Last page reached!"))},openPrevDetailFiles:function(e){if(this.page>0){this.page-=1;var n=e.task_id,i=e.id;this.loadingFiles=!0,this.page in this.paginatedFiles?(this.files=this.paginatedFiles[this.page],this.loadingFiles=!1):this.loadFilesInfo(n,i)}else(0,l.K2)(t("mediadc","First page reached!"))},loadFilesInfo:function(t,e){var n=this;s.default.get((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t,"/files/").concat(e,"?limit=").concat(this.itemsPerPage,"&page=").concat(this.page))).then((function(i){n.paginatedFiles[n.page]=i.data.map((function(n){return P(P({},n),{},{taskId:t,detailId:e})})),n.files=n.paginatedFiles[n.page],n.loadingFiles=!1}))},getGroupFilesSize:function(t){return t.reduce((function(t,e){return t+e.filesize}),0)},deleteTaskDetail:function(e){var n=this;confirm(t("mediadc","Are you sure, you want remove this group without deleting files?"))&&s.default.delete((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(e.task_id,"/detail/").concat(e.id))).then((function(i){i.data.success?(n.$store.dispatch("deleteDetail",e),(0,k.emit)("updateTaskInfo"),(0,l.s$)(t("mediadc","Duplicate group succesffully removed"))):(0,l.x2)(t("mediadc","Some error occured while deleting duplicate group"))}))}}};var S=i(1660),I={insert:"head",singleton:!1};m()(S.Z,I);S.Z.locals;function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const N={name:"DetailsList",components:{DetailsListItem:(0,b.Z)(D,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"details-list-item"},[n("div",{staticClass:"details-list-item-title"},[n("span",{staticClass:"icon-projects",staticStyle:{margin:"0 10px 0 0"}}),t._v(" "),n("span",{staticClass:"group-info",on:{click:function(e){return t.openDetailFiles(t.detail)}}},[t._v("\n\t\t\t"+t._s(t.t("mediadc","Duplicate group"))+" #"+t._s(t.detail.id)+" ("+t._s(JSON.parse(t.detail.group_files_ids).length)+"\n\t\t\t"+t._s(t.t("mediadc","file(s)"))+t._s(t.files.length>0?" - "+t.formatBytes(t.getGroupFilesSize(t.files)):"")+")\n\t\t")]),t._v(" "),n("span",{class:t.opened?"icon-triangle-n open-details-btn":"icon-triangle-s open-details-btn"}),t._v(" "),n("span",{staticClass:"icon-delete delete-group-btn",on:{click:function(e){return t.deleteTaskDetail(t.detail)}}})]),t._v(" "),t.opened&&JSON.parse(t.detail.group_files_ids).length>t.itemsPerPage?n("div",{staticClass:"pagination"},[n("span",{staticClass:"icon-view-previous pagination-button",on:{click:function(e){return t.openPrevDetailFiles(t.detail)}}}),t._v(" "),n("span",[t._v(t._s(t.t("mediadc","Page:"))+" ")]),t._v(" "),n("span",[t._v(t._s(t.page+1)+"/"+t._s(Math.ceil(JSON.parse(t.detail.group_files_ids).length/t.itemsPerPage)))]),t._v(" "),n("span",{staticClass:"icon-view-next pagination-button",on:{click:function(e){return t.openNextDetailFiles(t.detail)}}})]):t._e(),t._v(" "),n("DetailsGroupList",{directives:[{name:"show",rawName:"v-show",value:t.opened,expression:"opened"}],attrs:{files:t.files,"loading-files":t.loadingFiles}})],1)}),[],!1,null,"e647c532",null).exports},mixins:[r.Z],props:{filessize:{type:Number,required:!0},filestotal:{type:Number,required:!0}},data:function(){return{page:0}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){F(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},(0,a.Se)(["task","details","sorted","paginatedDetails","itemsPerPage"])),beforeMount:function(){this.$emit("update:loading",!1)},methods:{prevGroupsPage:function(){this.page>0?this.page-=1:(0,l.K2)(t("mediadc","First page reached!"))},nextGroupsPage:function(){this.page<Math.ceil(this.details.length/this.itemsPerPage)-1?this.page+=1:(0,l.K2)(t("mediadc","Last page reached!"))},toggleSorting:function(){this.$store.dispatch("setSorted",!this.sorted)}}};var z=i(17157),U={insert:"head",singleton:!1};m()(z.Z,U);z.Z.locals;const L=(0,b.Z)(N,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"task-details"},[n("div",{staticClass:"task-details-heading"},[n("h3",[t._v("\n\t\t\t"+t._s(t.t("mediadc","Duplicates list"))+"\n\t\t\t"),"finished"===t.getStatusBadge(t.task)?n("span",[t._v("\n\t\t\t\t- "+t._s(t.details.length)+" "+t._s(t.t("mediadc","group(s)"))+"\n\t\t\t\t("+t._s(t.filestotal)+" "+t._s(t.t("mediadc","file(s)"))+" - "+t._s(t.formatBytes(t.filessize))+")\n\t\t\t")]):t._e()]),t._v(" "),t.details.length>t.itemsPerPage?n("div",{staticClass:"pagination"},[n("span",{class:t.sorted?"icon-triangle-n toggle-sorting-button":"icon-triangle-s toggle-sorting-button",on:{click:t.toggleSorting}}),t._v(" "),n("span",{staticClass:"icon-view-previous pagination-button",on:{click:function(e){return t.prevGroupsPage()}}}),t._v(" "),n("span",[t._v(t._s(t.t("mediadc","Page:"))+" ")]),t._v(" "),n("span",[t._v(t._s(t.page+1)+"/"+t._s(Math.ceil(t.details.length/t.itemsPerPage)))]),t._v(" "),n("span",{staticClass:"icon-view-next pagination-button",on:{click:function(e){return t.nextGroupsPage()}}})]):t._e()]),t._v(" "),t.details.length>0?n("div",t._l(t.paginatedDetails[t.page],(function(t){return n("div",{directives:[{name:"show",rawName:"v-show",value:JSON.parse(t.group_files_ids).length>1,expression:"JSON.parse(detail.group_files_ids).length > 1"}],key:t.id,staticClass:"task-details-row"},[n("DetailsListItem",{attrs:{detail:t}})],1)})),0):n("div",[n("strong",[t._v(t._s(t.t("mediadc","No duplicates found.")))])])])}),[],!1,null,"7f69bd38",null).exports;var M=i(96679),G=i(88982);function $(t,e,n,i,s,a,r){try{var o=t[a](r),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,s)}function R(t){return function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function r(t){$(a,i,s,r,o,"next",t)}function o(t){$(a,i,s,r,o,"throw",t)}r(void 0)}))}}function W(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const J={name:"TasksEdit",props:{opened:{type:Boolean,required:!0}},data:function(){return{targetDirectoriesPaths:{},targetDirectoriesIds:[],excludeDirectoriesPaths:[],excludeFileIds:{},targetMimeType:0,similarity_threshold:90,customExcludeList:[],customExcludeMask:"",addingCustomMask:!1,runningTask:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?W(Object(n),!0).forEach((function(e){Y(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},(0,a.Se)(["settings","settingByName","tasks","task","taskInfo"])),beforeMount:function(){this.similarity_threshold=void 0!==this.settingByName("similarity_threshold")?this.settingByName("similarity_threshold").value:90,this.targetMimeType=JSON.parse(this.task.collector_settings).target_mtype,this.similarity_threshold=JSON.parse(this.task.collector_settings).similarity_threshold,this.parseTaskSettings()},methods:{parseTaskSettings:function(){var t=this;null!==this.taskInfo&&"target_directories"in this.taskInfo&&this.taskInfo.target_directories.forEach((function(e){t.targetDirectoriesIds.push(e.fileid.toString()),t.targetDirectoriesPaths[e.fileid.toString()]=e.filepath.replace("/".concat((0,d.getCurrentUser)().uid,"/files"),"")})),null!==this.taskInfo&&"exclude_directories"in this.taskInfo&&(this.taskInfo.exclude_directories.forEach((function(e){t.excludeDirectoriesPaths.push(e.filepath.replace()),t.excludeFileIds[e.fileid.toString()]=e.filepath.replace("/".concat((0,d.getCurrentUser)().uid,"/files"),"")})),this.customExcludeList=JSON.parse(this.task.exclude_list).user.mask)},getDirectoriesPicker:function(t){return(0,l.fn)(t).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").setModal(!0).setType(1).allowDirectories(!0).build()},getFilesPicker:function(t){return(0,l.fn)(t).setMultiSelect(!1).setModal(!0).setType(1).allowDirectories(!0).build()},openDirectoriesExplorer:function(){var e=this;this.getDirectoriesPicker(t("mediadc","Choose target directory")).pick().then((function(n){n.startsWith("/")?(0,G.zW)(n).then((function(i){var s=(0,G.WU)(i.data);-1!==s&&(s in e.targetDirectoriesPaths?(0,l.K2)(t("mediadc","This directory already selected")):(e.targetDirectoriesIds.push(s),e.targetDirectoriesPaths[s.toString()]=n))})):((0,G.zW)("/").then((function(n){var i=(0,G.WU)(n.data);-1!==i&&(i in e.targetDirectoriesPaths?(0,l.K2)(t("mediadc","This directory already selected")):(e.targetDirectoriesIds.push(i),e.targetDirectoriesPaths[i.toString()]="/"))})),e.targetDirectoriesPaths.push("/"))}))},openExcludeExplorer:function(){var e=this;this.getDirectoriesPicker(t("mediadc","Choose directory to exclude")).pick().then((function(n){-1===Object.values(e.excludeFileIds).findIndex((function(t){return t===n}))?n.startsWith("/")?(0,G.zW)(n).then((function(t){var i=(0,G.WU)(t.data);-1!==i&&(e.excludeDirectoriesPaths.push(n),e.excludeFileIds[i.toString()]=n)})):(0,G.zW)("/").then((function(t){var i=(0,G.WU)(t.data);-1!==i&&(e.excludeDirectoriesPaths.push(n),e.excludeFileIds[i.toString()]="/")})):(0,l.K2)(t("mediadc","This directory already excluded"))}))},restartTask:function(){var e=this;this.runningTask=!0,this.getSettings().then((function(n){e.$store.dispatch("setSettings",n.data),s.default.post((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/restart"),{taskId:e.task.id,targetDirectoryIds:JSON.stringify(e.targetDirectoriesIds),excludeList:{user:{mask:e.customExcludeList,fileid:Object.keys(e.excludeFileIds).map((function(t){return Number(t)}))},admin:JSON.parse(e.settingByName("exclude_list").value)||{mask:[],fileid:[]}},collectorSettings:{hashing_algorithm:JSON.parse(e.settingByName("hashing_algorithm").value)||"dhash",similarity_threshold:Number(e.similarity_threshold),hash_size:Number(e.settingByName("hash_size").value)||64,target_mtype:e.targetMimeType}}).then((function(n){e.runningTask=!1,n.data.success?(e.runningTask=!1,e.closeEditTaskDialog(),(0,k.emit)("restartTask"),(0,l.s$)(t("mediadc","Task successfully restarted!"))):(0,l.K2)("Some error occured while running Collector Task. Try again.")}))}))},removeTargetDirectory:function(t){delete this.targetDirectoriesPaths[t];var e=this.targetDirectoriesIds.findIndex((function(e){return e===t}));this.targetDirectoriesIds.splice(e,1)},removeExcludeDirectory:function(t){var e=this;if(t in this.excludeFileIds){var n=this.excludeDirectoriesPaths.findIndex((function(n){return n===e.excludeFileIds[t]}));this.excludeDirectoriesPaths.splice(n,1),delete this.excludeFileIds[t]}},removeExcludeFileid:function(t){delete this.excludeFileIds[t]},addNewMask:function(){var t=this;this.addingCustomMask=!0,setTimeout((function(){t.$refs.customExcludeMask.focus()}),100)},addCustomMask:function(){var e=this;this.customExcludeMask.length>0?-1===this.customExcludeList.findIndex((function(t){return t===e.customExcludeMask}))?(this.customExcludeList.push(this.customExcludeMask),this.customExcludeMask="",this.addingCustomMask=!1):(0,l.K2)(t("mediadc","This mask already exists!")):(0,l.K2)(t("mediadc","Enter custom mask!"))},cancelAddingCustomMask:function(){this.customExcludeMask="",this.addingCustomMask=!1},deleteCustomMask:function(t){var e=this.customExcludeList.findIndex((function(e){return e===t}));this.customExcludeList.splice(e,1)},getTasks:function(){var t=this;return R(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.default.get((0,o.generateUrl)("/apps/mediadc/api/v1/tasks")).then((function(e){t.$store.dispatch("setTasks",e.data),t.$emit("update:loading",!1)}));case 1:case"end":return e.stop()}}),e)})))()},resetForm:function(){this.targetDirectoriesPaths={},this.targetDirectoriesIds=[],this.excludeDirectoriesNames=[],this.excludeFileIds={},this.targetMimeType=0,this.similarity_threshold=void 0!==this.settingByName("similarity_threshold")?this.settingByName("similarity_threshold").value:90,this.customExcludeList=[],this.runningTask=!1},closeEditTaskDialog:function(){this.$emit("update:opened",!1)},getSettings:function(){return R(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",s.default.get((0,o.generateUrl)("/apps/mediadc/api/v1/settings")));case 1:case"end":return t.stop()}}),t)})))()}}};var q=i(37032),Z={insert:"head",singleton:!1};m()(q.Z,Z);q.Z.locals;const H=(0,b.Z)(J,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.opened,expression:"opened"}],staticClass:"blackout"},[n("div",{staticClass:"edit-task-block"},[n("span",{staticClass:"icon-close close-edit-button",on:{click:t.closeEditTaskDialog}}),t._v(" "),n("h2",[t._v(t._s(t.t("mediadc","Edit task")))]),t._v(" "),n("div",{staticClass:"selection-container"},[n("div",{staticClass:"block target-directories-block"},[n("h3",[t._v(t._s(t.t("mediadc","Target directories")))]),t._v(" "),t.targetDirectoriesIds.length>0?n("div",t._l(t.targetDirectoriesIds,(function(e){return n("div",{key:e,staticClass:"selected-target-directories-list"},[n("div",{staticClass:"target-directory"},[n("span",{staticStyle:{"overflow-y":"scroll","white-space":"nowrap"}},[t._v(t._s(t.targetDirectoriesPaths[e]))]),t._v(" "),n("span",{staticClass:"delete-button icon-delete",on:{click:function(n){return t.removeTargetDirectory(e)}}})])])})),0):n("div",[n("span",[t._v(t._s(t.t("mediadc","Not selected")))])]),t._v(" "),n("br"),t._v(" "),n("button",{on:{click:t.openDirectoriesExplorer}},[n("span",{staticClass:"icon-add"}),t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Select"))+"\n\t\t\t\t")])]),t._v(" "),n("div",{staticClass:"block"},[n("h3",[t._v(t._s(t.t("mediadc","Exclude directories")))]),t._v(" "),t.excludeDirectoriesPaths.length>0?n("div",t._l(Object.keys(t.excludeFileIds),(function(e){return n("div",{key:e,staticClass:"selected-excluded-directories-list"},[n("div",{staticClass:"target-directory"},[n("span",{staticStyle:{"overflow-y":"scroll"}},[t._v(t._s(t.excludeFileIds[e]))]),t._v(" "),n("span",{staticClass:"delete-button icon-delete",on:{click:function(n){return t.removeExcludeDirectory(e)}}})])])})),0):n("div",[n("span",[t._v(t._s(t.t("mediadc","Not selected")))])]),t._v(" "),n("br"),t._v(" "),n("button",{on:{click:t.openExcludeExplorer}},[n("span",{staticClass:"icon-add"}),t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Select"))+"\n\t\t\t\t")])])]),t._v(" "),n("div",{staticClass:"selection-container"},[n("div",{staticClass:"block"},[n("h3",[t._v(t._s(t.t("mediadc","Custom exclude mask")))]),t._v(" "),t.customExcludeList.length>0?n("div",{staticClass:"custom-masks-list"},t._l(t.customExcludeList,(function(e,i){return n("div",{key:i,staticClass:"custom-mask"},[n("span",[t._v(t._s(e))]),t._v(" "),n("span",{staticClass:"icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(n){return t.deleteCustomMask(e)}}})])})),0):n("div",[n("span",[t._v(t._s(t.t("mediadc","Not added")))])]),t._v(" "),t.addingCustomMask?n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.customExcludeMask,expression:"customExcludeMask"}],ref:"customExcludeMask",attrs:{id:"custom-exclude-mask",type:"text"},domProps:{value:t.customExcludeMask},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addCustomMask.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancelAddingCustomMask.apply(null,arguments)}],input:function(e){e.target.composing||(t.customExcludeMask=e.target.value)}}}),t._v(" "),n("span",{staticClass:"icon-checkmark",staticStyle:{width:"18px",height:"18px",margin:"0 5px",display:"inline-block",cursor:"pointer"},on:{click:t.addCustomMask}}),t._v(" "),n("span",{staticClass:"icon-close",staticStyle:{width:"18px",height:"18px",margin:"0 5px",display:"inline-block",cursor:"pointer"},on:{click:t.cancelAddingCustomMask}})]):t._e(),t._v(" "),n("div",{staticStyle:{display:"flex","align-items":"center",margin:"20px 0"}},[n("button",{on:{click:t.addNewMask}},[n("span",{staticClass:"icon-add"}),t._v(" "),n("span",[t._v(t._s(t.t("mediadc","Add mask")))])])])]),t._v(" "),n("div",{staticClass:"block"},[n("h3",{staticStyle:{margin:"5px 0"}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Target Mime Type"))+"\n\t\t\t\t")]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.targetMimeType,expression:"targetMimeType"}],attrs:{id:"target_mtype",name:"target_mtype"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.targetMimeType=e.target.multiple?n:n[0]}}},[n("option",{domProps:{value:0}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Photos"))+"\n\t\t\t\t\t")]),t._v(" "),n("option",{domProps:{value:1}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Videos"))+"\n\t\t\t\t\t")]),t._v(" "),n("option",{domProps:{value:2}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Photos and Videos"))+"\n\t\t\t\t\t")])]),t._v(" "),n("h3",{staticStyle:{margin:"5px 0"}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Similarity threshold"))+"\n\t\t\t\t")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.similarity_threshold,expression:"similarity_threshold"}],staticStyle:{margin:"0 0 10px"},attrs:{type:"number",min:"50",max:"100"},domProps:{value:t.similarity_threshold},on:{input:function(e){e.target.composing||(t.similarity_threshold=e.target.value)}}})])]),t._v(" "),t.runningTask?n("button",{attrs:{disabled:""}},[n("span",{staticClass:"icon-loading"})]):n("button",{staticStyle:{margin:"10px 5px 0"},attrs:{disabled:0===Object.keys(t.targetDirectoriesPaths).length},on:{click:t.restartTask}},[t._v("\n\t\t\t"+t._s(t.t("mediadc","Restart task"))+"\n\t\t")])])])}),[],!1,null,"4aff1f56",null).exports;var V=i(25108);function K(t,e,n,i,s,a,r){try{var o=t[a](r),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,s)}function Q(t){return function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function r(t){K(a,i,s,r,o,"next",t)}function o(t){K(a,i,s,r,o,"throw",t)}r(void 0)}))}}function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){et(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const nt={name:"CollectorDetails",components:{DetailsList:L,TasksEdit:H},mixins:[r.Z,M.Z],props:{rootTitle:{type:String,required:!0},loading:{type:Boolean,required:!0}},data:function(){return{updater:null,statsUpdater:null,filessize:0,filestotal:0,actionsOpened:!1,collapsedStatus:!1,editingTask:!1}},computed:tt(tt({},(0,a.Se)(["task","taskInfo","details","settingByName"])),{},{isValidUser:function(){return(0,d.getCurrentUser)().uid===this.task.owner}}),beforeMount:function(){var t=this;this.$emit("update:loading",!0),this.getTaskDetails(),this.getTaskInfo(),(0,k.subscribe)("restartTask",(function(){t.getTaskInfo(),t.getTaskDetails(),t.filessize=0,t.filestotal=0})),(0,k.subscribe)("updateTaskInfo",this.getDetailFilesTotalSize),this.updater=setInterval(this.getTaskDetails,5e3)},beforeDestroy:function(){clearInterval(this.updater),(0,k.unsubscribe)("updateTaskInfo",this.getTaskInfo),(0,k.unsubscribe)("restartTask")},methods:{terminateTask:function(e){var n=this;this.toggleActionsPopup(),this.isValidUser?(this.terminating=!0,s.default.post((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(e.id,"/terminate"))).then((function(e){(0,l.s$)(t("mediadc","Task terminated")),n.terminating=!1,n.getTaskDetails()}))):(0,l.K2)(t("mediadc","You are not allowed to terminate this task"))},restartTask:function(e){var n=this;this.toggleActionsPopup(),this.isValidUser?(this.restarting=!0,this.getSettings().then((function(){s.default.post((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/restart"),{taskId:e.id,targetDirectoryIds:e.target_directory_ids,excludeList:{user:JSON.parse(e.exclude_list).user,admin:JSON.parse(n.settingByName("exclude_list").value)},collectorSettings:{hashing_algorithm:JSON.parse(n.settingByName("hashing_algorithm").value)||"dhash",similarity_threshold:Number(JSON.parse(n.task.collector_settings).similarity_threshold),hash_size:Number(n.settingByName("hash_size").value)||64,target_mtype:Number(JSON.parse(n.task.collector_settings).target_mtype)}}).then((function(e){n.restarting=!1,e.data.success?((0,l.s$)(t("mediadc","Task successfully restarted with previous settings!")),n.getTaskDetails(),n.filessize=0,n.filestotal=0):(0,l.x2)("Some error occured while restarting Collector Task. Try again.")})).catch((function(t){n.restarting=!1,V.debug(t),(0,l.x2)("Some error occured while running Collector Task. Try again.")}))}))):(0,l.K2)(t("mediadc","You are not allowed to restart this task"))},deleteTask:function(e){var n=this;this.toggleActionsPopup(),this.isValidUser?confirm(t("mediadc","Are sure, you want delete this task?"))&&(this.deleting=!0,s.default.delete((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(e.id))).then((function(e){n.$router.push({name:"collector"}),(0,l.s$)(t("mediadc","Task successfully deleted")),n.deleting=!1}))):(0,l.K2)(t("mediadc","You are not allowed to delete this task"))},getTaskDetails:function(){var t=this;return Q(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.default.get((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t.$route.params.taskId))).then((function(e){"success"in e.data&&e.data.success&&(t.$store.dispatch("setTask",e.data.collectorTask),t.$store.dispatch("setDetails",e.data.collectorTaskDetails),"finished"===t.getStatusBadge(t.task)&&0===t.filestotal&&0===t.filessize&&t.getDetailFilesTotalSize()),t.$emit("update:loading",!1)}));case 1:case"end":return e.stop()}}),e)})))()},getTaskInfo:function(){var t=this;return Q(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.default.get((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t.$route.params.taskId,"/info"))).then((function(e){t.$store.dispatch("setTaskInfo",e.data.collectorTaskInfo)}));case 1:case"end":return e.stop()}}),e)})))()},getDetailFilesTotalSize:function(){var t=this;return Q(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.default.get((0,o.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t.$route.params.taskId,"/filestotal"))).then((function(e){t.filessize=e.data.filessize,t.filestotal=e.data.filestotal}));case 1:case"end":return e.stop()}}),e)})))()},openActionsPopup:function(){document.addEventListener("click",this.toggleActionsPopup)},toggleActionsPopup:function(){this.actionsOpened&&document.removeEventListener("click",this.toggleActionsPopup),this.actionsOpened=!this.actionsOpened},collapseTaskStatus:function(){this.collapsedStatus=!this.collapsedStatus},openEditTaskDialog:function(){this.editingTask=!0}}};var it=i(84806),st={insert:"head",singleton:!1};m()(it.Z,st);it.Z.locals;const at=(0,b.Z)(nt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.loading?t._e():n("div",{staticClass:"container"},[t.editingTask?n("TasksEdit",{attrs:{opened:t.editingTask},on:{"update:opened":function(e){t.editingTask=e}}}):t._e(),t._v(" "),n("div",{staticClass:"task-details"},[n("div",{staticClass:"task-details-heading"},[n("h2",[t._v("\n\t\t\t\t"+t._s(t.rootTitle)+"\n\t\t\t\t"),n("span",{class:t.collapsedStatus?"icon-triangle-s collapse-task-status-btn":"icon-triangle-n collapse-task-status-btn",on:{click:t.collapseTaskStatus}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.collapsedStatus,expression:"!collapsedStatus"}],staticClass:"task-details-description"},[n("p",[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Here you can view task details, manage task (stop or restart), delete found duplicated photos and videos."))+"\n\t\t\t\t")]),t._v(" "),n("p",[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Deleted files are placed in the trash, so that they can be restored in case of need."))+"\n\t\t\t\t")])])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.collapsedStatus,expression:"!collapsedStatus"}],staticClass:"task-status-row"},[n("div",{staticClass:"task-status"},[n("span",{class:"badge "+t.getStatusBadge(t.task)},[t._v(t._s(t.getStatusBadge(t.task)))]),t._v(" "),n("div",{staticStyle:{display:"flex","flex-direction":"column"}},[n("span",[n("b",[t._v(t._s(t.parseTargetMtype(t.task)))]),t._v(" "+t._s(t.task.files_scanned!==t.task.files_total?t.task.files_scanned+"/":"")+t._s(t.task.files_total)+" file(s)\n\t\t\t\t\t\t("+t._s(t.formatBytes(Number(t.task.files_total_size)))+")\n\t\t\t\t\t\t("+t._s(null!==t.task&&"collector_settings"in t.task?t.t("mediadc","precision: ")+JSON.parse(t.task.collector_settings).similarity_threshold+"%":"")+")\n\t\t\t\t\t\t"),n("br"),t._v(" "),n("b",[t._v(t._s(t.t("mediadc","Deleted: "))+" ")]),t._v("\n\t\t\t\t\t\t"+t._s(t.task.deleted_files_count)+" "+t._s(t.t("mediadc","file(s)"))+"\n\t\t\t\t\t\t("+t._s(t.formatBytes(Number(t.task.deleted_files_size)))+")\n\t\t\t\t\t")]),t._v(" "),n("span",[t._v("\n\t\t\t\t\t\t"+t._s(t.parseUnixTimestamp(t.task.created_time))+"\n\t\t\t\t\t\t"+t._s(Number(t.task.finished_time)>0?" - "+t.parseUnixTimestamp(t.task.finished_time):"")+"\n\t\t\t\t\t")])]),t._v(" "),n("div",{staticClass:"app-content-list-menu",staticStyle:{margin:"0 0 0 10px",position:"relative"}},[n("div",{staticClass:"icon-more actions-menu-button",on:{click:t.openActionsPopup}}),t._v(" "),n("div",{class:t.actionsOpened?"popovermenu open":"popovermenu",staticStyle:{right:"-1px"}},[n("ul",[n("li",[n("a",{staticClass:"icon-history",on:{click:function(e){return t.restartTask(t.task)}}},[n("span",[t._v(t._s(t.t("mediadc","Restart")))])])]),t._v(" "),n("li",[n("a",{staticClass:"icon-rename",on:{click:function(e){return t.openEditTaskDialog(t.task)}}},[n("span",[t._v(t._s(t.t("mediadc","Edit")))])])]),t._v(" "),n("li",[n("a",{staticClass:"icon-pause",on:{click:function(e){return t.terminateTask(t.task)}}},[n("span",[t._v(t._s(t.t("mediadc","Stop")))])])]),t._v(" "),n("li",[n("a",{staticClass:"icon-delete",on:{click:function(e){return t.deleteTask(t.task)}}},[n("span",[t._v(t._s(t.t("mediadc","Delete")))])])])])])])]),t._v(" "),n("div",{staticClass:"task-info"},[n("h3",[t._v(t._s(t.t("mediadc","Target directories")))]),t._v(" "),n("div",{staticClass:"target-directories-list"},t._l(t.taskInfo.target_directories,(function(e){return n("div",{key:e.fileid,staticClass:"target-directory-row"},[n("b",[t._v("["+t._s(e.fileowner)+"] "+t._s(e.filepath.replace("/"+e.fileowner+"/files","")))]),t._v(" ("+t._s(t.formatBytes(e.filesize))+")\n\t\t\t\t\t")])})),0)])]),t._v(" "),t.isValidUser?n("div",{staticClass:"details-row"},[n("DetailsList",{attrs:{filessize:t.filessize,filestotal:t.filestotal}})],1):n("div",[n("p",{staticStyle:{"text-align":"center"}},[n("b",[t._v(t._s(t.t("mediadc","You are not allowed to manage other user's tasks.")))])])]),t._v(" "),void 0!==t.task.errors&&t.task.errors.length>0?n("div",{staticClass:"errors"},[n("h3",[t._v(t._s(t.t("mediadc","Task errors")))]),t._v(" "),t._l(t.task.errors.split("\\n"),(function(e){return n("div",{key:e,staticClass:"error-row"},[t._v("\n\t\t\t\t"+t._s(e)+"\n\t\t\t")])}))],2):t._e()])],1)}),[],!1,null,"0b7bbf6c",null).exports}}]);
//# sourceMappingURL=mediadc-node_modules_moment_locale_sync_recursive_-src_views_CollectorDetails_vue.js.map?v=e093d6fc6af6349930d0