/*! For license information please see mediadc-node_modules_moment_locale_sync_recursive_-src_views_CollectorDetails_vue.js.LICENSE.txt */
(self.webpackChunkmediadc=self.webpackChunkmediadc||[]).push([["node_modules_moment_locale_sync_recursive_-src_views_CollectorDetails_vue"],{84440:(e,i,n)=>{"use strict";n.d(i,{Z:()=>o});var s=n(88982),a=n(30381),l=n.n(a);const d=[t("mediadc","Photos"),t("mediadc","Videos"),t("mediadc","Photos&Videos")],o={methods:{formatBytes:s.td,parseUnixTimestamp:t=>l().unix(Number(t)).format("YYYY-MM-DD HH:mm:ss"),getStatusBadge:t=>null==t?"":""!==t.errors?"error":0===Number(t.py_pid)&&0===Number(t.finished_time)&&Number(t.updated_time)>0&&Number(t.files_scanned)>0?"terminated":Number(t.py_pid)>0?l()().unix()>Number(t.updated_time)+24?"error":"running":Number(t.finished_time)>0&&0===Number(t.py_pid)?"finished":"pending",parseTargetMtype(t){if(t)try{return d[Number(JSON.parse(t.collector_settings).target_mtype)]}catch{return""}return""}}}},88982:(t,e,i)=>{"use strict";i.d(e,{zW:()=>d,WU:()=>l,td:()=>o});var n=i(79753),s=i(22200),a=i(4820);const l=t=>{if(window.DOMParser){return(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("oc:fileid")[0].innerHTML}return-1},d=async t=>{const e="".concat((0,n.generateRemoteUrl)("dav"),"/files/").concat((0,s.getCurrentUser)().uid).concat(t);return await(0,a.default)({method:"PROPFIND",url:e,data:'<?xml version="1.0"?>\n\t<d:propfind xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns"\n\t\t\t\txmlns:nc="http://nextcloud.org/ns"\n\t\t\t\txmlns:ocs="http://open-collaboration-services.org/ns">\n\t\t<d:prop>\n\t\t\t<oc:fileid />\n\t\t\t<d:getcontenttype />\n\t\t</d:prop>\n\t</d:propfind>',headers:{details:!0,depth:0}})},o=(t,e=2)=>{if(0===t)return"0 B";const i=e<0?0:e,n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(i))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}},74776:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(23645),s=i.n(n)()(!0);s.push([t.id,"\n.file[data-v-0f225859] {\n\tposition: relative;\n}\n.file-thumb[data-v-0f225859] {\n\tdisplay: flex;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\n.file-thumb-loaded[data-v-0f225859] {\n\tdisplay: flex;\n\twidth: 100%;\n}\nimg[data-v-0f225859] {\n\twidth: 100%;\n\theight: auto;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n\tcursor: pointer;\n}\n.updating-blackout[data-v-0f225859] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(0, 0, 0, 0.7);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 5px;\n}\n.placeholder[data-v-0f225859] {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcursor: pointer;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\nbody.theme--dark .placeholder[data-v-0f225859] {\n\tbackground-color: #fff;\n}\n.file-info[data-v-0f225859] {\n\twidth: 100%;\n\tpadding: 5px 10px;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tbackground-color: #000;\n\ttext-align: center;\n\tborder-bottom-left-radius: 5px;\n\tborder-bottom-right-radius: 5px;\n\tcolor: #fff;\n}\n.filename[data-v-0f225859] {\n\twidth: 100%;\n\toverflow-x: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n.delete-file-btn[data-v-0f225859] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tbackground-image: var(--icon-delete-fff);\n}\n.delete-file-btn[data-v-0f225859]:hover {\n\tbackground-color: #eee;\n}\n.delete-file-btn[data-v-0f225859]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .delete-file-btn[data-v-0f225859] {\n\tbackground-image: var(--icon-delete-000);\n}\n.delete-file-btn[data-v-0f225859]:hover, body.theme--dark .delete-file-btn[data-v-0f225859]:hover {\n\tbackground-image: var(--icon-delete-e9322d);\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsFile.vue"],names:[],mappings:";AA0PA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,2BAAA;CACA,4BAAA;AACA;AAEA;CACA,aAAA;CACA,WAAA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,2BAAA;CACA,4BAAA;CACA,eAAA;AACA;AAEA;CACA,kBAAA;CACA,MAAA;CACA,OAAA;CACA,QAAA;CACA,SAAA;CACA,8BAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,kBAAA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,eAAA;CACA,2BAAA;CACA,4BAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,WAAA;CACA,iBAAA;CACA,aAAA;CACA,sBAAA;CACA,mBAAA;CACA,sBAAA;CACA,kBAAA;CACA,8BAAA;CACA,+BAAA;CACA,WAAA;AACA;AAEA;CACA,WAAA;CACA,kBAAA;CACA,uBAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,wCAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,wCAAA;AACA;AAEA;CACA,2CAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class=\"file\" :style=\"'width: ' + detailsGridSize + 'px;'\">\n\t\t<div v-if=\"updating\" class=\"updating-blackout\">\n\t\t\t<span class=\"icon-loading\" />\n\t\t</div>\n\t\t<div class=\"file-thumb\" @click=\"openFile(file)\">\n\t\t\t<div v-show=\"loaded\"\n\t\t\t\tv-if=\"file.filempart === 'image' || (file.filempart === 'video' && file.has_preview)\"\n\t\t\t\tclass=\"file-thumb-loaded\">\n\t\t\t\t<img v-show=\"loaded\"\n\t\t\t\t\t:key=\"file.filepath\"\n\t\t\t\t\t:src=\"imageUrl\"\n\t\t\t\t\t:alt=\"file.filename\"\n\t\t\t\t\t:title=\"file.filepath\"\n\t\t\t\t\t@load=\"onLoad\">\n\t\t\t</div>\n\t\t\t<div v-show=\"!loaded && file.filempart === 'video'\"\n\t\t\t\tclass=\"placeholder\"\n\t\t\t\t:style=\"'min-height: ' + detailsGridSize + 'px'\"\n\t\t\t\t:title=\"file.filepath\">\n\t\t\t\t<svg width=\"50%\"\n\t\t\t\t\theight=\"50%\"\n\t\t\t\t\tversion=\"1.1\"\n\t\t\t\t\tviewBox=\"-31 0 512 512\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t<path d=\"m440.59 206.68h-341.17l327.7-94.93c2.5469-0.73828 4.6953-2.4609 5.9766-4.7812 1.2812-2.3242 1.5859-5.0586 0.84766-7.6055l-17.148-59.199c-6.8516-23.645-28.867-40.16-53.539-40.16-5.1992 0-10.379 0.73828-15.402 2.1914l-307.68 89.129c-14.23 4.1211-26.023 13.582-33.215 26.633-7.1875 13.051-8.875 28.078-4.7539 42.305l16.754 57.836v238.25c0 30.688 24.965 55.652 55.648 55.652h120.16c5.5234 0 10-4.4766 10-10s-4.4766-10-10-10h-120.16c-19.66 0-35.652-15.992-35.652-35.652v-136.09h391.63v136.09c2.1e-4 19.66-15.992 35.652-35.652 35.652h-120.16c-5.5195 0-10 4.4766-10 10s4.4805 10 10 10h120.16c30.688 0 55.652-24.965 55.652-55.652v-239.67c0-5.5234-4.4766-10-10-10zm-176.33 93.586 42.488-73.586h55.262l-42.484 73.586zm-78.359 0 42.488-73.586h55.262l-42.484 73.586zm-78.355 0 42.484-73.586h55.266l-42.488 73.586zm37.18-129.46-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543l71.148 68.336-53.309 15.441c-0.375-0.54688-0.81641-1.0664-1.3125-1.543zm134-125.84 71.148 68.336-53.309 15.441c-0.375-0.54688-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543zm-75.266 21.805 71.148 68.332-53.309 15.445c-0.375-0.54687-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.37891 0.54297 0.81641 1.0625 1.3125 1.543zm149.96-45.367c3.2109-0.92969 6.5195-1.4023 9.8359-1.4023 15.824 0 29.938 10.578 34.328 25.727l14.367 49.59-40.121 11.621c-0.3789-0.54688-0.8164-1.0625-1.3164-1.543l-71.145-68.332zm-328.94 106.2c4.6094-8.3711 12.16-14.434 21.262-17.07l5.875-1.7031c0.37891 0.54688 0.81641 1.0664 1.3125 1.543l71.148 68.336-88.293 25.578-14.367-49.59c-2.6367-9.0976-1.5469-18.719 3.0625-27.094zm14.48 99.074h87.973l-42.484 73.586h-45.488zm303.66 73.586 42.484-73.586h45.488v73.586z\" />\n\t\t\t\t\t<path d=\"m303.92 405.11c0-3.5742-1.9062-6.875-5-8.6602l-87.855-50.723c-3.0938-1.7852-6.9062-1.7852-10 0-3.0938 1.7852-5 5.0859-5 8.6602v101.45c0 3.5703 1.9062 6.8711 5 8.6562 1.5469 0.89453 3.2734 1.3438 5 1.3438 1.7266 0 3.4531-0.44922 5-1.3438l87.855-50.719c3.0938-1.7852 5-5.0859 5-8.6602zm-87.855 33.402v-66.805l57.855 33.402z\" />\n\t\t\t\t\t<path d=\"m234.77 492c-5.5078 0-10 4.4922-10 10s4.4922 10 10 10c5.5117 0 10-4.4922 10-10s-4.4883-10-10-10z\" />\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t\t<div v-show=\"!loaded && file.filempart === 'image'\"\n\t\t\t\tclass=\"placeholder\"\n\t\t\t\t:style=\"'min-height: ' + detailsGridSize + 'px'\"\n\t\t\t\t:title=\"file.filepath\">\n\t\t\t\t<svg width=\"50%\"\n\t\t\t\t\tenable-background=\"new 0 0 512 512\"\n\t\t\t\t\tversion=\"1.1\"\n\t\t\t\t\tviewBox=\"0 0 512 512\"\n\t\t\t\t\txml:space=\"preserve\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t<path d=\"m446.58 0h-381.15c-36.076 0-65.425 29.35-65.425 65.426v381.15c0 36.075 29.349 65.425 65.425 65.425h381.15c36.076 0 65.425-29.35 65.425-65.426v-381.15c0-36.076-29.349-65.426-65.425-65.426zm35.267 446.58c0 19.447-15.821 35.267-35.267 35.267h-381.15c-19.447 0-35.268-15.821-35.268-35.267v-55.007l99.255-84.451c3.622-3.082 8.906-3.111 12.562-0.075l62.174 51.628c5.995 4.977 14.795 4.569 20.304-0.946l147.73-147.95c2.67-2.675 5.783-2.935 7.408-2.852 1.62 0.083 4.695 0.661 7.078 3.596l95.176 117.19v118.87zm0-166.71-71.766-88.366c-7.117-8.764-17.666-14.122-28.942-14.701-11.268-0.57-22.317 3.672-30.294 11.662l-138.01 138.22-51.59-42.839c-14.959-12.422-36.563-12.293-51.373 0.308l-79.712 67.822v-286.55c0-19.447 15.821-35.268 35.268-35.268h381.15c19.447 0 35.267 15.821 35.267 35.268v214.44z\" />\n\t\t\t\t\t<path d=\"m161.17 62.995c-40.095 0-72.713 32.62-72.713 72.713 0 40.094 32.619 72.713 72.713 72.713s72.713-32.619 72.713-72.713-32.618-72.713-72.713-72.713zm0 115.27c-23.466 0-42.556-19.091-42.556-42.556 0-23.466 19.09-42.556 42.556-42.556s42.556 19.091 42.556 42.556-19.09 42.556-42.556 42.556z\" />\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"file-info\">\n\t\t\t<span class=\"filename\" :title=\"file.filepath\">{{ file.filename }}</span>\n\t\t\t<span class=\"owner\">{{ file.fileowner }}</span>\n\t\t\t<span class=\"size\">{{ formatBytes(Number(file.filesize)) }}</span>\n\t\t\t<div class=\"actions\" style=\"display: flex;\">\n\t\t\t\t<CheckboxRadioSwitch class=\"batch-checkbox\"\n\t\t\t\t\t:checked.sync=\"checked\"\n\t\t\t\t\tstyle=\"margin-right: 20px;\" />\n\t\t\t\t<span class=\"delete-file-btn icon-delete-white\" @click=\"deleteGroupFile(file)\" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateRemoteUrl, generateUrl } from '@nextcloud/router'\nimport { mapGetters } from 'vuex'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { emit, subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport { showError, showMessage, showWarning } from '@nextcloud/dialogs'\nimport Formats from '../../mixins/Formats'\nimport CheckboxRadioSwitch from '@nextcloud/vue/dist/Components/CheckboxRadioSwitch'\n\nexport default {\n\tname: 'DetailsFile',\n\tcomponents: { CheckboxRadioSwitch },\n\tmixins: [Formats],\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tallFiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcheckedFiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloaded: false,\n\t\t\tchecked: false,\n\t\t\tupdating: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'detailsGridSize',\n\t\t\t'deleteFileConfirmation',\n\t\t\t'details',\n\t\t]),\n\t\timageUrl() {\n\t\t\tif (this.file.has_preview) {\n\t\t\t\treturn generateUrl(`/core/preview?fileId=${this.file.fileid}&x=${this.detailsGridSize}&y=${this.detailsGridSize}$forceIcon=0`)\n\t\t\t} else {\n\t\t\t\treturn generateRemoteUrl(`dav/files${this.file.filepath.replace('files/', '')}`)\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tchecked() {\n\t\t\tconst newCheckedFiles = this.checkedFiles\n\t\t\tconst fileIndex = newCheckedFiles.findIndex(f => f.fileid === this.file.fileid)\n\t\t\tif (this.checked) {\n\t\t\t\tif (fileIndex === -1) {\n\t\t\t\t\tnewCheckedFiles.push(this.file)\n\t\t\t\t}\n\t\t\t} else if (fileIndex !== -1) {\n\t\t\t\tnewCheckedFiles.splice(fileIndex, 1)\n\t\t\t}\n\t\t\tthis.$emit('update:checkedFiles', newCheckedFiles)\n\t\t},\n\t\tcheckedFiles() {\n\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === this.file.fileid)\n\t\t\tif (!this.checked && fileIndex !== -1) {\n\t\t\t\tthis.checked = true\n\t\t\t}\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tconst fileIndexChecked = this.checkedFiles.findIndex(f => f.fileid === this.file.fileid)\n\t\tthis.checked = fileIndexChecked !== -1\n\t\tsubscribe('deselectFiles', this.deselect)\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('deselectFiles', this.deselect)\n\t},\n\tmethods: {\n\t\topenFile(file) {\n\t\t\tconst filesList = this.files.map(file => ({\n\t\t\t\tbasename: file.filename,\n\t\t\t\tfileid: file.fileid,\n\t\t\t\tfilename: file.filepath.replace(`/${getCurrentUser().uid}/files`, ''),\n\t\t\t\tgetcontentlength: file.filesize,\n\t\t\t\tgetcontenttype: file.filemtype,\n\t\t\t\tmime: file.filemtype,\n\t\t\t\tsize: file.filesize,\n\t\t\t}))\n\t\t\tOCA.Viewer.open({\n\t\t\t\tpath: file.filepath.replace(`/${getCurrentUser().uid}/files`, ''),\n\t\t\t\tlist: filesList.map(file => ({\n\t\t\t\t\t...file,\n\t\t\t\t\tlist: filesList,\n\t\t\t\t})),\n\t\t\t})\n\t\t},\n\t\tonLoad() {\n\t\t\tthis.loaded = true\n\t\t},\n\t\tdeleteGroupFile(file) {\n\t\t\tif (this.deleteFileConfirmation) {\n\t\t\t\tif (confirm(t('mediadc', 'Are you sure, you want delete this file?'))) {\n\t\t\t\t\tthis._deleteGroupFile(file)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._deleteGroupFile(file)\n\t\t\t}\n\t\t},\n\t\t_deleteGroupFile(file) {\n\t\t\tthis.updating = true\n\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.id}/${file.fileid}`))\n\t\t\t\t.then(res => {\n\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\tconst files = this.files\n\t\t\t\t\t\tif (this.allFiles.length === 2) { // Remove detail when 1 file left\n\t\t\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\t\t\tthis.$store.dispatch('deleteDetail', this.detail)\n\t\t\t\t\t\t\tshowMessage(this.t('mediadc', 'Group successfully removed (1 file left)'))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst fileidIndex = files.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\t\tfiles.splice(fileidIndex, 1)\n\t\t\t\t\t\tconst checkedIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\t\tif (this.checked && checkedIndex !== -1) {\n\t\t\t\t\t\t\tconst newCheckedFiles = this.checkedFiles\n\t\t\t\t\t\t\tnewCheckedFiles.splice(checkedIndex, 1)\n\t\t\t\t\t\t\tthis.$emit('update:checkedFiles', newCheckedFiles)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.$emit('update:files', files)\n\t\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\t\tthis.$store.dispatch('setTask', res.data.task).then(() => {\n\t\t\t\t\t\t\temit('updateGroupFilesPagination', this.file)\n\t\t\t\t\t\t})\n\t\t\t\t\t} else if ('locked' in res.data && res.data.locked) {\n\t\t\t\t\t\tshowWarning(this.t('mediadc', 'Wait until file loaded before deleting'))\n\t\t\t\t\t} else if ('not_permited' in res.data && res.data.not_permited) {\n\t\t\t\t\t\tshowError(this.t('mediadc', 'Not enough permitions to delete file'))\n\t\t\t\t\t} else if ('not_found' in res.data && res.data.not_found) {\n\t\t\t\t\t\tshowError(this.t('mediadc', 'File not found. Probably it\\'s already deleted'))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowError(this.t('mediadc', 'Some error occured while deleting file'))\n\t\t\t\t\t}\n\t\t\t\t\tthis.updating = false\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tconsole.debug(err)\n\t\t\t\t\tshowError(this.t('mediadc', 'Some error occured while deleting file'))\n\t\t\t\t\tthis.updating = false\n\t\t\t\t})\n\t\t},\n\t\tdeselect(filesToDeselect) {\n\t\t\tif (this.checked && filesToDeselect.map(f => f.fileid).includes(this.file.fileid)) {\n\t\t\t\tthis.checked = false\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.file {\n\tposition: relative;\n}\n\n.file-thumb {\n\tdisplay: flex;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\n\n.file-thumb-loaded {\n\tdisplay: flex;\n\twidth: 100%;\n}\n\nimg {\n\twidth: 100%;\n\theight: auto;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n\tcursor: pointer;\n}\n\n.updating-blackout {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(0, 0, 0, 0.7);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 5px;\n}\n\n.placeholder {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcursor: pointer;\n\tborder-top-left-radius: 5px;\n\tborder-top-right-radius: 5px;\n}\n\nbody.theme--dark .placeholder {\n\tbackground-color: #fff;\n}\n\n.file-info {\n\twidth: 100%;\n\tpadding: 5px 10px;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tbackground-color: #000;\n\ttext-align: center;\n\tborder-bottom-left-radius: 5px;\n\tborder-bottom-right-radius: 5px;\n\tcolor: #fff;\n}\n\n.filename {\n\twidth: 100%;\n\toverflow-x: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.delete-file-btn {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tbackground-image: var(--icon-delete-fff);\n}\n\n.delete-file-btn:hover {\n\tbackground-color: #eee;\n}\n\n.delete-file-btn:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .delete-file-btn {\n\tbackground-image: var(--icon-delete-000);\n}\n\n.delete-file-btn:hover, body.theme--dark .delete-file-btn:hover {\n\tbackground-image: var(--icon-delete-e9322d);\n}\n</style>\n"],sourceRoot:""}]);const a=s},30144:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(23645),s=i.n(n)()(!0);s.push([t.id,"\n.details-group[data-v-287ce272] {\n\twidth: 100%;\n\tborder-top: 1px solid #dadada;\n\tborder-bottom: 1px solid #dadada;\n\tmargin: 10px 0;\n}\nbody.theme--dark .details-group[data-v-287ce272] {\n\tborder-color: #717171;\n}\n.details-group-files[data-v-287ce272] {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: center;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n.file[data-v-287ce272] {\n\tdisplay: flex;\n\theight: 100%;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\twidth: 192px;\n\tborder-radius: 5px;\n\tborder: 1px solid #dadada;\n\ttransition: box-shadow .3s;\n\tmargin: 10px;\n}\nbody.theme--dark .file[data-v-287ce272] {\n\tborder-color: #717171;\n}\n@media (max-width: 540px) {\n.file[data-v-287ce272] {\n\t\tmax-width: 192px;\n}\n.filters[data-v-287ce272] {\n\t\tflex-direction: column;\n}\n}\n.file[data-v-287ce272]:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .25);\n}\n.filters[data-v-287ce272] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\n.search[data-v-287ce272] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.sorting[data-v-287ce272] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.sorting-group-files-btn[data-v-287ce272] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tmargin: 0 5px;\n\tcursor: pointer;\n}\n.sorting-group-files-btn[data-v-287ce272]:hover {\n\tbackground-color: #eee;\n}\n.sorting-group-files-btn[data-v-287ce272]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .sorting-group-files-btn[data-v-287ce272]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .sorting-group-files-btn[data-v-287ce272]:active {\n\tbackground-color: #5b5b5b;\n}\n.batch-editing[data-v-287ce272] {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.batch-actions-menu-button[data-v-287ce272] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n.batch-actions-menu-button[data-v-287ce272]:hover {\n\tbackground-color: #eee;\n}\n.batch-actions-menu-button[data-v-287ce272]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .batch-actions-menu-button[data-v-287ce272]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .batch-actions-menu-button[data-v-287ce272]:active {\n\tbackground-color: #5b5b5b;\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsGroupList.vue"],names:[],mappings:";AAqUA;CACA,WAAA;CACA,6BAAA;CACA,gCAAA;CACA,cAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,aAAA;CACA,eAAA;CACA,uBAAA;CACA,iBAAA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,YAAA;CACA,sBAAA;CACA,8BAAA;CACA,YAAA;CACA,kBAAA;CACA,yBAAA;CACA,0BAAA;CACA,YAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;AACA;EACA,gBAAA;AACA;AAEA;EACA,sBAAA;AACA;AACA;AAEA;CACA,yCAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,iBAAA;CACA,cAAA;CACA,yBAAA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,aAAA;CACA,eAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,kBAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,eAAA;CACA,iBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-if=\"!loadingFiles\" class=\"details-group\">\n\t\t<div class=\"filters\">\n\t\t\t<div class=\"sorting\">\n\t\t\t\t{{ t('mediadc', 'Files size sorting') }}\n\t\t\t\t<span :class=\"filesAscending ? 'icon-triangle-s sorting-group-files-btn' : 'icon-triangle-n sorting-group-files-btn'\" @click=\"updateFileSorting\" />\n\t\t\t</div>\n\t\t\t<div class=\"search\">\n\t\t\t\t<label for=\"filename-filter\">\n\t\t\t\t\t{{ t('mediadc', 'Filter by filename: ') }}\n\t\t\t\t\t<input id=\"filename-filter\"\n\t\t\t\t\t\tv-model=\"filterFileName\"\n\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\tname=\"filename-filter\"\n\t\t\t\t\t\t:placeholder=\"t('mediadc', 'Filename or part')\"\n\t\t\t\t\t\t@input=\"filterByFileName\">\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div v-if=\"checkedFiles.length > 0\" class=\"batch-editing\">\n\t\t\t\t{{ translatePlural('mediadc', 'Batch actions for %n file', 'Batch actions for %n files', checkedFiles.length) }}\n\t\t\t\t<div class=\"app-content-list-menu\" style=\"margin: 0 0 0 10px; position: relative;\">\n\t\t\t\t\t<div class=\"icon-more batch-actions-menu-button\" @click=\"openBatchActionsPopup\" />\n\t\t\t\t\t<div :class=\"batchActionsOpened ? 'popovermenu open' : 'popovermenu'\"\n\t\t\t\t\t\tstyle=\"right: -1px;\">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a class=\"icon-checkmark\" @click=\"selectAllFiles\">\n\t\t\t\t\t\t\t\t\t<span>{{ checkedFiles.length === allFiles.length ? t('mediadc', 'Deselect all') : t('mediadc', 'Select all') }}</span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li v-if=\"JSON.parse(detail.group_files_ids).length > groupItemsPerPage\">\n\t\t\t\t\t\t\t\t<a class=\"icon-checkmark\" @click=\"selectAllFilesOnPage\">\n\t\t\t\t\t\t\t\t\t<span>{{ checkedFilesIntersect.length === files.length ? t('mediadc', 'Deselect all on page') : t('mediadc', 'Select all on page') }}</span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a class=\"icon-close\" :title=\"t('mediadc', 'Remove without deleting')\" @click=\"removeCheckedFiles\">\n\t\t\t\t\t\t\t\t\t<span>{{ translatePlural('mediadc', 'Remove file', 'Remove files', checkedFiles.length) }}</span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a class=\"icon-delete\" @click=\"deleteCheckedFiles\">\n\t\t\t\t\t\t\t\t\t<span>{{ translatePlural('mediadc', 'Delete file', 'Delete files', checkedFiles.length) }}</span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"!filesFiltered\" class=\"details-group-files\">\n\t\t\t<DetailsFile\n\t\t\t\tv-for=\"file in files\"\n\t\t\t\t:key=\"file.fileid\"\n\t\t\t\t:file=\"file\"\n\t\t\t\t:files=\"files\"\n\t\t\t\t:all-files=\"allFiles\"\n\t\t\t\t:checked-files.sync=\"checkedFiles\"\n\t\t\t\t:detail=\"detail\" />\n\t\t</div>\n\t\t<div v-else-if=\"filteredFiles.length > 0\" class=\"details-group-files\">\n\t\t\t<DetailsFile\n\t\t\t\tv-for=\"file in filteredFiles\"\n\t\t\t\t:key=\"file.fileid\"\n\t\t\t\t:file=\"file\"\n\t\t\t\t:files=\"files\"\n\t\t\t\t:all-files=\"allFiles\"\n\t\t\t\t:checked-files.sync=\"checkedFiles\"\n\t\t\t\t:detail=\"detail\" />\n\t\t</div>\n\t\t<div v-else class=\"details-group-files\">\n\t\t\t<p style=\"margin: 0 0 10px;\">\n\t\t\t\t{{ t('mediadc', 'No matches on this page') }}\n\t\t\t</p>\n\t\t</div>\n\t</div>\n\t<div v-else>\n\t\t<span class=\"icon-loading\" style=\"width: 20px; height: 20px; display: flex; margin: 20px auto;\" />\n\t</div>\n</template>\n\n<script>\nimport Formats from '../../mixins/Formats'\nimport { mapGetters } from 'vuex'\nimport DetailsFile from './DetailsFile'\nimport { showError, showMessage, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { generateUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\nimport { emit } from '@nextcloud/event-bus'\n\nexport default {\n\tname: 'DetailsGroupList',\n\tcomponents: { DetailsFile },\n\tmixins: [Formats],\n\tprops: {\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tallFiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tloadingFiles: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tupdating: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tfilesAscending: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tcheckedFiles: [],\n\t\t\tbatchActionsOpened: false,\n\t\t\tfilesFiltered: false,\n\t\t\tfilterFileName: '',\n\t\t\tfilteredFiles: [],\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'detailsGridSize',\n\t\t\t'deleteFileConfirmation',\n\t\t\t'groupItemsPerPage',\n\t\t\t'details',\n\t\t]),\n\t\tcheckedFilesIntersect() {\n\t\t\tconst a = new Set(this.files)\n\t\t\tconst b = new Set(this.checkedFiles)\n\t\t\tconst intersect = new Set([...a].filter(i => b.has(i)))\n\t\t\treturn Array.from(intersect)\n\t\t},\n\t},\n\twatch: {\n\t\tfiles() {\n\t\t\tthis.filterByFileName()\n\t\t},\n\t},\n\tmethods: {\n\t\topenBatchActionsPopup() {\n\t\t\tdocument.addEventListener('click', this.toggleBatchActionsPopup)\n\t\t},\n\t\ttoggleBatchActionsPopup() {\n\t\t\tif (this.batchActionsOpened) {\n\t\t\t\tdocument.removeEventListener('click', this.toggleBatchActionsPopup)\n\t\t\t}\n\t\t\tthis.batchActionsOpened = !this.batchActionsOpened\n\t\t},\n\t\tselectAllFiles() {\n\t\t\tif (this.checkedFiles.length === this.allFiles.length) { // Deselect files\n\t\t\t\temit('deselectFiles', this.checkedFiles)\n\t\t\t\tfor (const file of this.allFiles) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tif (fileIndex !== -1) {\n\t\t\t\t\t\tthis.checkedFiles.splice(fileIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const file of this.allFiles) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tif (fileIndex === -1) {\n\t\t\t\t\t\tthis.checkedFiles.push(file)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tselectAllFilesOnPage() {\n\t\t\tif (this.files.length === this.checkedFilesIntersect.length) {\n\t\t\t\tconst filesToDeselect = this.checkedFilesIntersect\n\t\t\t\temit('deselectFiles', filesToDeselect)\n\t\t\t\tfor (const fileid of filesToDeselect.map(f => f.fileid)) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\t\tif (fileIndex !== -1) {\n\t\t\t\t\t\tthis.checkedFiles.splice(fileIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const file of this.files) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tif (fileIndex === -1) {\n\t\t\t\t\t\tthis.checkedFiles.push(file)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tremoveCheckedFiles() {\n\t\t\tthis.$emit('update:updating', true)\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.id}/remove`), { fileIds: this.checkedFiles.map(f => f.fileid) }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\tconst allFiles = this.allFiles\n\t\t\t\t\tif ((this.allFiles.length - this.checkedFiles.length) <= 1) {\n\t\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\t\t// Remove detail\n\t\t\t\t\t\tthis.$store.dispatch('deleteDetail', this.detail)\n\t\t\t\t\t\tif ((this.allFiles.length - this.checkedFiles.length) === 1) {\n\t\t\t\t\t\t\tshowMessage(this.t('mediadc', 'Group successfully removed (1 file left)'))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const fileid of res.data.removedFileIds) {\n\t\t\t\t\t\tconst fileidIndex = allFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\t\t\tallFiles.splice(fileidIndex, 1)\n\t\t\t\t\t\tconst checkedFileIdIndex = this.checkedFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\t\t\tif (checkedFileIdIndex !== -1) {\n\t\t\t\t\t\t\tthis.checkedFiles.splice(checkedFileIdIndex, 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\tthis.$emit('update:allFiles', allFiles)\n\t\t\t\t\temit('updateGroupFilesPagination')\n\t\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Checked files successfully removed'))\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.debug(err)\n\t\t\t\tshowError(this.t('mediadc', 'Some server error occured'))\n\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t})\n\t\t},\n\t\tdeleteCheckedFiles() {\n\t\t\tif (this.allFiles.length === this.checkedFiles.length) {\n\t\t\t\tif (confirm(this.t('mediadc', 'Are you sure, you want delete all files'))) {\n\t\t\t\t\tthis._deleteCheckedFiles()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._deleteCheckedFiles()\n\t\t\t}\n\t\t},\n\t\t_deleteCheckedFiles() {\n\t\t\tthis.$emit('update:updating', true)\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.id}/delete`), { fileIds: this.checkedFiles.map(f => f.fileid) }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\tthis._updateDeletedFiles(res)\n\t\t\t\t} else if (!res.data.success && res.data.deletedFileIds.length > 0) {\n\t\t\t\t\tshowWarning(this.t('mediadc', 'Not all files deleted'))\n\t\t\t\t\tthis._updateDeletedFiles(res)\n\t\t\t\t} else {\n\t\t\t\t\tconsole.debug(res.data.errors)\n\t\t\t\t\tshowError(this.t('mediadc', 'Some server error occured. Files not deleted'))\n\t\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.debug(err)\n\t\t\t\tshowError(this.t('mediadc', 'Some server error occured'))\n\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t})\n\t\t},\n\t\t_updateDeletedFiles(res) {\n\t\t\tconst allFiles = this.allFiles\n\t\t\tif ((this.allFiles.length - this.checkedFiles.length) <= 1 && res.data.deletedFileIds.length === this.checkedFiles.length) {\n\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t// Remove detail\n\t\t\t\tthis.$store.dispatch('deleteDetail', this.detail)\n\t\t\t\tif ((this.allFiles.length - this.checkedFiles.length) === 1) {\n\t\t\t\t\tshowMessage(this.t('mediadc', 'Group successfully removed (1 file left)'))\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const fileid of res.data.deletedFileIds) {\n\t\t\t\tconst fileidIndex = allFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\tallFiles.splice(fileidIndex, 1)\n\t\t\t\tconst checkedFileIdIndex = this.checkedFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\tif (checkedFileIdIndex !== -1) {\n\t\t\t\t\tthis.checkedFiles.splice(checkedFileIdIndex, 1)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\temit('updateTaskInfo')\n\t\t\tthis.$emit('update:allFiles', allFiles)\n\t\t\temit('updateGroupFilesPagination')\n\t\t\tthis.$emit('update:updating', false)\n\t\t\tshowSuccess(this.t('mediadc', 'Checked files successfully deleted'))\n\t\t},\n\t\tfilterByFileName() {\n\t\t\tif (this.filterFileName !== '') {\n\t\t\t\tthis.filesFiltered = true\n\t\t\t\tthis.filteredFiles = this.files.filter(f => f.filename.toLowerCase().includes(this.filterFileName.toLowerCase()))\n\t\t\t} else {\n\t\t\t\tthis.filesFiltered = false\n\t\t\t\tthis.filteredFiles = []\n\t\t\t}\n\t\t},\n\t\tupdateFileSorting() {\n\t\t\tthis.$emit('update:filesAscending', !this.filesAscending)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.details-group {\n\twidth: 100%;\n\tborder-top: 1px solid #dadada;\n\tborder-bottom: 1px solid #dadada;\n\tmargin: 10px 0;\n}\n\nbody.theme--dark .details-group {\n\tborder-color: #717171;\n}\n\n.details-group-files {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: center;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n\n.file {\n\tdisplay: flex;\n\theight: 100%;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\twidth: 192px;\n\tborder-radius: 5px;\n\tborder: 1px solid #dadada;\n\ttransition: box-shadow .3s;\n\tmargin: 10px;\n}\n\nbody.theme--dark .file {\n\tborder-color: #717171;\n}\n\n@media (max-width: 540px) {\n\t.file {\n\t\tmax-width: 192px;\n\t}\n\n\t.filters {\n\t\tflex-direction: column;\n\t}\n}\n\n.file:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .25);\n}\n\n.filters {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\n\n.search {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.sorting {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.sorting-group-files-btn {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tmargin: 0 5px;\n\tcursor: pointer;\n}\n\n.sorting-group-files-btn:hover {\n\tbackground-color: #eee;\n}\n\n.sorting-group-files-btn:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .sorting-group-files-btn:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .sorting-group-files-btn:active {\n\tbackground-color: #5b5b5b;\n}\n\n.batch-editing {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.batch-actions-menu-button {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n\n.batch-actions-menu-button:hover {\n\tbackground-color: #eee;\n}\n\n.batch-actions-menu-button:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .batch-actions-menu-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .batch-actions-menu-button:active {\n\tbackground-color: #5b5b5b;\n}\n</style>\n"],sourceRoot:""}]);const a=s},23803:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(23645),s=i.n(n)()(!0);s.push([t.id,"\n.task-details[data-v-6970fd5d] {\n\twidth: 100%;\n\tpadding: 20px 10px 20px 20px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\toverflow-y: scroll;\n\tmargin: 0 auto;\n}\n.task-details-heading[data-v-6970fd5d] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n.action-blackout[data-v-6970fd5d] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tz-index: 999;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 5px;\n}\n.task-details-heading h3[data-v-6970fd5d] {\n\tmargin: 0;\n}\n@media (max-width: 540px) {\n.task-details-heading[data-v-6970fd5d] {\n\t\tflex-direction: column;\n\t\ttext-align: center;\n}\n}\n.pagination[data-v-6970fd5d] {\n\tdisplay: flex;\n\talign-items: center;\n\t/* margin: 10px 0; */\n}\n.pagination-button[data-v-6970fd5d] {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n.sorting[data-v-6970fd5d] {\n\tdisplay: flex;\n}\n.toggle-sorting-button[data-v-6970fd5d] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n\tcursor: pointer;\n}\n.pagination-button[data-v-6970fd5d]:hover, .toggle-sorting-button[data-v-6970fd5d]:hover {\n\tbackground-color: #eee;\n}\n.pagination-button[data-v-6970fd5d]:active, .toggle-sorting-button[data-v-6970fd5d]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .pagination-button[data-v-6970fd5d]:hover, body.theme--dark .toggle-sorting-button[data-v-6970fd5d]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .pagination-button[data-v-6970fd5d]:active, body.theme--dark .toggle-sorting-button[data-v-6970fd5d]:active {\n\tbackground-color: #5b5b5b;\n}\nbody.theme--dark .task-details[data-v-6970fd5d] {\n\tborder-color: #717171;\n}\n.task-details-row[data-v-6970fd5d] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tborder: 1px solid #dedede;\n\tborder-radius: 5px;\n\tmargin-bottom: 5px;\n\ttransition: height .3s;\n}\n.filters[data-v-6970fd5d] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\nbody.theme--dark .task-details-row[data-v-6970fd5d], body.theme--dark .filters[data-v-6970fd5d] {\n\tborder-color: #717171;\n}\n@media (max-width: 540px) {\n.filters[data-v-6970fd5d] {\n\t\tflex-direction: column;\n}\n}\n.batch-editing[data-v-6970fd5d] {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.batch-actions-menu-button[data-v-6970fd5d] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n.batch-actions-menu-button[data-v-6970fd5d]:hover {\n\tbackground-color: #eee;\n}\n.batch-actions-menu-button[data-v-6970fd5d]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .batch-actions-menu-button[data-v-6970fd5d]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .batch-actions-menu-button[data-v-6970fd5d]:active {\n\tbackground-color: #5b5b5b;\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsList.vue"],names:[],mappings:";AA4TA;CACA,WAAA;CACA,4BAAA;CACA,yBAAA;CACA,kBAAA;CACA,kBAAA;CACA,cAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;AACA;AAEA;CACA,kBAAA;CACA,MAAA;CACA,OAAA;CACA,QAAA;CACA,SAAA;CACA,oCAAA;CACA,YAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,kBAAA;AACA;AAEA;CACA,SAAA;AACA;AAEA;AACA;EACA,sBAAA;EACA,kBAAA;AACA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,oBAAA;AACA;AAEA;CACA,aAAA;CACA,aAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,kBAAA;CACA,iBAAA;AACA;AAEA;CACA,aAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,iBAAA;CACA,eAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,yBAAA;CACA,kBAAA;CACA,kBAAA;CACA,sBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,iBAAA;CACA,cAAA;CACA,yBAAA;CACA,kBAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;AACA;EACA,sBAAA;AACA;AACA;AAEA;CACA,kBAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,eAAA;CACA,iBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class=\"task-details\">\n\t\t<div class=\"task-details-heading\">\n\t\t\t<h3>\n\t\t\t\t{{ t('mediadc', 'Duplicates list') }}\n\t\t\t\t<span v-if=\"getStatusBadge(task) === 'finished'\">\n\t\t\t\t\t- {{ details.length }} {{ translatePlural('mediadc', 'group, ', 'groups', details.length) }}\n\t\t\t\t\t({{ filestotal }} {{ translatePlural('mediadc', 'file', 'files', filestotal) }} - {{ formatBytes(filessize) }})\n\t\t\t\t</span>\n\t\t\t</h3>\n\t\t\t<div class=\"pagination\">\n\t\t\t\t<CheckboxRadioSwitch :checked.sync=\"sortGroups\" style=\"margin-right: 20px;\">\n\t\t\t\t\t{{ t('mediadc', 'Sort groups') }}\n\t\t\t\t</CheckboxRadioSwitch>\n\t\t\t\t<span :class=\"!sorted ? 'icon-triangle-s toggle-sorting-button' : 'icon-triangle-n toggle-sorting-button'\"\n\t\t\t\t\t:title=\"t('mediadc', 'Sorting details by files count')\"\n\t\t\t\t\t@click=\"toggleSorting\" />\n\t\t\t\t<span v-if=\"details.length > itemsPerPage\"\n\t\t\t\t\tclass=\"icon-view-previous pagination-button\"\n\t\t\t\t\t@click=\"prevGroupsPage()\" />\n\t\t\t\t<span v-if=\"details.length > itemsPerPage\">{{ t('mediadc', 'Page:') }}&nbsp;</span>\n\t\t\t\t<span v-if=\"details.length > itemsPerPage\">{{ page + 1 }}/{{ Math.ceil(details.length / itemsPerPage) }}</span>\n\t\t\t\t<span v-if=\"details.length > itemsPerPage\" class=\"icon-view-next pagination-button\" @click=\"nextGroupsPage()\" />\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"details.length > 0\">\n\t\t\t<div class=\"filters\">\n\t\t\t\t<label for=\"group-id-filter\">\n\t\t\t\t\t{{ t('mediadc', 'Filter by duplicate group id: ') }}\n\t\t\t\t\t<input id=\"group-id-filter\"\n\t\t\t\t\t\tv-model=\"filterId\"\n\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\tname=\"group-id-filter\"\n\t\t\t\t\t\tplaceholder=\"#id\"\n\t\t\t\t\t\t@input=\"filterByGroupId\">\n\t\t\t\t</label>\n\t\t\t\t<div v-if=\"checkedDetailGroups.length > 0\" class=\"batch-editing\">\n\t\t\t\t\t{{ translatePlural('mediadc', 'Batch actions for %n group', 'Batch actions for %n groups', checkedDetailGroups.length) }}\n\t\t\t\t\t<div class=\"app-content-list-menu\" style=\"margin: 0 0 0 10px; position: relative;\">\n\t\t\t\t\t\t<div class=\"icon-more batch-actions-menu-button\" @click=\"openBatchActionsPopup\" />\n\t\t\t\t\t\t<div :class=\"batchActionsOpened ? 'popovermenu open' : 'popovermenu'\"\n\t\t\t\t\t\t\tstyle=\"right: -1px;\">\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-checkmark\" @click=\"selectAllGroups\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ checkedDetailGroups.length === details.length ? t('mediadc', 'Deselect all') : t('mediadc', 'Select all') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li v-if=\"details.length > itemsPerPage\">\n\t\t\t\t\t\t\t\t\t<a class=\"icon-checkmark\" @click=\"selectAllGroupsOnPage\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ checkedDetailGroupsIntersect.length === paginatedDetails[page].length ? t('mediadc', 'Deselect all on page') : t('mediadc', 'Select all on page') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-close\" @click=\"removeCheckedGroups\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ translatePlural('mediadc', 'Remove group', 'Remove groups', checkedDetailGroups.length) }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"batchUpdating\" class=\"action-blackout\">\n\t\t\t\t<span class=\"icon-loading\" />\n\t\t\t</div>\n\t\t\t<div v-else-if=\"detailsFiltered === undefined || (detailsFiltered.length === 0 && (filterId === '' || filterId === null))\">\n\t\t\t\t<template v-if=\"sortGroups\">\n\t\t\t\t\t<div v-for=\"detail in paginatedSortedDetails[page]\"\n\t\t\t\t\t\tv-show=\"JSON.parse(detail.group_files_ids).length > 1\"\n\t\t\t\t\t\t:key=\"detail.id\"\n\t\t\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t\t\t<DetailsListItem :detail=\"detail\" :checked-detail-groups.sync=\"checkedDetailGroups\" />\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div v-for=\"detail in paginatedDetails[page]\"\n\t\t\t\t\t\tv-show=\"JSON.parse(detail.group_files_ids).length > 1\"\n\t\t\t\t\t\t:key=\"detail.id\"\n\t\t\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t\t\t<DetailsListItem :detail=\"detail\" :checked-detail-groups.sync=\"checkedDetailGroups\" />\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div v-else-if=\"detailsFiltered.length > 0\">\n\t\t\t\t<div v-for=\"detail in detailsFiltered\"\n\t\t\t\t\tv-show=\"JSON.parse(detail.group_files_ids).length > 1\"\n\t\t\t\t\t:key=\"detail.id\"\n\t\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t\t<DetailsListItem :detail=\"detail\" :checked-detail-groups.sync=\"checkedDetailGroups\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<p style=\"text-align: center; font-weight: bold;\">\n\t\t\t\t\t{{ t('mediadc', 'No matching found') }}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else style=\"margin-top: 10px;\">\n\t\t\t<strong>{{ t('mediadc', 'No duplicates found.') }}</strong>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport { showError, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { mapGetters } from 'vuex'\nimport Formats from '../../mixins/Formats'\nimport DetailsListItem from './DetailsListItem'\nimport { subscribe, unsubscribe, emit } from '@nextcloud/event-bus'\nimport CheckboxRadioSwitch from '@nextcloud/vue/dist/Components/CheckboxRadioSwitch'\n\nexport default {\n\tname: 'DetailsList',\n\tcomponents: { DetailsListItem, CheckboxRadioSwitch },\n\tmixins: [Formats],\n\tprops: {\n\t\tfilessize: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tfilestotal: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tpage: 0,\n\t\t\tfilterId: null,\n\t\t\tcheckedDetailGroups: [],\n\t\t\tbatchActionsOpened: false,\n\t\t\tbatchActionResult: null,\n\t\t\tbatchUpdating: false,\n\t\t\tsortGroups: true,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'details',\n\t\t\t'sortedDetails',\n\t\t\t'sorted',\n\t\t\t'paginatedDetails',\n\t\t\t'paginatedSortedDetails',\n\t\t\t'itemsPerPage',\n\t\t\t'detailsFiltered',\n\t\t\t'autoOpenNextGroup',\n\t\t]),\n\t\tcheckedDetailGroupsIntersect() {\n\t\t\tconst a = new Set(this.paginatedDetails[this.page].map(d => d.id))\n\t\t\tconst b = new Set(this.checkedDetailGroups.map(d => d.id))\n\t\t\tconst intersect = new Set([...a].filter(i => b.has(i)))\n\t\t\treturn Array.from(intersect)\n\t\t},\n\t},\n\twatch: {\n\t\titemsPerPage(newItemsPerPage) {\n\t\t\tif (this.page >= Math.ceil(this.details.length / newItemsPerPage)) {\n\t\t\t\tthis.page = Math.ceil(this.details.length / newItemsPerPage) - 1\n\t\t\t}\n\t\t},\n\t\tdetails(newDetails) {\n\t\t\tif (this.page >= Math.ceil(newDetails.length / this.itemsPerPage)) {\n\t\t\t\tthis.page = Math.ceil(newDetails.length / this.itemsPerPage) - 1\n\t\t\t}\n\t\t},\n\t\tsortGroups() {\n\t\t\twindow.localStorage.setItem('mediadc_details_sort_groups', this.sortGroups)\n\t\t\tthis.$store.dispatch('setSortGroups', this.sortGroups)\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tthis.$emit('update:loading', false)\n\t\tconst sortGroups = window.localStorage.getItem('mediadc_details_sort_groups')\n\t\tthis.sortGroups = sortGroups !== null ? JSON.parse(sortGroups) === true : true\n\t\tthis.$store.dispatch('setSortGroups', sortGroups !== null ? JSON.parse(sortGroups) === true : true)\n\t\tsubscribe('openNextDetailGroup', this.openNextDetailGroup)\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('openNextDetailGroup', this.openNextDetailGroup)\n\t},\n\tmethods: {\n\t\tprevGroupsPage() {\n\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page -= 1\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'First page reached!'))\n\t\t\t}\n\t\t},\n\t\tnextGroupsPage() {\n\t\t\tif (this.page < Math.ceil(this.details.length / this.itemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'Last page reached!'))\n\t\t\t}\n\t\t},\n\t\ttoggleSorting() {\n\t\t\tthis.$store.dispatch('setSorted', !this.sorted)\n\t\t},\n\t\tfilterByGroupId() {\n\t\t\tif (this.filterId !== null && this.filterId !== '') {\n\t\t\t\tthis.$store.dispatch('setDetailsFiltered', this.details.filter(d => d.id.toString().includes(this.filterId)))\n\t\t\t} else {\n\t\t\t\tthis.$store.dispatch('setDetailsFiltered', [])\n\t\t\t}\n\t\t},\n\t\topenBatchActionsPopup() {\n\t\t\tdocument.addEventListener('click', this.toggleBatchActionsPopup)\n\t\t},\n\t\ttoggleBatchActionsPopup() {\n\t\t\tif (this.batchActionsOpened) {\n\t\t\t\tdocument.removeEventListener('click', this.toggleBatchActionsPopup)\n\t\t\t}\n\t\t\tthis.batchActionsOpened = !this.batchActionsOpened\n\t\t},\n\t\tremoveCheckedGroups() {\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.task.id}/details/remove`), { taskDetailIds: this.checkedDetailGroups.map(d => d.id) }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\tconst updatedDetails = this.details\n\t\t\t\t\tfor (const taskDetail of res.data.removedTaskDetails) {\n\t\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.id === taskDetail.id)\n\t\t\t\t\t\tthis.checkedDetailGroups.splice(detailIndex, 1)\n\t\t\t\t\t\tconst removedDetailIndex = updatedDetails.findIndex(d => d.id === taskDetail.id)\n\t\t\t\t\t\tupdatedDetails.splice(removedDetailIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t\tthis.$store.dispatch('setDetails', updatedDetails)\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Selected groups successfully removed'))\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tshowError(this.t('mediadc', 'Some server error occured'))\n\t\t\t\tconsole.debug(err)\n\t\t\t})\n\t\t},\n\t\tselectAllGroups() {\n\t\t\tif (this.checkedDetailGroups.length === this.details.length) {\n\t\t\t\temit('deselectGroups', this.checkedDetailGroups.map(d => d.id))\n\t\t\t\tfor (const detail of this.details) {\n\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.id === detail.id)\n\t\t\t\t\tif (detailIndex !== -1) {\n\t\t\t\t\t\tthis.checkedDetailGroups.splice(detailIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsetTimeout(() => { this.batchUpdating = false }, 300)\n\t\t\t} else {\n\t\t\t\tfor (const detail of this.details) {\n\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.id === detail.id)\n\t\t\t\t\tif (detailIndex === -1) {\n\t\t\t\t\t\tthis.checkedDetailGroups.push(detail)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tselectAllGroupsOnPage() {\n\t\t\tif (this.paginatedDetails[this.page].length === this.checkedDetailGroupsIntersect.length) {\n\t\t\t\tconst groupsToDeselect = this.checkedDetailGroupsIntersect\n\t\t\t\temit('deselectGroups', groupsToDeselect)\n\t\t\t\tfor (const detail of groupsToDeselect) {\n\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.id === detail.id)\n\t\t\t\t\tif (detailIndex !== -1) {\n\t\t\t\t\t\tthis.checkedDetailGroups.splice(detailIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const detail of this.paginatedDetails[this.page]) {\n\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.id === detail.id)\n\t\t\t\t\tif (detailIndex === -1) {\n\t\t\t\t\t\tthis.checkedDetailGroups.push(detail)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\topenNextDetailGroup(detail) {\n\t\t\tif (this.autoOpenNextGroup) {\n\t\t\t\tconst detailIndex = this.details.findIndex(d => d.id === detail.id)\n\t\t\t\tif (detailIndex !== -1) {\n\t\t\t\t\tif (detailIndex !== this.details.length - 1) {\n\t\t\t\t\t\temit('openGroup', this.details[detailIndex + 1])\n\t\t\t\t\t} else if (detailIndex === this.details.length - 1 && this.details.length >= 2) {\n\t\t\t\t\t\temit('openGroup', this.details[detailIndex - 1])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.task-details {\n\twidth: 100%;\n\tpadding: 20px 10px 20px 20px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\toverflow-y: scroll;\n\tmargin: 0 auto;\n}\n\n.task-details-heading {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.action-blackout {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tz-index: 999;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 5px;\n}\n\n.task-details-heading h3 {\n\tmargin: 0;\n}\n\n@media (max-width: 540px) {\n\t.task-details-heading {\n\t\tflex-direction: column;\n\t\ttext-align: center;\n\t}\n}\n\n.pagination {\n\tdisplay: flex;\n\talign-items: center;\n\t/* margin: 10px 0; */\n}\n\n.pagination-button {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n\n.sorting {\n\tdisplay: flex;\n}\n\n.toggle-sorting-button {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n\tcursor: pointer;\n}\n\n.pagination-button:hover, .toggle-sorting-button:hover {\n\tbackground-color: #eee;\n}\n\n.pagination-button:active, .toggle-sorting-button:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .pagination-button:hover, body.theme--dark .toggle-sorting-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .pagination-button:active, body.theme--dark .toggle-sorting-button:active {\n\tbackground-color: #5b5b5b;\n}\n\nbody.theme--dark .task-details {\n\tborder-color: #717171;\n}\n\n.task-details-row {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tborder: 1px solid #dedede;\n\tborder-radius: 5px;\n\tmargin-bottom: 5px;\n\ttransition: height .3s;\n}\n\n.filters {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\n\nbody.theme--dark .task-details-row, body.theme--dark .filters {\n\tborder-color: #717171;\n}\n\n@media (max-width: 540px) {\n\t.filters {\n\t\tflex-direction: column;\n\t}\n}\n\n.batch-editing {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.batch-actions-menu-button {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n\n.batch-actions-menu-button:hover {\n\tbackground-color: #eee;\n}\n\n.batch-actions-menu-button:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .batch-actions-menu-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .batch-actions-menu-button:active {\n\tbackground-color: #5b5b5b;\n}\n</style>\n"],sourceRoot:""}]);const a=s},62536:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(23645),s=i.n(n)()(!0);s.push([t.id,"\n.details-list-item[data-v-08060f22] {\n\twidth: 100%;\n\tpadding: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tflex-direction: column;\n\tposition: relative;\n}\n.details-list-item-title[data-v-08060f22] {\n\tdisplay: flex;\n\talign-items: center;\n}\n.group-info[data-v-08060f22] {\n\tpadding: 10px;\n\tborder-radius: 20px;\n\tdisplay: flex;\n\talign-items: center;\n\tuser-select: none;\n}\n.group-info[data-v-08060f22]:hover {\n\tcursor: pointer;\n\tbackground-color: #eee;\n}\n.group-info[data-v-08060f22]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .group-info[data-v-08060f22]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .group-info[data-v-08060f22]:active {\n\tbackground-color: #5b5b5b;\n}\n.pagination[data-v-08060f22] {\n\tdisplay: flex;\n\talign-items: center;\n\t/* margin: 10px 0; */\n}\n.pagination-button[data-v-08060f22] {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n.pagination-button[data-v-08060f22]:hover {\n\tbackground-color: #eee;\n}\n.pagination-button[data-v-08060f22]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .pagination-button[data-v-08060f22]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .pagination-button[data-v-08060f22]:active {\n\tbackground-color: #5b5b5b;\n}\n.open-details-btn[data-v-08060f22] {\n\tdisplay: inline-flex;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 5px 0 10px;\n\tcursor: pointer;\n}\n.delete-group-btn[data-v-08060f22] {\n\tvisibility: hidden;\n\tcursor: pointer;\n\tmargin: 0 10px 0 5px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n}\n.delete-group-btn[data-v-08060f22]:hover {\n\tbackground-color: #eee;\n}\n.delete-group-btn[data-v-08060f22]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .delete-group-btn[data-v-08060f22]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .delete-group-btn[data-v-08060f22]:active {\n\tbackground-color: #5b5b5b;\n}\n.details-list-item:hover .delete-group-btn[data-v-08060f22] {\n\tvisibility: visible;\n}\n.action-blackout[data-v-08060f22] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tz-index: 999;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 5px;\n}\n.batch-checkbox[data-v-08060f22] {\n\tvisibility: hidden;\n\tmargin-right: 20px;\n}\n.batch-checkbox .checkbox-radio-switch__icon[data-v-08060f22] {\n\tmargin-right: 0;\n\tcolor: #000;\n}\n.batch-checkbox.checkbox-radio-switch--checked[data-v-08060f22] {\n\tvisibility: visible;\n}\n.details-list-item:hover .batch-checkbox[data-v-08060f22] {\n\tvisibility: visible;\n}\n@media (max-width: 540px) {\n.delete-group-btn[data-v-08060f22] {\n\t\tvisibility: visible;\n}\n.batch-checkbox[data-v-08060f22] {\n\t\tvisibility: visible;\n\t\tmargin-right: 10px;\n}\n}\n","",{version:3,sources:["webpack://src/components/details/DetailsListItem.vue"],names:[],mappings:";AAyRA;CACA,WAAA;CACA,aAAA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,sBAAA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,aAAA;CACA,mBAAA;CACA,iBAAA;AACA;AAEA;CACA,eAAA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,oBAAA;AACA;AAEA;CACA,aAAA;CACA,aAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,kBAAA;CACA,iBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,oBAAA;CACA,WAAA;CACA,YAAA;CACA,oBAAA;CACA,eAAA;AACA;AAEA;CACA,kBAAA;CACA,eAAA;CACA,oBAAA;CACA,aAAA;CACA,kBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,mBAAA;AACA;AAEA;CACA,kBAAA;CACA,MAAA;CACA,OAAA;CACA,QAAA;CACA,SAAA;CACA,oCAAA;CACA,YAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,kBAAA;AACA;AAEA;CACA,kBAAA;CACA,kBAAA;AACA;AAEA;CACA,eAAA;CACA,WAAA;AACA;AAEA;CACA,mBAAA;AACA;AAEA;CACA,mBAAA;AACA;AAEA;AACA;EACA,mBAAA;AACA;AAEA;EACA,mBAAA;EACA,kBAAA;AACA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class=\"details-list-item\">\n\t\t<div v-show=\"updating\" class=\"action-blackout\">\n\t\t\t<span class=\"icon-loading\" />\n\t\t</div>\n\t\t<div class=\"details-list-item-title\">\n\t\t\t<CheckboxRadioSwitch class=\"batch-checkbox\" :checked.sync=\"checked\" />\n\t\t\t<span class=\"group-info\" @click=\"openDetailFiles(detail)\">\n\t\t\t\t<span class=\"icon-projects\" style=\"margin: 0 10px 0 10px;\" />\n\t\t\t\t{{ t('mediadc', 'Duplicate group') }} #{{ detail.id }} ({{ JSON.parse(detail.group_files_ids).length }}\n\t\t\t\t{{ translatePlural('mediadc', 'file', 'files', JSON.parse(detail.group_files_ids).length) }}{{ Array.isArray(files) && files.length > 0 ? ' - ' + formatBytes(groupFilesSize) : '' }})\n\t\t\t\t<span :class=\"!opened ? 'icon-triangle-s open-details-btn' : 'icon-triangle-n open-details-btn'\" />\n\t\t\t</span>\n\t\t\t<span class=\"icon-delete delete-group-btn\"\n\t\t\t\t:title=\"t('mediadc', 'Remove group without deleting files')\"\n\t\t\t\t@click=\"removeTaskDetail(detail)\" />\n\t\t</div>\n\t\t<div v-if=\"opened && JSON.parse(detail.group_files_ids).length > groupItemsPerPage\" class=\"pagination\">\n\t\t\t<span class=\"icon-view-previous pagination-button\"\n\t\t\t\t@click=\"openPrevDetailFiles(detail)\" />\n\t\t\t<span>{{ t('mediadc', 'Page:') }}&nbsp;</span>\n\t\t\t<span>{{ page + 1 }}/{{ Math.ceil(JSON.parse(detail.group_files_ids).length / groupItemsPerPage) }}</span>\n\t\t\t<span class=\"icon-view-next pagination-button\"\n\t\t\t\t@click=\"openNextDetailFiles(detail)\" />\n\t\t</div>\n\t\t<DetailsGroupList v-show=\"opened\"\n\t\t\t:detail=\"detail\"\n\t\t\t:files=\"files\"\n\t\t\t:all-files=\"allFiles\"\n\t\t\t:loading-files.sync=\"loadingFiles\"\n\t\t\t:updating.sync=\"updating\"\n\t\t\t:files-ascending.sync=\"filesAscending\" />\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport DetailsGroupList from './DetailsGroupList'\nimport Formats from '../../mixins/Formats'\nimport { mapGetters } from 'vuex'\nimport { showError, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { subscribe, unsubscribe, emit } from '@nextcloud/event-bus'\nimport CheckboxRadioSwitch from '@nextcloud/vue/dist/Components/CheckboxRadioSwitch'\n\nexport default {\n\tname: 'DetailsListItem',\n\tcomponents: { DetailsGroupList, CheckboxRadioSwitch },\n\tmixins: [Formats],\n\tprops: {\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcheckedDetailGroups: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\topened: false,\n\t\t\tpage: 0,\n\t\t\ttotalPages: 0,\n\t\t\tloadingFiles: false,\n\t\t\tfiles: [],\n\t\t\tallFiles: [],\n\t\t\tpaginatedFiles: {},\n\t\t\tchecked: false,\n\t\t\tfilesAscending: false,\n\t\t\tupdating: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'details',\n\t\t\t'groupItemsPerPage',\n\t\t]),\n\t\tgroupFilesSize() {\n\t\t\treturn this.allFiles.length > 0 ? this.allFiles.reduce((sum, file) => sum + file.filesize, 0) : 0\n\t\t},\n\t},\n\twatch: {\n\t\tchecked() {\n\t\t\tconst newCheckedDetailGroups = this.checkedDetailGroups\n\t\t\tconst detailIndex = newCheckedDetailGroups.findIndex(d => d.id === this.detail.id)\n\t\t\tif (this.checked) {\n\t\t\t\tif (detailIndex === -1) {\n\t\t\t\t\tnewCheckedDetailGroups.push(this.detail)\n\t\t\t\t}\n\t\t\t} else if (detailIndex !== -1) {\n\t\t\t\tnewCheckedDetailGroups.splice(detailIndex, 1)\n\t\t\t}\n\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t},\n\t\tfilesAscending() {\n\t\t\tthis.sortFiles(this.filesAscending)\n\t\t},\n\t\tcheckedDetailGroups() {\n\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.id === this.detail.id)\n\t\t\tif (!this.checked && detailIndex !== -1) {\n\t\t\t\tthis.checked = true\n\t\t\t}\n\t\t},\n\t\tgroupItemsPerPage(newGroupItemsPerPage) {\n\t\t\tif (this.opened) {\n\t\t\t\tif (this.page >= Math.ceil(JSON.parse(this.detail.group_files_ids).length / newGroupItemsPerPage)) {\n\t\t\t\t\tthis.page = Math.ceil(JSON.parse(this.detail.group_files_ids).length / newGroupItemsPerPage) - 1\n\t\t\t\t}\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t}\n\t\t},\n\t\tallFiles(newAllFiles) {\n\t\t\tif (this.page >= Math.ceil(newAllFiles.length / this.groupItemsPerPage)) {\n\t\t\t\tthis.page = Math.ceil(newAllFiles.length / this.groupItemsPerPage) - 1\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t}\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tconst detailCheckedIndex = this.checkedDetailGroups.findIndex(d => d.id === this.detail.id)\n\t\tthis.checked = detailCheckedIndex !== -1\n\t\tsubscribe('updateGroupFilesPagination', this.updateFilesPagination)\n\t\tsubscribe('deselectGroups', this.deselect)\n\t\tsubscribe('openGroup', this.openGroup)\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('updateGroupFilesPagination', this.updateFilesPagination)\n\t\tunsubscribe('deselectGroups', this.deselect)\n\t\tunsubscribe('openGroup', this.openGroup)\n\t},\n\tmethods: {\n\t\topenDetailFiles(detail) {\n\t\t\tif (!this.opened) {\n\t\t\t\tif (this.files === undefined || this.files.length === 0) {\n\t\t\t\t\tconst taskId = detail.task_id\n\t\t\t\t\tconst detailId = detail.id\n\t\t\t\t\tthis.loadingFiles = true\n\t\t\t\t\tthis.opened = true\n\t\t\t\t\tif (this.allFiles.length === 0) {\n\t\t\t\t\t\tthis.loadAllFilesInfo(taskId, detailId)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\t\t\tthis.loadingFiles = false\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.opened = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.opened = false\n\t\t\t}\n\t\t},\n\t\topenNextDetailFiles(detail) {\n\t\t\tif (this.page < Math.ceil(JSON.parse(detail.group_files_ids).length / this.groupItemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'Last page reached!'))\n\t\t\t}\n\t\t},\n\t\topenPrevDetailFiles(detail) {\n\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page -= 1\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'First page reached!'))\n\t\t\t}\n\t\t},\n\t\tloadAllFilesInfo(taskId, detailId) {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${taskId}/files/${detailId}/all`)).then(res => {\n\t\t\t\tthis.allFiles = res.data.files\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\tthis.loadingFiles = false\n\t\t\t})\n\t\t},\n\t\tpaginateFiles(files) {\n\t\t\tconst paginatedFiles = []\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\tconst last = paginatedFiles[paginatedFiles.length - 1]\n\t\t\t\tif (!last || last.length === this.groupItemsPerPage) {\n\t\t\t\t\tpaginatedFiles.push([files[i]])\n\t\t\t\t} else {\n\t\t\t\t\tlast.push(files[i])\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn paginatedFiles\n\t\t},\n\t\tremoveTaskDetail(detail) {\n\t\t\tif (confirm(this.t('mediadc', 'Are you sure, you want remove this group without deleting files?'))) {\n\t\t\t\tthis.updating = true\n\t\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${detail.task_id}/detail/${detail.id}`)).then(res => {\n\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\t\tconst updatedDetails = [...this.details]\n\t\t\t\t\t\tconst removedDetailIndex = updatedDetails.findIndex(d => d.id === this.detail.id)\n\t\t\t\t\t\tupdatedDetails.splice(removedDetailIndex, 1)\n\t\t\t\t\t\tthis.$store.dispatch('setDetails', updatedDetails)\n\t\t\t\t\t\tconst checkedIndex = this.checkedDetailGroups.findIndex(d => d.id === detail.id)\n\t\t\t\t\t\tconst newCheckedDetailGroups = [...this.checkedDetailGroups]\n\t\t\t\t\t\tif (this.checked && checkedIndex !== -1) {\n\t\t\t\t\t\t\tnewCheckedDetailGroups.splice(checkedIndex, 1)\n\t\t\t\t\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t\t\t\t\t}\n\t\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\t\tshowSuccess(this.t('mediadc', 'Duplicate group succesffully removed'))\n\t\t\t\t\t\tconst detailCheckedIndex = this.checkedDetailGroups.findIndex(d => d.id === detail.id)\n\t\t\t\t\t\tif (detailCheckedIndex !== -1) {\n\t\t\t\t\t\t\tconst newCheckedDetailGroups = this.checkedDetailGroups\n\t\t\t\t\t\t\tnewCheckedDetailGroups.splice(detailCheckedIndex, 1)\n\t\t\t\t\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.updating = false\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowError(this.t('mediadc', 'Some error occured while deleting duplicate group'))\n\t\t\t\t\t\tthis.updating = false\n\t\t\t\t\t}\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tconsole.debug(err)\n\t\t\t\t\tshowError(this.t('mediadc', 'Some error occured while deleting duplicate group'))\n\t\t\t\t\tthis.updating = false\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tsortFiles(ascending) {\n\t\t\tthis.allFiles.sort((a, b) => (ascending) ? a.filesize - b.filesize : b.filesize - a.filesize)\n\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t\tupdateFilesPagination(file) {\n\t\t\tif (file) {\n\t\t\t\tconst deletedFileIndex = this.allFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\tif (deletedFileIndex !== -1) {\n\t\t\t\t\tthis.allFiles.splice(deletedFileIndex, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t\tdeselect(groupsToDeselect) {\n\t\t\tif (this.checked && groupsToDeselect.includes(this.detail.id)) {\n\t\t\t\tthis.checked = false\n\t\t\t}\n\t\t},\n\t\topenGroup(detail) {\n\t\t\tif (this.detail.id === detail.id && !this.opened) {\n\t\t\t\tthis.openDetailFiles(detail)\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.details-list-item {\n\twidth: 100%;\n\tpadding: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tflex-direction: column;\n\tposition: relative;\n}\n\n.details-list-item-title {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.group-info {\n\tpadding: 10px;\n\tborder-radius: 20px;\n\tdisplay: flex;\n\talign-items: center;\n\tuser-select: none;\n}\n\n.group-info:hover {\n\tcursor: pointer;\n\tbackground-color: #eee;\n}\n\n.group-info:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .group-info:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .group-info:active {\n\tbackground-color: #5b5b5b;\n}\n\n.pagination {\n\tdisplay: flex;\n\talign-items: center;\n\t/* margin: 10px 0; */\n}\n\n.pagination-button {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n\n.pagination-button:hover {\n\tbackground-color: #eee;\n}\n\n.pagination-button:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .pagination-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .pagination-button:active {\n\tbackground-color: #5b5b5b;\n}\n\n.open-details-btn {\n\tdisplay: inline-flex;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 5px 0 10px;\n\tcursor: pointer;\n}\n\n.delete-group-btn {\n\tvisibility: hidden;\n\tcursor: pointer;\n\tmargin: 0 10px 0 5px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n}\n\n.delete-group-btn:hover {\n\tbackground-color: #eee;\n}\n\n.delete-group-btn:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .delete-group-btn:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .delete-group-btn:active {\n\tbackground-color: #5b5b5b;\n}\n\n.details-list-item:hover .delete-group-btn {\n\tvisibility: visible;\n}\n\n.action-blackout {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tz-index: 999;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 5px;\n}\n\n.batch-checkbox {\n\tvisibility: hidden;\n\tmargin-right: 20px;\n}\n\n.batch-checkbox .checkbox-radio-switch__icon {\n\tmargin-right: 0;\n\tcolor: #000;\n}\n\n.batch-checkbox.checkbox-radio-switch--checked {\n\tvisibility: visible;\n}\n\n.details-list-item:hover .batch-checkbox {\n\tvisibility: visible;\n}\n\n@media (max-width: 540px) {\n\t.delete-group-btn {\n\t\tvisibility: visible;\n\t}\n\n\t.batch-checkbox {\n\t\tvisibility: visible;\n\t\tmargin-right: 10px;\n\t}\n}\n</style>\n"],sourceRoot:""}]);const a=s},98025:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(23645),s=i.n(n)()(!0);s.push([t.id,"\n.blackout[data-v-17c25fb8] {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.3);\n\tz-index: 999;\n}\n.edit-task-block[data-v-17c25fb8] {\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tbox-shadow: 0 0 4px 0 rgba(0, 0, 0, .05);\n\tpadding: 20px;\n\twidth: 100%;\n\tmax-width: 600px;\n\tposition: absolute;\n\tbackground-color: #fff;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n}\n.selection-container[data-v-17c25fb8] {\n\twidth: 100%;\n\tdisplay: flex;\n}\n@media (max-width: 767px) {\n.selection-container[data-v-17c25fb8] {\n\t\tflex-wrap: wrap;\n}\n}\n@media (max-width: 540px) {\n.edit-task-block[data-v-17c25fb8] {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(50% + calc(100% - 96vh));\n}\n}\n.block[data-v-17c25fb8] {\n\twidth: 100%;\n\theight: 100%;\n\tmax-height: 200px;\n\toverflow-y: scroll;\n\tpadding: 10px 15px;\n\tmargin: 5px 10px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\n.block[data-v-17c25fb8]:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .05)\n}\n.target-directory[data-v-17c25fb8], .custom-mask[data-v-17c25fb8] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 0;\n\tborder-bottom: 1px solid #dadada;\n}\n.delete-button[data-v-17c25fb8] {\n\tdisplay: inline-flex;\n\twidth: 15px;\n\theight: 15px;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n.close-edit-button[data-v-17c25fb8] {\n\tposition: absolute;\n\ttop: 15px;\n\tright: 15px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\topacity: 0.5;\n}\n.close-edit-button[data-v-17c25fb8]:hover, .close-edit-button[data-v-17c25fb8]:active {\n\topacity: 1;\n}\nbody.theme--dark .actions-menu-button[data-v-17c25fb8]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .close-edit-button[data-v-17c25fb8]:active {\n\tbackground-color: #5b5b5b;\n}\nbody.theme--dark .edit-task-block[data-v-17c25fb8], body.theme--dark .block[data-v-17c25fb8] {\n\tborder-color: #717171;\n}\nbody.theme--dark .edit-task-block[data-v-17c25fb8] {\n\tbackground-color: #111;\n}\n","",{version:3,sources:["webpack://src/components/tasks/TasksEdit.vue"],names:[],mappings:";AA8XA;CACA,eAAA;CACA,MAAA;CACA,OAAA;CACA,QAAA;CACA,SAAA;CACA,oCAAA;CACA,YAAA;AACA;AAEA;CACA,yBAAA;CACA,kBAAA;CACA,wCAAA;CACA,aAAA;CACA,WAAA;CACA,gBAAA;CACA,kBAAA;CACA,sBAAA;CACA,QAAA;CACA,SAAA;CACA,gCAAA;AACA;AAEA;CACA,WAAA;CACA,aAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;AAEA;AACA;EACA,WAAA;EACA,YAAA;EACA,kBAAA;EACA,kCAAA;AACA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,iBAAA;CACA,kBAAA;CACA,kBAAA;CACA,gBAAA;CACA,yBAAA;CACA,kBAAA;AACA;AAEA;CACA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,cAAA;CACA,gCAAA;AACA;AAEA;CACA,oBAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,cAAA;AACA;AAEA;CACA,kBAAA;CACA,SAAA;CACA,WAAA;CACA,aAAA;CACA,kBAAA;CACA,eAAA;CACA,YAAA;AACA;AAEA;CACA,UAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,sBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-show=\"opened\" class=\"blackout\">\n\t\t<div class=\"edit-task-block\">\n\t\t\t<span class=\"icon-close close-edit-button\" @click=\"closeEditTaskDialog\" />\n\t\t\t<h2>{{ t('mediadc', 'Edit task') }}</h2>\n\t\t\t<div class=\"selection-container\">\n\t\t\t\t<div class=\"block target-directories-block\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Target directories') }}</h3>\n\t\t\t\t\t<div v-if=\"targetDirectoriesIds.length > 0\">\n\t\t\t\t\t\t<div v-for=\"fileid in targetDirectoriesIds\" :key=\"fileid\" class=\"selected-target-directories-list\">\n\t\t\t\t\t\t\t<div class=\"target-directory\">\n\t\t\t\t\t\t\t\t<span style=\"overflow-y: scroll; white-space: nowrap;\">{{ targetDirectoriesPaths[fileid] }}</span>\n\t\t\t\t\t\t\t\t<span class=\"delete-button icon-delete\" @click=\"removeTargetDirectory(fileid)\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<span>{{ t('mediadc', 'Not selected') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br>\n\t\t\t\t\t<button @click=\"openDirectoriesExplorer\">\n\t\t\t\t\t\t<span class=\"icon-add\" />\n\t\t\t\t\t\t{{ t('mediadc', 'Select') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"block\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Exclude directories') }}</h3>\n\t\t\t\t\t<div v-if=\"excludeDirectoriesPaths.length > 0\">\n\t\t\t\t\t\t<div v-for=\"fileid in Object.keys(excludeFileIds)\" :key=\"fileid\" class=\"selected-excluded-directories-list\">\n\t\t\t\t\t\t\t<div class=\"target-directory\">\n\t\t\t\t\t\t\t\t<span style=\"overflow-y: scroll;\">{{ excludeFileIds[fileid] }}</span>\n\t\t\t\t\t\t\t\t<span class=\"delete-button icon-delete\" @click=\"removeExcludeDirectory(fileid)\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<span>{{ t('mediadc', 'Not selected') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br>\n\t\t\t\t\t<button @click=\"openExcludeExplorer\">\n\t\t\t\t\t\t<span class=\"icon-add\" />\n\t\t\t\t\t\t{{ t('mediadc', 'Select') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"selection-container\">\n\t\t\t\t<div class=\"block\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Custom exclude mask') }}</h3>\n\t\t\t\t\t<div v-if=\"customExcludeList.length > 0\" class=\"custom-masks-list\">\n\t\t\t\t\t\t<div v-for=\"(mask, index) in customExcludeList\" :key=\"index\" class=\"custom-mask\">\n\t\t\t\t\t\t\t<span>{{ mask }}</span>\n\t\t\t\t\t\t\t<span class=\"icon-delete\" style=\"cursor: pointer;\" @click=\"deleteCustomMask(mask)\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<span>{{ t('mediadc', 'Not added') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"addingCustomMask\" style=\"display: flex; align-items: center;\">\n\t\t\t\t\t\t<input id=\"custom-exclude-mask\"\n\t\t\t\t\t\t\tref=\"customExcludeMask\"\n\t\t\t\t\t\t\tv-model=\"customExcludeMask\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t@keyup.enter=\"addCustomMask\"\n\t\t\t\t\t\t\t@keyup.esc=\"cancelAddingCustomMask\">\n\t\t\t\t\t\t<span class=\"icon-checkmark\" style=\"width: 18px; height: 18px; margin: 0 5px; display: inline-block; cursor: pointer;\" @click=\"addCustomMask\" />\n\t\t\t\t\t\t<span class=\"icon-close\" style=\"width: 18px; height: 18px; margin: 0 5px; display: inline-block; cursor: pointer;\" @click=\"cancelAddingCustomMask\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style=\"display: flex; align-items: center; margin: 20px 0;\">\n\t\t\t\t\t\t<button @click=\"addNewMask\">\n\t\t\t\t\t\t\t<span class=\"icon-add\" />\n\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Add mask') }}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"block\">\n\t\t\t\t\t<h3 style=\"margin: 5px 0;\">\n\t\t\t\t\t\t{{ t('mediadc', 'Target Mime Type') }}\n\t\t\t\t\t</h3>\n\t\t\t\t\t<select id=\"target_mtype\"\n\t\t\t\t\t\tv-model=\"targetMimeType\"\n\t\t\t\t\t\tname=\"target_mtype\">\n\t\t\t\t\t\t<option :value=\"0\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Photos') }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option :value=\"1\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Videos') }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option :value=\"2\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Photos and Videos') }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<h3 style=\"margin: 5px 0;\">\n\t\t\t\t\t\t{{ t('mediadc', 'Similarity threshold') }}\n\t\t\t\t\t</h3>\n\t\t\t\t\t<input v-model=\"similarity_threshold\"\n\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\tmin=\"50\"\n\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\tstyle=\"margin: 0 0 10px;\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button v-if=\"!runningTask\"\n\t\t\t\tstyle=\"margin: 10px 5px 0\"\n\t\t\t\t:disabled=\"Object.keys(targetDirectoriesPaths).length === 0\"\n\t\t\t\t@click=\"restartTask\">\n\t\t\t\t{{ t('mediadc', 'Restart task') }}\n\t\t\t</button>\n\t\t\t<button v-else disabled>\n\t\t\t\t<span class=\"icon-loading\" />\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { generateUrl } from '@nextcloud/router'\nimport { getFilePickerBuilder, showWarning, showSuccess } from '@nextcloud/dialogs'\nimport axios from '@nextcloud/axios'\nimport { requestFileInfo, getFileId } from '../../utils/files'\nimport { mapGetters } from 'vuex'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { emit } from '@nextcloud/event-bus'\n\nexport default {\n\tname: 'TasksEdit',\n\tprops: {\n\t\topened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\ttargetDirectoriesPaths: {},\n\t\t\ttargetDirectoriesIds: [],\n\t\t\texcludeDirectoriesPaths: [],\n\t\t\texcludeFileIds: {},\n\t\t\ttargetMimeType: 0,\n\t\t\tsimilarity_threshold: 90,\n\t\t\tcustomExcludeList: [],\n\t\t\tcustomExcludeMask: '',\n\t\t\taddingCustomMask: false,\n\t\t\trunningTask: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'settings',\n\t\t\t'settingByName',\n\t\t\t'tasks',\n\t\t\t'task',\n\t\t\t'taskInfo',\n\t\t]),\n\t},\n\tbeforeMount() {\n\t\tthis.similarity_threshold = this.settingByName('similarity_threshold') !== undefined\n\t\t\t? this.settingByName('similarity_threshold').value\n\t\t\t: 90\n\t\tthis.targetMimeType = JSON.parse(this.task.collector_settings).target_mtype\n\t\tthis.similarity_threshold = JSON.parse(this.task.collector_settings).similarity_threshold\n\t\tthis.parseTaskSettings()\n\t},\n\tmethods: {\n\t\tparseTaskSettings() {\n\t\t\tif (this.taskInfo !== null && 'target_directories' in this.taskInfo) {\n\t\t\t\tthis.taskInfo.target_directories.forEach(dir => {\n\t\t\t\t\tthis.targetDirectoriesIds.push(dir.fileid.toString())\n\t\t\t\t\tthis.targetDirectoriesPaths[dir.fileid.toString()] = dir.filepath.replace(`/${getCurrentUser().uid}/files`, '') !== '' ? dir.filepath.replace(`/${getCurrentUser().uid}/files`, '') : '/'\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (this.taskInfo !== null && 'exclude_directories' in this.taskInfo) {\n\t\t\t\tthis.taskInfo.exclude_directories.forEach(dir => {\n\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir.filepath.replace())\n\t\t\t\t\tthis.excludeFileIds[dir.fileid.toString()] = dir.filepath.replace(`/${getCurrentUser().uid}/files`, '')\n\t\t\t\t})\n\t\t\t\tthis.customExcludeList = JSON.parse(this.task.exclude_list).user.mask\n\t\t\t}\n\t\t},\n\t\tgetDirectoriesPicker(title) {\n\t\t\treturn getFilePickerBuilder(title)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.addMimeTypeFilter('httpd/unix-directory')\n\t\t\t\t.setModal(true)\n\t\t\t\t.setType(1)\n\t\t\t\t.allowDirectories(true)\n\t\t\t\t.build()\n\t\t},\n\t\tgetFilesPicker(title) {\n\t\t\treturn getFilePickerBuilder(title)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.setModal(true)\n\t\t\t\t.setType(1)\n\t\t\t\t.allowDirectories(true)\n\t\t\t\t.build()\n\t\t},\n\t\topenDirectoriesExplorer() {\n\t\t\tthis.getDirectoriesPicker(this.t('mediadc', 'Choose target directory')).pick().then(dir => {\n\t\t\t\tif (dir.startsWith('/')) {\n\t\t\t\t\trequestFileInfo(dir).then(res => {\n\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\tif (!(fileid in this.targetDirectoriesPaths)) {\n\t\t\t\t\t\t\t\tthis.targetDirectoriesIds.push(fileid)\n\t\t\t\t\t\t\t\tthis.targetDirectoriesPaths[fileid.toString()] = dir\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tshowWarning(this.t('mediadc', 'This directory already selected'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\trequestFileInfo('/').then(res => {\n\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\tif (!(fileid in this.targetDirectoriesPaths)) {\n\t\t\t\t\t\t\t\tthis.targetDirectoriesIds.push(fileid)\n\t\t\t\t\t\t\t\tthis.targetDirectoriesPaths[fileid.toString()] = '/'\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tshowWarning(this.t('mediadc', 'This directory already selected'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tthis.targetDirectoriesPaths.push('/')\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\topenExcludeExplorer() {\n\t\t\tthis.getDirectoriesPicker(this.t('mediadc', 'Choose directory to exclude')).pick().then(dir => {\n\t\t\t\tif (Object.values(this.excludeFileIds).findIndex(targetDir => targetDir === dir) === -1) {\n\t\t\t\t\tif (dir.startsWith('/')) {\n\t\t\t\t\t\trequestFileInfo(dir).then(res => {\n\t\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir)\n\t\t\t\t\t\t\t\tthis.excludeFileIds[fileid.toString()] = dir\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\trequestFileInfo('/').then(res => {\n\t\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir)\n\t\t\t\t\t\t\t\tthis.excludeFileIds[fileid.toString()] = '/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tshowWarning(this.t('mediadc', 'This directory already excluded'))\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\trestartTask() {\n\t\t\tthis.runningTask = true\n\t\t\tthis.getSettings().then(res => {\n\t\t\t\tthis.$store.dispatch('setSettings', res.data)\n\t\t\t\taxios.post(generateUrl('/apps/mediadc/api/v1/tasks/restart'), {\n\t\t\t\t\ttaskId: this.task.id,\n\t\t\t\t\ttargetDirectoryIds: JSON.stringify(this.targetDirectoriesIds),\n\t\t\t\t\texcludeList: {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tmask: this.customExcludeList,\n\t\t\t\t\t\t\tfileid: Object.keys(this.excludeFileIds).map(item => Number(item)),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadmin: JSON.parse(this.settingByName('exclude_list').value) || { mask: [], fileid: [] },\n\t\t\t\t\t},\n\t\t\t\t\tcollectorSettings: {\n\t\t\t\t\t\thashing_algorithm: JSON.parse(this.settingByName('hashing_algorithm').value) || 'dhash',\n\t\t\t\t\t\tsimilarity_threshold: Number(this.similarity_threshold),\n\t\t\t\t\t\thash_size: Number(this.settingByName('hash_size').value) || 16,\n\t\t\t\t\t\ttarget_mtype: this.targetMimeType,\n\t\t\t\t\t},\n\t\t\t\t}).then(res => {\n\t\t\t\t\tthis.runningTask = false\n\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\tthis.runningTask = false\n\t\t\t\t\t\tthis.closeEditTaskDialog()\n\t\t\t\t\t\temit('restartTask')\n\t\t\t\t\t\tshowSuccess(this.t('mediadc', 'Task successfully restarted!'))\n\t\t\t\t\t} else if (res.data.limit) {\n\t\t\t\t\t\tshowWarning(this.t('mediadc', 'Running tasks limit exceed. Try again later.'))\n\t\t\t\t\t} else if (res.data.empty) {\n\t\t\t\t\t\tshowWarning(this.translatePlural('mediadc', 'Target folder has no files or all of them excluded', 'Target folders have no files or all of them excluded', this.targetDirectoriesIds.length))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowWarning(t('medaidc', 'Some error occured while running Collector Task. Try again.'))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\tremoveTargetDirectory(fileid) {\n\t\t\tdelete this.targetDirectoriesPaths[fileid]\n\t\t\tconst fileidIndex = this.targetDirectoriesIds.findIndex(id => id === fileid)\n\t\t\tthis.targetDirectoriesIds.splice(fileidIndex, 1)\n\t\t},\n\t\tremoveExcludeDirectory(fileid) {\n\t\t\tif (fileid in this.excludeFileIds) {\n\t\t\t\tconst dirIndex = this.excludeDirectoriesPaths.findIndex(dir => dir === this.excludeFileIds[fileid])\n\t\t\t\tthis.excludeDirectoriesPaths.splice(dirIndex, 1)\n\t\t\t\tdelete this.excludeFileIds[fileid]\n\t\t\t}\n\t\t},\n\t\tremoveExcludeFileid(fileid) {\n\t\t\tdelete this.excludeFileIds[fileid]\n\t\t},\n\t\taddNewMask() {\n\t\t\tthis.addingCustomMask = true\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$refs.customExcludeMask.focus()\n\t\t\t}, 100)\n\t\t},\n\t\taddCustomMask() {\n\t\t\tif (this.customExcludeMask.length > 0) {\n\t\t\t\tif (this.customExcludeList.findIndex(mask => mask === this.customExcludeMask) === -1) {\n\t\t\t\t\tthis.customExcludeList.push(this.customExcludeMask)\n\t\t\t\t\tthis.customExcludeMask = ''\n\t\t\t\t\tthis.addingCustomMask = false\n\t\t\t\t} else {\n\t\t\t\t\tshowWarning(this.t('mediadc', 'This mask already exists!'))\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'Enter custom mask!'))\n\t\t\t}\n\t\t},\n\t\tcancelAddingCustomMask() {\n\t\t\tthis.customExcludeMask = ''\n\t\t\tthis.addingCustomMask = false\n\t\t},\n\t\tdeleteCustomMask(mask) {\n\t\t\tconst maskIndex = this.customExcludeList.findIndex(m => m === mask)\n\t\t\tthis.customExcludeList.splice(maskIndex, 1)\n\t\t},\n\t\tasync getTasks() {\n\t\t\taxios.get(generateUrl('/apps/mediadc/api/v1/tasks')).then(res => {\n\t\t\t\tthis.$store.dispatch('setTasks', res.data)\n\t\t\t\tthis.$emit('update:loading', false)\n\t\t\t})\n\t\t},\n\t\tresetForm() {\n\t\t\tthis.targetDirectoriesPaths = {}\n\t\t\tthis.targetDirectoriesIds = []\n\t\t\tthis.excludeDirectoriesNames = []\n\t\t\tthis.excludeFileIds = {}\n\t\t\tthis.targetMimeType = 0\n\t\t\tthis.similarity_threshold = this.settingByName('similarity_threshold') !== undefined\n\t\t\t\t? this.settingByName('similarity_threshold').value\n\t\t\t\t: 90\n\t\t\tthis.customExcludeList = []\n\t\t\tthis.runningTask = false\n\t\t},\n\t\tcloseEditTaskDialog() {\n\t\t\tthis.$emit('update:opened', false)\n\t\t},\n\t\tasync getSettings() {\n\t\t\treturn axios.get(generateUrl('/apps/mediadc/api/v1/settings'))\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.blackout {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground-color: rgba(0, 0, 0, 0.3);\n\tz-index: 999;\n}\n\n.edit-task-block {\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tbox-shadow: 0 0 4px 0 rgba(0, 0, 0, .05);\n\tpadding: 20px;\n\twidth: 100%;\n\tmax-width: 600px;\n\tposition: absolute;\n\tbackground-color: #fff;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n}\n\n.selection-container {\n\twidth: 100%;\n\tdisplay: flex;\n}\n\n@media (max-width: 767px) {\n\t.selection-container {\n\t\tflex-wrap: wrap;\n\t}\n}\n\n@media (max-width: 540px) {\n\t.edit-task-block {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(50% + calc(100% - 96vh));\n\t}\n}\n\n.block {\n\twidth: 100%;\n\theight: 100%;\n\tmax-height: 200px;\n\toverflow-y: scroll;\n\tpadding: 10px 15px;\n\tmargin: 5px 10px;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n}\n\n.block:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .05)\n}\n\n.target-directory, .custom-mask {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 0;\n\tborder-bottom: 1px solid #dadada;\n}\n\n.delete-button {\n\tdisplay: inline-flex;\n\twidth: 15px;\n\theight: 15px;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n\n.close-edit-button {\n\tposition: absolute;\n\ttop: 15px;\n\tright: 15px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\topacity: 0.5;\n}\n\n.close-edit-button:hover, .close-edit-button:active {\n\topacity: 1;\n}\n\nbody.theme--dark .actions-menu-button:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .close-edit-button:active {\n\tbackground-color: #5b5b5b;\n}\n\nbody.theme--dark .edit-task-block, body.theme--dark .block {\n\tborder-color: #717171;\n}\n\nbody.theme--dark .edit-task-block {\n\tbackground-color: #111;\n}\n</style>\n"],sourceRoot:""}]);const a=s},46583:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(23645),s=i.n(n)()(!0);s.push([t.id,"\n.container[data-v-855bf63a] {\n\tpadding: 0 20px;\n\twidth: 100%;\n\tmax-width: 1440px;\n\tmargin: 0 auto;\n\tmax-height: 100%;\n}\n@media (min-width: 1920px) {\n.container[data-v-855bf63a] {\n\t\tmax-width: 80vw;\n}\n}\nh2[data-v-855bf63a] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\tmargin: 20px auto 10px;\n\ttext-align: center;\n}\n.collapse-task-status-btn[data-v-855bf63a] {\n\tdisplay: inline-flex;\n\tcursor: pointer;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 10px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n.task-details-heading p[data-v-855bf63a] {\n\ttext-align: center;\n}\n.details-row[data-v-855bf63a] {\n\tdisplay: flex;\n\tmargin: 0 10px 20px;\n\tposition: relative;\n}\n@media (max-width: 767px) {\n.details-row[data-v-855bf63a] {\n\t\tflex-wrap: wrap;\n}\n.task-details-heading[data-v-855bf63a] {\n\t\tflex-direction: column;\n}\n}\n.task-status-row[data-v-855bf63a] {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-wrap: wrap;\n}\n.task-status[data-v-855bf63a] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tmargin: 20px;\n\tpadding: 10px;\n}\n.actions-menu-button[data-v-855bf63a] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n.actions-menu-button[data-v-855bf63a]:hover, .collapse-task-status-btn[data-v-855bf63a]:hover {\n\tbackground-color: #eee;\n}\n.actions-menu-button[data-v-855bf63a]:active, .collapse-task-status-btn[data-v-855bf63a]:active {\n\tbackground-color: #ddd;\n}\nbody.theme--dark .actions-menu-button[data-v-855bf63a]:hover, body.theme--dark .collapse-task-status-btn[data-v-855bf63a]:hover {\n\tbackground-color: #727272;\n}\nbody.theme--dark .actions-menu-button[data-v-855bf63a]:active, body.theme--dark .collapse-task-status-btn[data-v-855bf63a]:active {\n\tbackground-color: #5b5b5b;\n}\nbody.theme--dark .task-status[data-v-855bf63a], body.theme--dark .task-info[data-v-855bf63a] {\n\tborder-color: #717171;\n}\n.task-info[data-v-855bf63a] {\n\tmargin: 20px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tpadding: 10px 20px;\n\theight: 100%;\n\tmin-height: 94px;\n\tmax-height: 94px;\n\tmax-width: 50%;\n\toverflow-y: scroll;\n}\n.owner-tooltip[data-v-855bf63a] {\n\tposition: relative;\n}\n.tooltip-title[data-v-855bf63a] {\n\tdisplay: none;\n\tpadding: 0 5px;\n\tborder-radius: 5px;\n\tbackground-color: #000;\n\tcolor: #fff;\n\tposition: absolute;\n\ttop: calc(-100% - 5px);\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\tfont-size: 12px;\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5);\n}\n.tooltip-title[data-v-855bf63a]:before {\n\tcontent: '';\n\tposition: absolute;\n\tleft: 50%;\n\ttransform: translateX(-50%) rotateZ(45deg);\n\tbottom: -3px;\n\twidth: 10px;\n\theight: 10px;\n\tbackground-color: #000;\n\tz-index: -1;\n}\n.owner-tooltip:hover .tooltip-title[data-v-855bf63a] {\n\tdisplay: block;\n}\n@media (max-width: 767px) {\n.details-row[data-v-855bf63a] {\n\t\tmargin: 0 0 20px;\n}\n.task-status[data-v-855bf63a] {\n\t\tflex-direction: column;\n\t\tmargin: 0 0 20px;\n\t\twidth: 100%;\n}\n.task-info[data-v-855bf63a] {\n\t\tmax-width: 100%;\n\t\tmargin: 0;\n}\n}\n.task-info h3[data-v-855bf63a] {\n\tmargin: 0 0 5px 0;\n}\n.target-directory-row[data-v-855bf63a] {\n\twhite-space: nowrap;\n}\n.badge[data-v-855bf63a] {\n\tdisplay: inline-flex;\n\tpadding: 0 10px;\n\tbackground-color: #eee;\n\tborder-radius: 20px;\n\tmargin-right: 20px;\n}\n@media (max-width: 540px) {\n.task-status-row[data-v-855bf63a] {\n\t\tflex-direction: column;\n\t\tmargin: 20px 0;\n}\n.badge[data-v-855bf63a] {\n\t\tmargin-right: 0;\n\t\tmargin-top: 10px;\n\t\tmargin-bottom: 10px;\n}\n}\n.badge.finished[data-v-855bf63a] {\n\tbackground-color: #49b382;\n\tcolor: #fff;\n}\n.badge.running[data-v-855bf63a], .badge.pending[data-v-855bf63a] {\n\tbackground-color: #dadada;\n\tcolor: #000;\n}\n.badge.error[data-v-855bf63a] {\n\tbackground-color: #bd3f3f;\n\tcolor: #fff;\n}\n.badge.terminated[data-v-855bf63a] {\n\tbackground-color: #f17b1b;\n\tcolor: #fff;\n}\n.errors[data-v-855bf63a] {\n\tmargin: 20px;\n\tborder: 1px solid #bd3f3f;\n\tborder-radius: 5px;\n\tpadding: 10px;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n.error-row[data-v-855bf63a] {\n\tborder-bottom: 1px solid #bd3f3f;\n\tpadding: 5px 0;\n\tmax-height: 100%;\n\toverflow-y: scroll;\n}\n","",{version:3,sources:["webpack://src/views/CollectorDetails.vue"],names:[],mappings:";AAkVA;CACA,eAAA;CACA,WAAA;CACA,iBAAA;CACA,cAAA;CACA,gBAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;AAEA;CACA,oBAAA;CACA,mBAAA;CACA,uBAAA;CACA,WAAA;CACA,sBAAA;CACA,kBAAA;AACA;AAEA;CACA,oBAAA;CACA,eAAA;CACA,WAAA;CACA,YAAA;CACA,cAAA;CACA,aAAA;CACA,kBAAA;CACA,iBAAA;AACA;AAEA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,kBAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;EACA,sBAAA;AACA;AACA;AAEA;CACA,aAAA;CACA,uBAAA;CACA,mBAAA;CACA,eAAA;AACA;AAEA;CACA,oBAAA;CACA,mBAAA;CACA,yBAAA;CACA,kBAAA;CACA,YAAA;CACA,aAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,eAAA;CACA,iBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,sBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,yBAAA;AACA;AAEA;CACA,qBAAA;AACA;AAEA;CACA,cAAA;CACA,yBAAA;CACA,kBAAA;CACA,kBAAA;CACA,YAAA;CACA,gBAAA;CACA,gBAAA;CACA,cAAA;CACA,kBAAA;AACA;AAEA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,cAAA;CACA,kBAAA;CACA,sBAAA;CACA,WAAA;CACA,kBAAA;CACA,sBAAA;CACA,SAAA;CACA,2BAAA;CACA,eAAA;CACA,yCAAA;AACA;AAEA;CACA,WAAA;CACA,kBAAA;CACA,SAAA;CACA,0CAAA;CACA,YAAA;CACA,WAAA;CACA,YAAA;CACA,sBAAA;CACA,WAAA;AACA;AAEA;CACA,cAAA;AACA;AAEA;AACA;EACA,gBAAA;AACA;AAEA;EACA,sBAAA;EACA,gBAAA;EACA,WAAA;AACA;AAEA;EACA,eAAA;EACA,SAAA;AACA;AACA;AAEA;CACA,iBAAA;AACA;AAEA;CACA,mBAAA;AACA;AAEA;CACA,oBAAA;CACA,eAAA;CACA,sBAAA;CACA,mBAAA;CACA,kBAAA;AACA;AAEA;AACA;EACA,sBAAA;EACA,cAAA;AACA;AAEA;EACA,eAAA;EACA,gBAAA;EACA,mBAAA;AACA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,yBAAA;CACA,WAAA;AACA;AAEA;CACA,YAAA;CACA,yBAAA;CACA,kBAAA;CACA,aAAA;CACA,iBAAA;CACA,kBAAA;AACA;AAEA;CACA,gCAAA;CACA,cAAA;CACA,gBAAA;CACA,kBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-if=\"!loading\" class=\"container\">\n\t\t<TasksEdit v-if=\"editingTask\" :opened.sync=\"editingTask\" />\n\t\t<div class=\"task-details\">\n\t\t\t<div class=\"task-details-heading\">\n\t\t\t\t<h2>\n\t\t\t\t\t{{ rootTitle }}\n\t\t\t\t\t<span v-if=\"isValidUser\"\n\t\t\t\t\t\t:class=\"!collapsedStatus\n\t\t\t\t\t\t\t? 'icon-triangle-n collapse-task-status-btn'\n\t\t\t\t\t\t\t: 'icon-triangle-s collapse-task-status-btn'\"\n\t\t\t\t\t\t:title=\"t('mediadc', 'Collapse task status')\"\n\t\t\t\t\t\t@click=\"collapseTaskStatus\" />\n\t\t\t\t</h2>\n\t\t\t\t<div v-if=\"isValidUser\" v-show=\"!collapsedStatus\" class=\"task-details-description\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ t('mediadc', 'Here you can view task details, manage task (stop or restart), ' +\n\t\t\t\t\t\t\t'delete found duplicated photos and videos.') }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ t('mediadc', 'Deleted files are placed in the trashbin, so that they can be restored in case of need.') }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"isValidUser\" v-show=\"!collapsedStatus\" class=\"task-status-row\">\n\t\t\t\t<div class=\"task-status\">\n\t\t\t\t\t<span :class=\"'badge ' + getStatusBadge(task)\">{{ getStatusBadge(task) }}</span>\n\t\t\t\t\t<div style=\"display: flex; flex-direction: column;\">\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<b>{{ parseTargetMtype(task) }}</b> {{ task.files_scanned !== task.files_total ? `${task.files_scanned}/` : '' }}{{ task.files_total }} {{ translatePlural('mediadc', 'file', 'files', task.files_total) }}\n\t\t\t\t\t\t\t({{ formatBytes(Number(task.files_total_size)) }})\n\t\t\t\t\t\t\t({{ task !== null && 'collector_settings' in task ? t('mediadc', 'precision: ') + JSON.parse(task.collector_settings).similarity_threshold + '%' : '' }})\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<b>{{ t('mediadc', 'Deleted: ') }} </b>\n\t\t\t\t\t\t\t{{ task.deleted_files_count }} {{ translatePlural('mediadc', 'file', 'files', task.deleted_files_count) }}\n\t\t\t\t\t\t\t({{ formatBytes(Number(task.deleted_files_size)) }})\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{{ parseUnixTimestamp(task.created_time) }}\n\t\t\t\t\t\t\t{{ Number(task.finished_time) > 0 ? ' - ' + parseUnixTimestamp(task.finished_time) : '' }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"app-content-list-menu\" style=\"margin: 0 0 0 10px; position: relative;\">\n\t\t\t\t\t\t<div class=\"icon-more actions-menu-button\" @click=\"openActionsPopup\" />\n\t\t\t\t\t\t<div :class=\"actionsOpened ? 'popovermenu open' : 'popovermenu'\"\n\t\t\t\t\t\t\tstyle=\"right: -1px;\">\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-history\" @click=\"restartTask(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Restart') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-rename\" @click=\"openEditTaskDialog(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Edit') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-pause\" @click=\"terminateTask(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Stop') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a class=\"icon-delete\" @click=\"deleteTask(task)\">\n\t\t\t\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Delete') }}</span>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"task-info\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Target directories') }}</h3>\n\t\t\t\t\t<div class=\"target-directories-list\">\n\t\t\t\t\t\t<div v-for=\"dir in taskInfo.target_directories\" :key=\"dir.fileid\" class=\"target-directory-row\">\n\t\t\t\t\t\t\t<div class=\"owner-tooltip\">\n\t\t\t\t\t\t\t\t<div class=\"tooltip-title\">\n\t\t\t\t\t\t\t\t\t{{ t('mediadc', 'onwer:') }} {{ dir.fileowner }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"tooltip-content\">\n\t\t\t\t\t\t\t\t\t<a :href=\"filesDirLink(dir)\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<b>\n\t\t\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\t\t\tdir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${currentUser}/files`, '') !== ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t? dir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${currentUser}/files`, '')\n\t\t\t\t\t\t\t\t\t\t\t\t\t: '/'\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t</b>\n\t\t\t\t\t\t\t\t\t\t({{ formatBytes(dir.filesize) }})\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"isValidUser\" class=\"details-row\">\n\t\t\t\t<DetailsList v-if=\"getStatusBadge(task) === 'finished'\"\n\t\t\t\t\t:filessize=\"filessize\"\n\t\t\t\t\t:filestotal=\"filestotal\" />\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<p style=\"text-align: center;\">\n\t\t\t\t\t<b>{{ t('mediadc', 'You are not allowed to manage other user\\'s tasks.') }}</b>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div v-if=\"task.errors !== undefined && task.errors.length > 0\" class=\"errors\">\n\t\t\t\t<h3>{{ t('mediadc', 'Task errors') }}</h3>\n\t\t\t\t<div v-for=\"error in task.errors.split('\\\\n')\" :key=\"error\" class=\"error-row\">\n\t\t\t\t\t{{ error }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { mapGetters } from 'vuex'\nimport Formats from '../mixins/Formats'\nimport { generateUrl } from '@nextcloud/router'\nimport DetailsList from '../components/details/DetailsList'\nimport { showSuccess, showError, showWarning } from '@nextcloud/dialogs'\nimport Configure from '../mixins/Configure'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport TasksEdit from '../components/tasks/TasksEdit'\n\nexport default {\n\tname: 'CollectorDetails',\n\tcomponents: {\n\t\tDetailsList,\n\t\tTasksEdit,\n\t},\n\tmixins: [\n\t\tFormats,\n\t\tConfigure,\n\t],\n\tprops: {\n\t\trootTitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tupdater: null,\n\t\t\tstatsUpdater: null,\n\t\t\tfilessize: 0,\n\t\t\tfilestotal: 0,\n\t\t\tactionsOpened: false,\n\t\t\tcollapsedStatus: false,\n\t\t\teditingTask: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'taskInfo',\n\t\t\t'details',\n\t\t\t'settingByName',\n\t\t]),\n\t\tisValidUser() {\n\t\t\treturn getCurrentUser().uid === this.task.owner\n\t\t},\n\t\tcurrentUser() {\n\t\t\treturn getCurrentUser().uid\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tthis.$emit('update:loading', true)\n\t\tthis.getTaskDetails()\n\t\tthis.getTaskInfo()\n\t\tsubscribe('restartTask', this.onRestartTaskEvent)\n\t\tsubscribe('updateTaskInfo', this.getDetailFilesTotalSize)\n\t\tthis.updater = setInterval(this.getTaskDetails, 5000)\n\t},\n\tbeforeDestroy() {\n\t\tclearInterval(this.updater)\n\t\tunsubscribe('updateTaskInfo', this.getTaskInfo)\n\t\tunsubscribe('restartTask', this.onRestartTaskEvent)\n\t},\n\tmethods: {\n\t\tterminateTask(task) {\n\t\t\tthis.toggleActionsPopup()\n\t\t\tif (this.isValidUser) {\n\t\t\t\tthis.terminating = true\n\t\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${task.id}/terminate`)).then(res => {\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Task terminated'))\n\t\t\t\t\tthis.terminating = false\n\t\t\t\t\tthis.getTaskDetails()\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'You are not allowed to terminate this task'))\n\t\t\t}\n\t\t},\n\t\trestartTask(task) {\n\t\t\tthis.toggleActionsPopup()\n\t\t\tif (this.isValidUser) {\n\t\t\t\tthis.restarting = true\n\t\t\t\tthis.getSettings().then(() => {\n\t\t\t\t\taxios.post(generateUrl('/apps/mediadc/api/v1/tasks/restart'), {\n\t\t\t\t\t\ttaskId: task.id,\n\t\t\t\t\t\ttargetDirectoryIds: task.target_directory_ids,\n\t\t\t\t\t\texcludeList: {\n\t\t\t\t\t\t\tuser: JSON.parse(task.exclude_list).user,\n\t\t\t\t\t\t\tadmin: JSON.parse(this.settingByName('exclude_list').value),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcollectorSettings: {\n\t\t\t\t\t\t\thashing_algorithm: JSON.parse(this.settingByName('hashing_algorithm').value) || 'dhash',\n\t\t\t\t\t\t\tsimilarity_threshold: Number(JSON.parse(this.task.collector_settings).similarity_threshold),\n\t\t\t\t\t\t\thash_size: Number(this.settingByName('hash_size').value) || 16,\n\t\t\t\t\t\t\ttarget_mtype: Number(JSON.parse(this.task.collector_settings).target_mtype),\n\t\t\t\t\t\t},\n\t\t\t\t\t}).then(res => {\n\t\t\t\t\t\tthis.restarting = false\n\t\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\t\tshowSuccess(this.t('mediadc', 'Task successfully restarted with previous settings!'))\n\t\t\t\t\t\t\tthis.getTaskDetails()\n\t\t\t\t\t\t\tthis.filessize = 0\n\t\t\t\t\t\t\tthis.filestotal = 0\n\t\t\t\t\t\t} else if (res.data.limit) {\n\t\t\t\t\t\t\tshowWarning(this.t('mediadc', 'Running tasks limit exceed. Try again later.'))\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tshowWarning(this.t('medaidc', 'Some error occured while running Collector Task. Try again.'))\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(err => {\n\t\t\t\t\t\tthis.restarting = false\n\t\t\t\t\t\tconsole.debug(err)\n\t\t\t\t\t\tshowError('Some error occured while running Collector Task. Try again.')\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'You are not allowed to restart this task'))\n\t\t\t}\n\t\t},\n\t\tdeleteTask(task) {\n\t\t\tthis.toggleActionsPopup()\n\t\t\tif (this.isValidUser) {\n\t\t\t\tif (confirm(this.t('mediadc', 'Are sure, you want delete this task?'))) {\n\t\t\t\t\tthis.deleting = true\n\t\t\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${task.id}`)).then(res => {\n\t\t\t\t\t\tthis.$router.push({ name: 'collector' })\n\t\t\t\t\t\tshowSuccess(this.t('mediadc', 'Task successfully deleted'))\n\t\t\t\t\t\tthis.deleting = false\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'You are not allowed to delete this task'))\n\t\t\t}\n\t\t},\n\t\tasync getTaskDetails() {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${this.$route.params.taskId}`)).then(res => {\n\t\t\t\tif ('success' in res.data && res.data.success) {\n\t\t\t\t\tthis.$store.dispatch('setTask', res.data.collectorTask)\n\t\t\t\t\tthis.$store.dispatch('setDetails', res.data.collectorTaskDetails)\n\t\t\t\t\tif (this.getStatusBadge(this.task) === 'finished'\n\t\t\t\t\t\t&& this.filestotal === 0 && this.filessize === 0) {\n\t\t\t\t\t\tthis.getDetailFilesTotalSize()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.$emit('update:loading', false)\n\t\t\t})\n\t\t},\n\t\tasync getTaskInfo() {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${this.$route.params.taskId}/info`)).then(res => {\n\t\t\t\tthis.$store.dispatch('setTaskInfo', res.data.collectorTaskInfo)\n\t\t\t})\n\t\t},\n\t\tasync getDetailFilesTotalSize() {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${this.$route.params.taskId}/filestotal`)).then(res => {\n\t\t\t\tthis.filessize = res.data.filessize\n\t\t\t\tthis.filestotal = res.data.filestotal\n\t\t\t})\n\t\t},\n\t\topenActionsPopup() {\n\t\t\tdocument.addEventListener('click', this.toggleActionsPopup)\n\t\t},\n\t\ttoggleActionsPopup() {\n\t\t\tif (this.actionsOpened) {\n\t\t\t\tdocument.removeEventListener('click', this.toggleActionsPopup)\n\t\t\t}\n\t\t\tthis.actionsOpened = !this.actionsOpened\n\t\t},\n\t\tcollapseTaskStatus() {\n\t\t\tthis.collapsedStatus = !this.collapsedStatus\n\t\t},\n\t\topenEditTaskDialog() {\n\t\t\tthis.editingTask = true\n\t\t},\n\t\tfilesDirLink(dir) {\n\t\t\tif (dir) {\n\t\t\t\tconst path = dir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${this.currentUser}/files`, '') !== ''\n\t\t\t\t\t? dir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${this.currentUser}/files`, '')\n\t\t\t\t\t: '/'\n\t\t\t\treturn generateUrl(`/apps/files?dir=${path}`)\n\t\t\t}\n\t\t\treturn '#'\n\t\t},\n\t\tonRestartTaskEvent() {\n\t\t\tthis.getTaskInfo()\n\t\t\tthis.getTaskDetails()\n\t\t\tthis.filessize = 0\n\t\t\tthis.filestotal = 0\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.container {\n\tpadding: 0 20px;\n\twidth: 100%;\n\tmax-width: 1440px;\n\tmargin: 0 auto;\n\tmax-height: 100%;\n}\n\n@media (min-width: 1920px) {\n\t.container {\n\t\tmax-width: 80vw;\n\t}\n}\n\nh2 {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\tmargin: 20px auto 10px;\n\ttext-align: center;\n}\n\n.collapse-task-status-btn {\n\tdisplay: inline-flex;\n\tcursor: pointer;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 0 10px;\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n\n.task-details-heading p {\n\ttext-align: center;\n}\n\n.details-row {\n\tdisplay: flex;\n\tmargin: 0 10px 20px;\n\tposition: relative;\n}\n\n@media (max-width: 767px) {\n\t.details-row {\n\t\tflex-wrap: wrap;\n\t}\n\t.task-details-heading {\n\t\tflex-direction: column;\n\t}\n}\n\n.task-status-row {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-wrap: wrap;\n}\n\n.task-status {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tmargin: 20px;\n\tpadding: 10px;\n}\n\n.actions-menu-button {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n\n.actions-menu-button:hover, .collapse-task-status-btn:hover {\n\tbackground-color: #eee;\n}\n\n.actions-menu-button:active, .collapse-task-status-btn:active {\n\tbackground-color: #ddd;\n}\n\nbody.theme--dark .actions-menu-button:hover, body.theme--dark .collapse-task-status-btn:hover {\n\tbackground-color: #727272;\n}\n\nbody.theme--dark .actions-menu-button:active, body.theme--dark .collapse-task-status-btn:active {\n\tbackground-color: #5b5b5b;\n}\n\nbody.theme--dark .task-status, body.theme--dark .task-info {\n\tborder-color: #717171;\n}\n\n.task-info {\n\tmargin: 20px 0;\n\tborder: 1px solid #dadada;\n\tborder-radius: 5px;\n\tpadding: 10px 20px;\n\theight: 100%;\n\tmin-height: 94px;\n\tmax-height: 94px;\n\tmax-width: 50%;\n\toverflow-y: scroll;\n}\n\n.owner-tooltip {\n\tposition: relative;\n}\n\n.tooltip-title {\n\tdisplay: none;\n\tpadding: 0 5px;\n\tborder-radius: 5px;\n\tbackground-color: #000;\n\tcolor: #fff;\n\tposition: absolute;\n\ttop: calc(-100% - 5px);\n\tleft: 50%;\n\ttransform: translateX(-50%);\n\tfont-size: 12px;\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5);\n}\n\n.tooltip-title:before {\n\tcontent: '';\n\tposition: absolute;\n\tleft: 50%;\n\ttransform: translateX(-50%) rotateZ(45deg);\n\tbottom: -3px;\n\twidth: 10px;\n\theight: 10px;\n\tbackground-color: #000;\n\tz-index: -1;\n}\n\n.owner-tooltip:hover .tooltip-title {\n\tdisplay: block;\n}\n\n@media (max-width: 767px) {\n\t.details-row {\n\t\tmargin: 0 0 20px;\n\t}\n\n\t.task-status {\n\t\tflex-direction: column;\n\t\tmargin: 0 0 20px;\n\t\twidth: 100%;\n\t}\n\n\t.task-info {\n\t\tmax-width: 100%;\n\t\tmargin: 0;\n\t}\n}\n\n.task-info h3 {\n\tmargin: 0 0 5px 0;\n}\n\n.target-directory-row {\n\twhite-space: nowrap;\n}\n\n.badge {\n\tdisplay: inline-flex;\n\tpadding: 0 10px;\n\tbackground-color: #eee;\n\tborder-radius: 20px;\n\tmargin-right: 20px;\n}\n\n@media (max-width: 540px) {\n\t.task-status-row {\n\t\tflex-direction: column;\n\t\tmargin: 20px 0;\n\t}\n\n\t.badge {\n\t\tmargin-right: 0;\n\t\tmargin-top: 10px;\n\t\tmargin-bottom: 10px;\n\t}\n}\n\n.badge.finished {\n\tbackground-color: #49b382;\n\tcolor: #fff;\n}\n\n.badge.running, .badge.pending {\n\tbackground-color: #dadada;\n\tcolor: #000;\n}\n\n.badge.error {\n\tbackground-color: #bd3f3f;\n\tcolor: #fff;\n}\n\n.badge.terminated {\n\tbackground-color: #f17b1b;\n\tcolor: #fff;\n}\n\n.errors {\n\tmargin: 20px;\n\tborder: 1px solid #bd3f3f;\n\tborder-radius: 5px;\n\tpadding: 10px;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n\n.error-row {\n\tborder-bottom: 1px solid #bd3f3f;\n\tpadding: 5px 0;\n\tmax-height: 100%;\n\toverflow-y: scroll;\n}\n</style>\n"],sourceRoot:""}]);const a=s},46700:(t,e,i)=>{var n={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":94470,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":94470,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function s(t){var e=a(t);return i(e)}function a(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}s.keys=function(){return Object.keys(n)},s.resolve=a,t.exports=s,s.id=46700},66381:(e,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>Z});var s=n(4820),a=n(20629),l=n(84440),d=n(79753),o=n(26932),r=n(22200),c=n(74854),A=n(7826),h=n.n(A),p=n(25108);const u={name:"DetailsFile",components:{CheckboxRadioSwitch:h()},mixins:[l.Z],props:{file:{type:Object,required:!0},files:{type:Array,required:!0},allFiles:{type:Array,required:!0},checkedFiles:{type:Array,required:!0},detail:{type:Object,required:!0}},data:()=>({loaded:!1,checked:!1,updating:!1}),computed:{...(0,a.Se)(["detailsGridSize","deleteFileConfirmation","details"]),imageUrl(){return this.file.has_preview?(0,d.generateUrl)("/core/preview?fileId=".concat(this.file.fileid,"&x=").concat(this.detailsGridSize,"&y=").concat(this.detailsGridSize,"$forceIcon=0")):(0,d.generateRemoteUrl)("dav/files".concat(this.file.filepath.replace("files/","")))}},watch:{checked(){const t=this.checkedFiles,e=t.findIndex((t=>t.fileid===this.file.fileid));this.checked?-1===e&&t.push(this.file):-1!==e&&t.splice(e,1),this.$emit("update:checkedFiles",t)},checkedFiles(){const t=this.checkedFiles.findIndex((t=>t.fileid===this.file.fileid));this.checked||-1===t||(this.checked=!0)}},beforeMount(){const t=this.checkedFiles.findIndex((t=>t.fileid===this.file.fileid));this.checked=-1!==t,(0,c.subscribe)("deselectFiles",this.deselect)},beforeDestroy(){(0,c.unsubscribe)("deselectFiles",this.deselect)},methods:{openFile(t){const e=this.files.map((t=>({basename:t.filename,fileid:t.fileid,filename:t.filepath.replace("/".concat((0,r.getCurrentUser)().uid,"/files"),""),getcontentlength:t.filesize,getcontenttype:t.filemtype,mime:t.filemtype,size:t.filesize})));OCA.Viewer.open({path:t.filepath.replace("/".concat((0,r.getCurrentUser)().uid,"/files"),""),list:e.map((t=>({...t,list:e})))})},onLoad(){this.loaded=!0},deleteGroupFile(e){this.deleteFileConfirmation?confirm(t("mediadc","Are you sure, you want delete this file?"))&&this._deleteGroupFile(e):this._deleteGroupFile(e)},_deleteGroupFile(t){this.updating=!0,s.default.delete((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(this.detail.task_id,"/files/").concat(this.detail.id,"/").concat(t.fileid))).then((e=>{if(e.data.success){const i=this.files;2===this.allFiles.length&&((0,c.emit)("openNextDetailGroup",this.detail),this.$store.dispatch("deleteDetail",this.detail),(0,o.PV)(this.t("mediadc","Group successfully removed (1 file left)")));const n=i.findIndex((e=>e.fileid===t.fileid));i.splice(n,1);const s=this.checkedFiles.findIndex((e=>e.fileid===t.fileid));if(this.checked&&-1!==s){const t=this.checkedFiles;t.splice(s,1),this.$emit("update:checkedFiles",t)}this.$emit("update:files",i),(0,c.emit)("updateTaskInfo"),this.$store.dispatch("setTask",e.data.task).then((()=>{(0,c.emit)("updateGroupFilesPagination",this.file)}))}else"locked"in e.data&&e.data.locked?(0,o.K2)(this.t("mediadc","Wait until file loaded before deleting")):"not_permited"in e.data&&e.data.not_permited?(0,o.x2)(this.t("mediadc","Not enough permitions to delete file")):"not_found"in e.data&&e.data.not_found?(0,o.x2)(this.t("mediadc","File not found. Probably it's already deleted")):(0,o.x2)(this.t("mediadc","Some error occured while deleting file"));this.updating=!1})).catch((t=>{p.debug(t),(0,o.x2)(this.t("mediadc","Some error occured while deleting file")),this.updating=!1}))},deselect(t){this.checked&&t.map((t=>t.fileid)).includes(this.file.fileid)&&(this.checked=!1)}}},f=u;var g=n(93379),m=n.n(g),k=n(74776),C={insert:"head",singleton:!1};m()(k.Z,C);k.Z.locals;var v=n(51900);const b=(0,v.Z)(f,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"file",style:"width: "+t.detailsGridSize+"px;"},[t.updating?i("div",{staticClass:"updating-blackout"},[i("span",{staticClass:"icon-loading"})]):t._e(),t._v(" "),i("div",{staticClass:"file-thumb",on:{click:function(e){return t.openFile(t.file)}}},["image"===t.file.filempart||"video"===t.file.filempart&&t.file.has_preview?i("div",{directives:[{name:"show",rawName:"v-show",value:t.loaded,expression:"loaded"}],staticClass:"file-thumb-loaded"},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.loaded,expression:"loaded"}],key:t.file.filepath,attrs:{src:t.imageUrl,alt:t.file.filename,title:t.file.filepath},on:{load:t.onLoad}})]):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.loaded&&"video"===t.file.filempart,expression:"!loaded && file.filempart === 'video'"}],staticClass:"placeholder",style:"min-height: "+t.detailsGridSize+"px",attrs:{title:t.file.filepath}},[i("svg",{attrs:{width:"50%",height:"50%",version:"1.1",viewBox:"-31 0 512 512",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"m440.59 206.68h-341.17l327.7-94.93c2.5469-0.73828 4.6953-2.4609 5.9766-4.7812 1.2812-2.3242 1.5859-5.0586 0.84766-7.6055l-17.148-59.199c-6.8516-23.645-28.867-40.16-53.539-40.16-5.1992 0-10.379 0.73828-15.402 2.1914l-307.68 89.129c-14.23 4.1211-26.023 13.582-33.215 26.633-7.1875 13.051-8.875 28.078-4.7539 42.305l16.754 57.836v238.25c0 30.688 24.965 55.652 55.648 55.652h120.16c5.5234 0 10-4.4766 10-10s-4.4766-10-10-10h-120.16c-19.66 0-35.652-15.992-35.652-35.652v-136.09h391.63v136.09c2.1e-4 19.66-15.992 35.652-35.652 35.652h-120.16c-5.5195 0-10 4.4766-10 10s4.4805 10 10 10h120.16c30.688 0 55.652-24.965 55.652-55.652v-239.67c0-5.5234-4.4766-10-10-10zm-176.33 93.586 42.488-73.586h55.262l-42.484 73.586zm-78.359 0 42.488-73.586h55.262l-42.484 73.586zm-78.355 0 42.484-73.586h55.266l-42.488 73.586zm37.18-129.46-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543l71.148 68.336-53.309 15.441c-0.375-0.54688-0.81641-1.0664-1.3125-1.543zm134-125.84 71.148 68.336-53.309 15.441c-0.375-0.54688-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543zm-75.266 21.805 71.148 68.332-53.309 15.445c-0.375-0.54687-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.37891 0.54297 0.81641 1.0625 1.3125 1.543zm149.96-45.367c3.2109-0.92969 6.5195-1.4023 9.8359-1.4023 15.824 0 29.938 10.578 34.328 25.727l14.367 49.59-40.121 11.621c-0.3789-0.54688-0.8164-1.0625-1.3164-1.543l-71.145-68.332zm-328.94 106.2c4.6094-8.3711 12.16-14.434 21.262-17.07l5.875-1.7031c0.37891 0.54688 0.81641 1.0664 1.3125 1.543l71.148 68.336-88.293 25.578-14.367-49.59c-2.6367-9.0976-1.5469-18.719 3.0625-27.094zm14.48 99.074h87.973l-42.484 73.586h-45.488zm303.66 73.586 42.484-73.586h45.488v73.586z"}}),t._v(" "),i("path",{attrs:{d:"m303.92 405.11c0-3.5742-1.9062-6.875-5-8.6602l-87.855-50.723c-3.0938-1.7852-6.9062-1.7852-10 0-3.0938 1.7852-5 5.0859-5 8.6602v101.45c0 3.5703 1.9062 6.8711 5 8.6562 1.5469 0.89453 3.2734 1.3438 5 1.3438 1.7266 0 3.4531-0.44922 5-1.3438l87.855-50.719c3.0938-1.7852 5-5.0859 5-8.6602zm-87.855 33.402v-66.805l57.855 33.402z"}}),t._v(" "),i("path",{attrs:{d:"m234.77 492c-5.5078 0-10 4.4922-10 10s4.4922 10 10 10c5.5117 0 10-4.4922 10-10s-4.4883-10-10-10z"}})])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.loaded&&"image"===t.file.filempart,expression:"!loaded && file.filempart === 'image'"}],staticClass:"placeholder",style:"min-height: "+t.detailsGridSize+"px",attrs:{title:t.file.filepath}},[i("svg",{attrs:{width:"50%","enable-background":"new 0 0 512 512",version:"1.1",viewBox:"0 0 512 512","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"m446.58 0h-381.15c-36.076 0-65.425 29.35-65.425 65.426v381.15c0 36.075 29.349 65.425 65.425 65.425h381.15c36.076 0 65.425-29.35 65.425-65.426v-381.15c0-36.076-29.349-65.426-65.425-65.426zm35.267 446.58c0 19.447-15.821 35.267-35.267 35.267h-381.15c-19.447 0-35.268-15.821-35.268-35.267v-55.007l99.255-84.451c3.622-3.082 8.906-3.111 12.562-0.075l62.174 51.628c5.995 4.977 14.795 4.569 20.304-0.946l147.73-147.95c2.67-2.675 5.783-2.935 7.408-2.852 1.62 0.083 4.695 0.661 7.078 3.596l95.176 117.19v118.87zm0-166.71-71.766-88.366c-7.117-8.764-17.666-14.122-28.942-14.701-11.268-0.57-22.317 3.672-30.294 11.662l-138.01 138.22-51.59-42.839c-14.959-12.422-36.563-12.293-51.373 0.308l-79.712 67.822v-286.55c0-19.447 15.821-35.268 35.268-35.268h381.15c19.447 0 35.267 15.821 35.267 35.268v214.44z"}}),t._v(" "),i("path",{attrs:{d:"m161.17 62.995c-40.095 0-72.713 32.62-72.713 72.713 0 40.094 32.619 72.713 72.713 72.713s72.713-32.619 72.713-72.713-32.618-72.713-72.713-72.713zm0 115.27c-23.466 0-42.556-19.091-42.556-42.556 0-23.466 19.09-42.556 42.556-42.556s42.556 19.091 42.556 42.556-19.09 42.556-42.556 42.556z"}})])])]),t._v(" "),i("div",{staticClass:"file-info"},[i("span",{staticClass:"filename",attrs:{title:t.file.filepath}},[t._v(t._s(t.file.filename))]),t._v(" "),i("span",{staticClass:"owner"},[t._v(t._s(t.file.fileowner))]),t._v(" "),i("span",{staticClass:"size"},[t._v(t._s(t.formatBytes(Number(t.file.filesize))))]),t._v(" "),i("div",{staticClass:"actions",staticStyle:{display:"flex"}},[i("CheckboxRadioSwitch",{staticClass:"batch-checkbox",staticStyle:{"margin-right":"20px"},attrs:{checked:t.checked},on:{"update:checked":function(e){t.checked=e}}}),t._v(" "),i("span",{staticClass:"delete-file-btn icon-delete-white",on:{click:function(e){return t.deleteGroupFile(t.file)}}})],1)])])}),[],!1,null,"0f225859",null).exports;var x=n(25108);const y={name:"DetailsGroupList",components:{DetailsFile:b},mixins:[l.Z],props:{files:{type:Array,required:!0,default:()=>[]},allFiles:{type:Array,required:!0,default:()=>[]},detail:{type:Object,required:!0},loadingFiles:{type:Boolean,required:!0},updating:{type:Boolean,required:!0},filesAscending:{type:Boolean,required:!0}},data:()=>({checkedFiles:[],batchActionsOpened:!1,filesFiltered:!1,filterFileName:"",filteredFiles:[]}),computed:{...(0,a.Se)(["detailsGridSize","deleteFileConfirmation","groupItemsPerPage","details"]),checkedFilesIntersect(){const t=new Set(this.files),e=new Set(this.checkedFiles),i=new Set([...t].filter((t=>e.has(t))));return Array.from(i)}},watch:{files(){this.filterByFileName()}},methods:{openBatchActionsPopup(){document.addEventListener("click",this.toggleBatchActionsPopup)},toggleBatchActionsPopup(){this.batchActionsOpened&&document.removeEventListener("click",this.toggleBatchActionsPopup),this.batchActionsOpened=!this.batchActionsOpened},selectAllFiles(){if(this.checkedFiles.length===this.allFiles.length){(0,c.emit)("deselectFiles",this.checkedFiles);for(const t of this.allFiles){const e=this.checkedFiles.findIndex((e=>e.fileid===t.fileid));-1!==e&&this.checkedFiles.splice(e,1)}}else for(const t of this.allFiles){-1===this.checkedFiles.findIndex((e=>e.fileid===t.fileid))&&this.checkedFiles.push(t)}},selectAllFilesOnPage(){if(this.files.length===this.checkedFilesIntersect.length){const t=this.checkedFilesIntersect;(0,c.emit)("deselectFiles",t);for(const e of t.map((t=>t.fileid))){const t=this.checkedFiles.findIndex((t=>t.fileid===e));-1!==t&&this.checkedFiles.splice(t,1)}}else for(const t of this.files){-1===this.checkedFiles.findIndex((e=>e.fileid===t.fileid))&&this.checkedFiles.push(t)}},removeCheckedFiles(){this.$emit("update:updating",!0),s.default.post((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(this.detail.task_id,"/files/").concat(this.detail.id,"/remove")),{fileIds:this.checkedFiles.map((t=>t.fileid))}).then((t=>{if(t.data.success){const e=this.allFiles;this.allFiles.length-this.checkedFiles.length<=1&&((0,c.emit)("openNextDetailGroup",this.detail),this.$store.dispatch("deleteDetail",this.detail),this.allFiles.length-this.checkedFiles.length==1&&(0,o.PV)(this.t("mediadc","Group successfully removed (1 file left)")));for(const i of t.data.removedFileIds){const t=e.findIndex((t=>t.fileid===i));e.splice(t,1);const n=this.checkedFiles.findIndex((t=>t.fileid===i));-1!==n&&this.checkedFiles.splice(n,1)}(0,c.emit)("updateTaskInfo"),this.$emit("update:allFiles",e),(0,c.emit)("updateGroupFilesPagination"),this.$emit("update:updating",!1),(0,o.s$)(this.t("mediadc","Checked files successfully removed"))}})).catch((t=>{x.debug(t),(0,o.x2)(this.t("mediadc","Some server error occured")),this.$emit("update:updating",!1)}))},deleteCheckedFiles(){this.allFiles.length===this.checkedFiles.length?confirm(this.t("mediadc","Are you sure, you want delete all files"))&&this._deleteCheckedFiles():this._deleteCheckedFiles()},_deleteCheckedFiles(){this.$emit("update:updating",!0),s.default.post((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(this.detail.task_id,"/files/").concat(this.detail.id,"/delete")),{fileIds:this.checkedFiles.map((t=>t.fileid))}).then((t=>{t.data.success?this._updateDeletedFiles(t):!t.data.success&&t.data.deletedFileIds.length>0?((0,o.K2)(this.t("mediadc","Not all files deleted")),this._updateDeletedFiles(t)):(x.debug(t.data.errors),(0,o.x2)(this.t("mediadc","Some server error occured. Files not deleted")),this.$emit("update:updating",!1))})).catch((t=>{x.debug(t),(0,o.x2)(this.t("mediadc","Some server error occured")),this.$emit("update:updating",!1)}))},_updateDeletedFiles(t){const e=this.allFiles;this.allFiles.length-this.checkedFiles.length<=1&&t.data.deletedFileIds.length===this.checkedFiles.length&&((0,c.emit)("openNextDetailGroup",this.detail),this.$store.dispatch("deleteDetail",this.detail),this.allFiles.length-this.checkedFiles.length==1&&(0,o.PV)(this.t("mediadc","Group successfully removed (1 file left)")));for(const i of t.data.deletedFileIds){const t=e.findIndex((t=>t.fileid===i));e.splice(t,1);const n=this.checkedFiles.findIndex((t=>t.fileid===i));-1!==n&&this.checkedFiles.splice(n,1)}(0,c.emit)("updateTaskInfo"),this.$emit("update:allFiles",e),(0,c.emit)("updateGroupFilesPagination"),this.$emit("update:updating",!1),(0,o.s$)(this.t("mediadc","Checked files successfully deleted"))},filterByFileName(){""!==this.filterFileName?(this.filesFiltered=!0,this.filteredFiles=this.files.filter((t=>t.filename.toLowerCase().includes(this.filterFileName.toLowerCase())))):(this.filesFiltered=!1,this.filteredFiles=[])},updateFileSorting(){this.$emit("update:filesAscending",!this.filesAscending)}}};var w=n(30144),F={insert:"head",singleton:!1};m()(w.Z,F);w.Z.locals;const _=(0,v.Z)(y,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.loadingFiles?i("div",[i("span",{staticClass:"icon-loading",staticStyle:{width:"20px",height:"20px",display:"flex",margin:"20px auto"}})]):i("div",{staticClass:"details-group"},[i("div",{staticClass:"filters"},[i("div",{staticClass:"sorting"},[t._v("\n\t\t\t"+t._s(t.t("mediadc","Files size sorting"))+"\n\t\t\t"),i("span",{class:t.filesAscending?"icon-triangle-s sorting-group-files-btn":"icon-triangle-n sorting-group-files-btn",on:{click:t.updateFileSorting}})]),t._v(" "),i("div",{staticClass:"search"},[i("label",{attrs:{for:"filename-filter"}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Filter by filename: "))+"\n\t\t\t\t"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filterFileName,expression:"filterFileName"}],attrs:{id:"filename-filter",type:"search",name:"filename-filter",placeholder:t.t("mediadc","Filename or part")},domProps:{value:t.filterFileName},on:{input:[function(e){e.target.composing||(t.filterFileName=e.target.value)},t.filterByFileName]}})])]),t._v(" "),t.checkedFiles.length>0?i("div",{staticClass:"batch-editing"},[t._v("\n\t\t\t"+t._s(t.translatePlural("mediadc","Batch actions for %n file","Batch actions for %n files",t.checkedFiles.length))+"\n\t\t\t"),i("div",{staticClass:"app-content-list-menu",staticStyle:{margin:"0 0 0 10px",position:"relative"}},[i("div",{staticClass:"icon-more batch-actions-menu-button",on:{click:t.openBatchActionsPopup}}),t._v(" "),i("div",{class:t.batchActionsOpened?"popovermenu open":"popovermenu",staticStyle:{right:"-1px"}},[i("ul",[i("li",[i("a",{staticClass:"icon-checkmark",on:{click:t.selectAllFiles}},[i("span",[t._v(t._s(t.checkedFiles.length===t.allFiles.length?t.t("mediadc","Deselect all"):t.t("mediadc","Select all")))])])]),t._v(" "),JSON.parse(t.detail.group_files_ids).length>t.groupItemsPerPage?i("li",[i("a",{staticClass:"icon-checkmark",on:{click:t.selectAllFilesOnPage}},[i("span",[t._v(t._s(t.checkedFilesIntersect.length===t.files.length?t.t("mediadc","Deselect all on page"):t.t("mediadc","Select all on page")))])])]):t._e(),t._v(" "),i("li",[i("a",{staticClass:"icon-close",attrs:{title:t.t("mediadc","Remove without deleting")},on:{click:t.removeCheckedFiles}},[i("span",[t._v(t._s(t.translatePlural("mediadc","Remove file","Remove files",t.checkedFiles.length)))])])]),t._v(" "),i("li",[i("a",{staticClass:"icon-delete",on:{click:t.deleteCheckedFiles}},[i("span",[t._v(t._s(t.translatePlural("mediadc","Delete file","Delete files",t.checkedFiles.length)))])])])])])])]):t._e()]),t._v(" "),t.filesFiltered?t.filteredFiles.length>0?i("div",{staticClass:"details-group-files"},t._l(t.filteredFiles,(function(e){return i("DetailsFile",{key:e.fileid,attrs:{file:e,files:t.files,"all-files":t.allFiles,"checked-files":t.checkedFiles,detail:t.detail},on:{"update:checkedFiles":function(e){t.checkedFiles=e},"update:checked-files":function(e){t.checkedFiles=e}}})})),1):i("div",{staticClass:"details-group-files"},[i("p",{staticStyle:{margin:"0 0 10px"}},[t._v("\n\t\t\t"+t._s(t.t("mediadc","No matches on this page"))+"\n\t\t")])]):i("div",{staticClass:"details-group-files"},t._l(t.files,(function(e){return i("DetailsFile",{key:e.fileid,attrs:{file:e,files:t.files,"all-files":t.allFiles,"checked-files":t.checkedFiles,detail:t.detail},on:{"update:checkedFiles":function(e){t.checkedFiles=e},"update:checked-files":function(e){t.checkedFiles=e}}})})),1)])}),[],!1,null,"287ce272",null).exports;var I=n(25108);const D={name:"DetailsListItem",components:{DetailsGroupList:_,CheckboxRadioSwitch:h()},mixins:[l.Z],props:{detail:{type:Object,required:!0},checkedDetailGroups:{type:Array,required:!0}},data:()=>({opened:!1,page:0,totalPages:0,loadingFiles:!1,files:[],allFiles:[],paginatedFiles:{},checked:!1,filesAscending:!1,updating:!1}),computed:{...(0,a.Se)(["task","details","groupItemsPerPage"]),groupFilesSize(){return this.allFiles.length>0?this.allFiles.reduce(((t,e)=>t+e.filesize),0):0}},watch:{checked(){const t=this.checkedDetailGroups,e=t.findIndex((t=>t.id===this.detail.id));this.checked?-1===e&&t.push(this.detail):-1!==e&&t.splice(e,1),this.$emit("update:checkedDetailGroups",t)},filesAscending(){this.sortFiles(this.filesAscending)},checkedDetailGroups(){const t=this.checkedDetailGroups.findIndex((t=>t.id===this.detail.id));this.checked||-1===t||(this.checked=!0)},groupItemsPerPage(t){this.opened&&(this.page>=Math.ceil(JSON.parse(this.detail.group_files_ids).length/t)&&(this.page=Math.ceil(JSON.parse(this.detail.group_files_ids).length/t)-1),this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page])},allFiles(t){this.page>=Math.ceil(t.length/this.groupItemsPerPage)&&(this.page=Math.ceil(t.length/this.groupItemsPerPage)-1,this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page])}},beforeMount(){const t=this.checkedDetailGroups.findIndex((t=>t.id===this.detail.id));this.checked=-1!==t,(0,c.subscribe)("updateGroupFilesPagination",this.updateFilesPagination),(0,c.subscribe)("deselectGroups",this.deselect),(0,c.subscribe)("openGroup",this.openGroup)},beforeDestroy(){(0,c.unsubscribe)("updateGroupFilesPagination",this.updateFilesPagination),(0,c.unsubscribe)("deselectGroups",this.deselect),(0,c.unsubscribe)("openGroup",this.openGroup)},methods:{openDetailFiles(t){if(this.opened)this.opened=!1;else if(void 0===this.files||0===this.files.length){const e=t.task_id,i=t.id;this.loadingFiles=!0,this.opened=!0,0===this.allFiles.length?this.loadAllFilesInfo(e,i):(this.files=this.paginatedFiles[this.page],this.loadingFiles=!1)}else this.opened=!0},openNextDetailFiles(t){this.page<Math.ceil(JSON.parse(t.group_files_ids).length/this.groupItemsPerPage)-1?(this.page+=1,this.files=this.paginatedFiles[this.page]):(0,o.K2)(this.t("mediadc","Last page reached!"))},openPrevDetailFiles(t){this.page>0?(this.page-=1,this.files=this.paginatedFiles[this.page]):(0,o.K2)(this.t("mediadc","First page reached!"))},loadAllFilesInfo(t,e){s.default.get((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t,"/files/").concat(e,"/all"))).then((t=>{this.allFiles=t.data.files,this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page],this.loadingFiles=!1}))},paginateFiles(t){const e=[];for(let i=0;i<t.length;i++){const n=e[e.length-1];n&&n.length!==this.groupItemsPerPage?n.push(t[i]):e.push([t[i]])}return e},removeTaskDetail(t){confirm(this.t("mediadc","Are you sure, you want remove this group without deleting files?"))&&(this.updating=!0,s.default.delete((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t.task_id,"/detail/").concat(t.id))).then((e=>{if(e.data.success){(0,c.emit)("openNextDetailGroup",this.detail);const e=[...this.details],i=e.findIndex((t=>t.id===this.detail.id));e.splice(i,1),this.$store.dispatch("setDetails",e);const n=this.checkedDetailGroups.findIndex((e=>e.id===t.id)),s=[...this.checkedDetailGroups];this.checked&&-1!==n&&(s.splice(n,1),this.$emit("update:checkedDetailGroups",s)),(0,c.emit)("updateTaskInfo"),(0,o.s$)(this.t("mediadc","Duplicate group succesffully removed"));const a=this.checkedDetailGroups.findIndex((e=>e.id===t.id));if(-1!==a){const t=this.checkedDetailGroups;t.splice(a,1),this.$emit("update:checkedDetailGroups",t)}this.updating=!1}else(0,o.x2)(this.t("mediadc","Some error occured while deleting duplicate group")),this.updating=!1})).catch((t=>{I.debug(t),(0,o.x2)(this.t("mediadc","Some error occured while deleting duplicate group")),this.updating=!1})))},sortFiles(t){this.allFiles.sort(((e,i)=>t?e.filesize-i.filesize:i.filesize-e.filesize)),this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page]},updateFilesPagination(t){if(t){const e=this.allFiles.findIndex((e=>e.fileid===t.fileid));-1!==e&&this.allFiles.splice(e,1)}this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page]},deselect(t){this.checked&&t.includes(this.detail.id)&&(this.checked=!1)},openGroup(t){this.detail.id!==t.id||this.opened||this.openDetailFiles(t)}}},B=D;var S=n(62536),P={insert:"head",singleton:!1};m()(S.Z,P);S.Z.locals;const E=(0,v.Z)(B,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"details-list-item"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.updating,expression:"updating"}],staticClass:"action-blackout"},[i("span",{staticClass:"icon-loading"})]),t._v(" "),i("div",{staticClass:"details-list-item-title"},[i("CheckboxRadioSwitch",{staticClass:"batch-checkbox",attrs:{checked:t.checked},on:{"update:checked":function(e){t.checked=e}}}),t._v(" "),i("span",{staticClass:"group-info",on:{click:function(e){return t.openDetailFiles(t.detail)}}},[i("span",{staticClass:"icon-projects",staticStyle:{margin:"0 10px 0 10px"}}),t._v("\n\t\t\t"+t._s(t.t("mediadc","Duplicate group"))+" #"+t._s(t.detail.id)+" ("+t._s(JSON.parse(t.detail.group_files_ids).length)+"\n\t\t\t"+t._s(t.translatePlural("mediadc","file","files",JSON.parse(t.detail.group_files_ids).length))+t._s(Array.isArray(t.files)&&t.files.length>0?" - "+t.formatBytes(t.groupFilesSize):"")+")\n\t\t\t"),i("span",{class:t.opened?"icon-triangle-n open-details-btn":"icon-triangle-s open-details-btn"})]),t._v(" "),i("span",{staticClass:"icon-delete delete-group-btn",attrs:{title:t.t("mediadc","Remove group without deleting files")},on:{click:function(e){return t.removeTaskDetail(t.detail)}}})],1),t._v(" "),t.opened&&JSON.parse(t.detail.group_files_ids).length>t.groupItemsPerPage?i("div",{staticClass:"pagination"},[i("span",{staticClass:"icon-view-previous pagination-button",on:{click:function(e){return t.openPrevDetailFiles(t.detail)}}}),t._v(" "),i("span",[t._v(t._s(t.t("mediadc","Page:"))+" ")]),t._v(" "),i("span",[t._v(t._s(t.page+1)+"/"+t._s(Math.ceil(JSON.parse(t.detail.group_files_ids).length/t.groupItemsPerPage)))]),t._v(" "),i("span",{staticClass:"icon-view-next pagination-button",on:{click:function(e){return t.openNextDetailFiles(t.detail)}}})]):t._e(),t._v(" "),i("DetailsGroupList",{directives:[{name:"show",rawName:"v-show",value:t.opened,expression:"opened"}],attrs:{detail:t.detail,files:t.files,"all-files":t.allFiles,"loading-files":t.loadingFiles,updating:t.updating,"files-ascending":t.filesAscending},on:{"update:loadingFiles":function(e){t.loadingFiles=e},"update:loading-files":function(e){t.loadingFiles=e},"update:updating":function(e){t.updating=e},"update:filesAscending":function(e){t.filesAscending=e},"update:files-ascending":function(e){t.filesAscending=e}}})],1)}),[],!1,null,"08060f22",null).exports;var G=n(25108);const T={name:"DetailsList",components:{DetailsListItem:E,CheckboxRadioSwitch:h()},mixins:[l.Z],props:{filessize:{type:Number,required:!0},filestotal:{type:Number,required:!0}},data:()=>({page:0,filterId:null,checkedDetailGroups:[],batchActionsOpened:!1,batchActionResult:null,batchUpdating:!1,sortGroups:!0}),computed:{...(0,a.Se)(["task","details","sortedDetails","sorted","paginatedDetails","paginatedSortedDetails","itemsPerPage","detailsFiltered","autoOpenNextGroup"]),checkedDetailGroupsIntersect(){const t=new Set(this.paginatedDetails[this.page].map((t=>t.id))),e=new Set(this.checkedDetailGroups.map((t=>t.id))),i=new Set([...t].filter((t=>e.has(t))));return Array.from(i)}},watch:{itemsPerPage(t){this.page>=Math.ceil(this.details.length/t)&&(this.page=Math.ceil(this.details.length/t)-1)},details(t){this.page>=Math.ceil(t.length/this.itemsPerPage)&&(this.page=Math.ceil(t.length/this.itemsPerPage)-1)},sortGroups(){window.localStorage.setItem("mediadc_details_sort_groups",this.sortGroups),this.$store.dispatch("setSortGroups",this.sortGroups)}},beforeMount(){this.$emit("update:loading",!1);const t=window.localStorage.getItem("mediadc_details_sort_groups");this.sortGroups=null===t||!0===JSON.parse(t),this.$store.dispatch("setSortGroups",null===t||!0===JSON.parse(t)),(0,c.subscribe)("openNextDetailGroup",this.openNextDetailGroup)},beforeDestroy(){(0,c.unsubscribe)("openNextDetailGroup",this.openNextDetailGroup)},methods:{prevGroupsPage(){this.page>0?this.page-=1:(0,o.K2)(this.t("mediadc","First page reached!"))},nextGroupsPage(){this.page<Math.ceil(this.details.length/this.itemsPerPage)-1?this.page+=1:(0,o.K2)(this.t("mediadc","Last page reached!"))},toggleSorting(){this.$store.dispatch("setSorted",!this.sorted)},filterByGroupId(){null!==this.filterId&&""!==this.filterId?this.$store.dispatch("setDetailsFiltered",this.details.filter((t=>t.id.toString().includes(this.filterId)))):this.$store.dispatch("setDetailsFiltered",[])},openBatchActionsPopup(){document.addEventListener("click",this.toggleBatchActionsPopup)},toggleBatchActionsPopup(){this.batchActionsOpened&&document.removeEventListener("click",this.toggleBatchActionsPopup),this.batchActionsOpened=!this.batchActionsOpened},removeCheckedGroups(){s.default.post((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(this.task.id,"/details/remove")),{taskDetailIds:this.checkedDetailGroups.map((t=>t.id))}).then((t=>{if(t.data.success){(0,c.emit)("updateTaskInfo");const e=this.details;for(const i of t.data.removedTaskDetails){const t=this.checkedDetailGroups.findIndex((t=>t.id===i.id));this.checkedDetailGroups.splice(t,1);const n=e.findIndex((t=>t.id===i.id));e.splice(n,1)}this.$store.dispatch("setDetails",e),(0,o.s$)(this.t("mediadc","Selected groups successfully removed"))}})).catch((t=>{(0,o.x2)(this.t("mediadc","Some server error occured")),G.debug(t)}))},selectAllGroups(){if(this.checkedDetailGroups.length===this.details.length){(0,c.emit)("deselectGroups",this.checkedDetailGroups.map((t=>t.id)));for(const t of this.details){const e=this.checkedDetailGroups.findIndex((e=>e.id===t.id));-1!==e&&this.checkedDetailGroups.splice(e,1)}setTimeout((()=>{this.batchUpdating=!1}),300)}else for(const t of this.details){-1===this.checkedDetailGroups.findIndex((e=>e.id===t.id))&&this.checkedDetailGroups.push(t)}},selectAllGroupsOnPage(){if(this.paginatedDetails[this.page].length===this.checkedDetailGroupsIntersect.length){const t=this.checkedDetailGroupsIntersect;(0,c.emit)("deselectGroups",t);for(const e of t){const t=this.checkedDetailGroups.findIndex((t=>t.id===e.id));-1!==t&&this.checkedDetailGroups.splice(t,1)}}else for(const t of this.paginatedDetails[this.page]){-1===this.checkedDetailGroups.findIndex((e=>e.id===t.id))&&this.checkedDetailGroups.push(t)}},openNextDetailGroup(t){if(this.autoOpenNextGroup){const e=this.details.findIndex((e=>e.id===t.id));-1!==e&&(e!==this.details.length-1?(0,c.emit)("openGroup",this.details[e+1]):e===this.details.length-1&&this.details.length>=2&&(0,c.emit)("openGroup",this.details[e-1]))}}}};var N=n(23803),j={insert:"head",singleton:!1};m()(N.Z,j);N.Z.locals;const z=(0,v.Z)(T,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"task-details"},[i("div",{staticClass:"task-details-heading"},[i("h3",[t._v("\n\t\t\t"+t._s(t.t("mediadc","Duplicates list"))+"\n\t\t\t"),"finished"===t.getStatusBadge(t.task)?i("span",[t._v("\n\t\t\t\t- "+t._s(t.details.length)+" "+t._s(t.translatePlural("mediadc","group, ","groups",t.details.length))+"\n\t\t\t\t("+t._s(t.filestotal)+" "+t._s(t.translatePlural("mediadc","file","files",t.filestotal))+" - "+t._s(t.formatBytes(t.filessize))+")\n\t\t\t")]):t._e()]),t._v(" "),i("div",{staticClass:"pagination"},[i("CheckboxRadioSwitch",{staticStyle:{"margin-right":"20px"},attrs:{checked:t.sortGroups},on:{"update:checked":function(e){t.sortGroups=e}}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Sort groups"))+"\n\t\t\t")]),t._v(" "),i("span",{class:t.sorted?"icon-triangle-n toggle-sorting-button":"icon-triangle-s toggle-sorting-button",attrs:{title:t.t("mediadc","Sorting details by files count")},on:{click:t.toggleSorting}}),t._v(" "),t.details.length>t.itemsPerPage?i("span",{staticClass:"icon-view-previous pagination-button",on:{click:function(e){return t.prevGroupsPage()}}}):t._e(),t._v(" "),t.details.length>t.itemsPerPage?i("span",[t._v(t._s(t.t("mediadc","Page:"))+" ")]):t._e(),t._v(" "),t.details.length>t.itemsPerPage?i("span",[t._v(t._s(t.page+1)+"/"+t._s(Math.ceil(t.details.length/t.itemsPerPage)))]):t._e(),t._v(" "),t.details.length>t.itemsPerPage?i("span",{staticClass:"icon-view-next pagination-button",on:{click:function(e){return t.nextGroupsPage()}}}):t._e()],1)]),t._v(" "),t.details.length>0?i("div",[i("div",{staticClass:"filters"},[i("label",{attrs:{for:"group-id-filter"}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Filter by duplicate group id: "))+"\n\t\t\t\t"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filterId,expression:"filterId"}],attrs:{id:"group-id-filter",type:"search",name:"group-id-filter",placeholder:"#id"},domProps:{value:t.filterId},on:{input:[function(e){e.target.composing||(t.filterId=e.target.value)},t.filterByGroupId]}})]),t._v(" "),t.checkedDetailGroups.length>0?i("div",{staticClass:"batch-editing"},[t._v("\n\t\t\t\t"+t._s(t.translatePlural("mediadc","Batch actions for %n group","Batch actions for %n groups",t.checkedDetailGroups.length))+"\n\t\t\t\t"),i("div",{staticClass:"app-content-list-menu",staticStyle:{margin:"0 0 0 10px",position:"relative"}},[i("div",{staticClass:"icon-more batch-actions-menu-button",on:{click:t.openBatchActionsPopup}}),t._v(" "),i("div",{class:t.batchActionsOpened?"popovermenu open":"popovermenu",staticStyle:{right:"-1px"}},[i("ul",[i("li",[i("a",{staticClass:"icon-checkmark",on:{click:t.selectAllGroups}},[i("span",[t._v(t._s(t.checkedDetailGroups.length===t.details.length?t.t("mediadc","Deselect all"):t.t("mediadc","Select all")))])])]),t._v(" "),t.details.length>t.itemsPerPage?i("li",[i("a",{staticClass:"icon-checkmark",on:{click:t.selectAllGroupsOnPage}},[i("span",[t._v(t._s(t.checkedDetailGroupsIntersect.length===t.paginatedDetails[t.page].length?t.t("mediadc","Deselect all on page"):t.t("mediadc","Select all on page")))])])]):t._e(),t._v(" "),i("li",[i("a",{staticClass:"icon-close",on:{click:t.removeCheckedGroups}},[i("span",[t._v(t._s(t.translatePlural("mediadc","Remove group","Remove groups",t.checkedDetailGroups.length)))])])])])])])]):t._e()]),t._v(" "),t.batchUpdating?i("div",{staticClass:"action-blackout"},[i("span",{staticClass:"icon-loading"})]):void 0===t.detailsFiltered||0===t.detailsFiltered.length&&(""===t.filterId||null===t.filterId)?i("div",[t.sortGroups?t._l(t.paginatedSortedDetails[t.page],(function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:JSON.parse(e.group_files_ids).length>1,expression:"JSON.parse(detail.group_files_ids).length > 1"}],key:e.id,staticClass:"task-details-row"},[i("DetailsListItem",{attrs:{detail:e,"checked-detail-groups":t.checkedDetailGroups},on:{"update:checkedDetailGroups":function(e){t.checkedDetailGroups=e},"update:checked-detail-groups":function(e){t.checkedDetailGroups=e}}})],1)})):t._l(t.paginatedDetails[t.page],(function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:JSON.parse(e.group_files_ids).length>1,expression:"JSON.parse(detail.group_files_ids).length > 1"}],key:e.id,staticClass:"task-details-row"},[i("DetailsListItem",{attrs:{detail:e,"checked-detail-groups":t.checkedDetailGroups},on:{"update:checkedDetailGroups":function(e){t.checkedDetailGroups=e},"update:checked-detail-groups":function(e){t.checkedDetailGroups=e}}})],1)}))],2):t.detailsFiltered.length>0?i("div",t._l(t.detailsFiltered,(function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:JSON.parse(e.group_files_ids).length>1,expression:"JSON.parse(detail.group_files_ids).length > 1"}],key:e.id,staticClass:"task-details-row"},[i("DetailsListItem",{attrs:{detail:e,"checked-detail-groups":t.checkedDetailGroups},on:{"update:checkedDetailGroups":function(e){t.checkedDetailGroups=e},"update:checked-detail-groups":function(e){t.checkedDetailGroups=e}}})],1)})),0):i("div",[i("p",{staticStyle:{"text-align":"center","font-weight":"bold"}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","No matching found"))+"\n\t\t\t")])])]):i("div",{staticStyle:{"margin-top":"10px"}},[i("strong",[t._v(t._s(t.t("mediadc","No duplicates found.")))])])])}),[],!1,null,"6970fd5d",null).exports;var U=n(96679),O=n(88982);const M={name:"TasksEdit",props:{opened:{type:Boolean,required:!0}},data:()=>({targetDirectoriesPaths:{},targetDirectoriesIds:[],excludeDirectoriesPaths:[],excludeFileIds:{},targetMimeType:0,similarity_threshold:90,customExcludeList:[],customExcludeMask:"",addingCustomMask:!1,runningTask:!1}),computed:{...(0,a.Se)(["settings","settingByName","tasks","task","taskInfo"])},beforeMount(){this.similarity_threshold=void 0!==this.settingByName("similarity_threshold")?this.settingByName("similarity_threshold").value:90,this.targetMimeType=JSON.parse(this.task.collector_settings).target_mtype,this.similarity_threshold=JSON.parse(this.task.collector_settings).similarity_threshold,this.parseTaskSettings()},methods:{parseTaskSettings(){null!==this.taskInfo&&"target_directories"in this.taskInfo&&this.taskInfo.target_directories.forEach((t=>{this.targetDirectoriesIds.push(t.fileid.toString()),this.targetDirectoriesPaths[t.fileid.toString()]=""!==t.filepath.replace("/".concat((0,r.getCurrentUser)().uid,"/files"),"")?t.filepath.replace("/".concat((0,r.getCurrentUser)().uid,"/files"),""):"/"})),null!==this.taskInfo&&"exclude_directories"in this.taskInfo&&(this.taskInfo.exclude_directories.forEach((t=>{this.excludeDirectoriesPaths.push(t.filepath.replace()),this.excludeFileIds[t.fileid.toString()]=t.filepath.replace("/".concat((0,r.getCurrentUser)().uid,"/files"),"")})),this.customExcludeList=JSON.parse(this.task.exclude_list).user.mask)},getDirectoriesPicker:t=>(0,o.fn)(t).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").setModal(!0).setType(1).allowDirectories(!0).build(),getFilesPicker:t=>(0,o.fn)(t).setMultiSelect(!1).setModal(!0).setType(1).allowDirectories(!0).build(),openDirectoriesExplorer(){this.getDirectoriesPicker(this.t("mediadc","Choose target directory")).pick().then((t=>{t.startsWith("/")?(0,O.zW)(t).then((e=>{const i=(0,O.WU)(e.data);-1!==i&&(i in this.targetDirectoriesPaths?(0,o.K2)(this.t("mediadc","This directory already selected")):(this.targetDirectoriesIds.push(i),this.targetDirectoriesPaths[i.toString()]=t))})):((0,O.zW)("/").then((t=>{const e=(0,O.WU)(t.data);-1!==e&&(e in this.targetDirectoriesPaths?(0,o.K2)(this.t("mediadc","This directory already selected")):(this.targetDirectoriesIds.push(e),this.targetDirectoriesPaths[e.toString()]="/"))})),this.targetDirectoriesPaths.push("/"))}))},openExcludeExplorer(){this.getDirectoriesPicker(this.t("mediadc","Choose directory to exclude")).pick().then((t=>{-1===Object.values(this.excludeFileIds).findIndex((e=>e===t))?t.startsWith("/")?(0,O.zW)(t).then((e=>{const i=(0,O.WU)(e.data);-1!==i&&(this.excludeDirectoriesPaths.push(t),this.excludeFileIds[i.toString()]=t)})):(0,O.zW)("/").then((e=>{const i=(0,O.WU)(e.data);-1!==i&&(this.excludeDirectoriesPaths.push(t),this.excludeFileIds[i.toString()]="/")})):(0,o.K2)(this.t("mediadc","This directory already excluded"))}))},restartTask(){this.runningTask=!0,this.getSettings().then((e=>{this.$store.dispatch("setSettings",e.data),s.default.post((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/restart"),{taskId:this.task.id,targetDirectoryIds:JSON.stringify(this.targetDirectoriesIds),excludeList:{user:{mask:this.customExcludeList,fileid:Object.keys(this.excludeFileIds).map((t=>Number(t)))},admin:JSON.parse(this.settingByName("exclude_list").value)||{mask:[],fileid:[]}},collectorSettings:{hashing_algorithm:JSON.parse(this.settingByName("hashing_algorithm").value)||"dhash",similarity_threshold:Number(this.similarity_threshold),hash_size:Number(this.settingByName("hash_size").value)||16,target_mtype:this.targetMimeType}}).then((e=>{this.runningTask=!1,e.data.success?(this.runningTask=!1,this.closeEditTaskDialog(),(0,c.emit)("restartTask"),(0,o.s$)(this.t("mediadc","Task successfully restarted!"))):e.data.limit?(0,o.K2)(this.t("mediadc","Running tasks limit exceed. Try again later.")):e.data.empty?(0,o.K2)(this.translatePlural("mediadc","Target folder has no files or all of them excluded","Target folders have no files or all of them excluded",this.targetDirectoriesIds.length)):(0,o.K2)(t("medaidc","Some error occured while running Collector Task. Try again."))}))}))},removeTargetDirectory(t){delete this.targetDirectoriesPaths[t];const e=this.targetDirectoriesIds.findIndex((e=>e===t));this.targetDirectoriesIds.splice(e,1)},removeExcludeDirectory(t){if(t in this.excludeFileIds){const e=this.excludeDirectoriesPaths.findIndex((e=>e===this.excludeFileIds[t]));this.excludeDirectoriesPaths.splice(e,1),delete this.excludeFileIds[t]}},removeExcludeFileid(t){delete this.excludeFileIds[t]},addNewMask(){this.addingCustomMask=!0,setTimeout((()=>{this.$refs.customExcludeMask.focus()}),100)},addCustomMask(){this.customExcludeMask.length>0?-1===this.customExcludeList.findIndex((t=>t===this.customExcludeMask))?(this.customExcludeList.push(this.customExcludeMask),this.customExcludeMask="",this.addingCustomMask=!1):(0,o.K2)(this.t("mediadc","This mask already exists!")):(0,o.K2)(this.t("mediadc","Enter custom mask!"))},cancelAddingCustomMask(){this.customExcludeMask="",this.addingCustomMask=!1},deleteCustomMask(t){const e=this.customExcludeList.findIndex((e=>e===t));this.customExcludeList.splice(e,1)},async getTasks(){s.default.get((0,d.generateUrl)("/apps/mediadc/api/v1/tasks")).then((t=>{this.$store.dispatch("setTasks",t.data),this.$emit("update:loading",!1)}))},resetForm(){this.targetDirectoriesPaths={},this.targetDirectoriesIds=[],this.excludeDirectoriesNames=[],this.excludeFileIds={},this.targetMimeType=0,this.similarity_threshold=void 0!==this.settingByName("similarity_threshold")?this.settingByName("similarity_threshold").value:90,this.customExcludeList=[],this.runningTask=!1},closeEditTaskDialog(){this.$emit("update:opened",!1)},getSettings:async()=>s.default.get((0,d.generateUrl)("/apps/mediadc/api/v1/settings"))}};var $=n(98025),L={insert:"head",singleton:!1};m()($.Z,L);$.Z.locals;const R=(0,v.Z)(M,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.opened,expression:"opened"}],staticClass:"blackout"},[i("div",{staticClass:"edit-task-block"},[i("span",{staticClass:"icon-close close-edit-button",on:{click:t.closeEditTaskDialog}}),t._v(" "),i("h2",[t._v(t._s(t.t("mediadc","Edit task")))]),t._v(" "),i("div",{staticClass:"selection-container"},[i("div",{staticClass:"block target-directories-block"},[i("h3",[t._v(t._s(t.t("mediadc","Target directories")))]),t._v(" "),t.targetDirectoriesIds.length>0?i("div",t._l(t.targetDirectoriesIds,(function(e){return i("div",{key:e,staticClass:"selected-target-directories-list"},[i("div",{staticClass:"target-directory"},[i("span",{staticStyle:{"overflow-y":"scroll","white-space":"nowrap"}},[t._v(t._s(t.targetDirectoriesPaths[e]))]),t._v(" "),i("span",{staticClass:"delete-button icon-delete",on:{click:function(i){return t.removeTargetDirectory(e)}}})])])})),0):i("div",[i("span",[t._v(t._s(t.t("mediadc","Not selected")))])]),t._v(" "),i("br"),t._v(" "),i("button",{on:{click:t.openDirectoriesExplorer}},[i("span",{staticClass:"icon-add"}),t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Select"))+"\n\t\t\t\t")])]),t._v(" "),i("div",{staticClass:"block"},[i("h3",[t._v(t._s(t.t("mediadc","Exclude directories")))]),t._v(" "),t.excludeDirectoriesPaths.length>0?i("div",t._l(Object.keys(t.excludeFileIds),(function(e){return i("div",{key:e,staticClass:"selected-excluded-directories-list"},[i("div",{staticClass:"target-directory"},[i("span",{staticStyle:{"overflow-y":"scroll"}},[t._v(t._s(t.excludeFileIds[e]))]),t._v(" "),i("span",{staticClass:"delete-button icon-delete",on:{click:function(i){return t.removeExcludeDirectory(e)}}})])])})),0):i("div",[i("span",[t._v(t._s(t.t("mediadc","Not selected")))])]),t._v(" "),i("br"),t._v(" "),i("button",{on:{click:t.openExcludeExplorer}},[i("span",{staticClass:"icon-add"}),t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Select"))+"\n\t\t\t\t")])])]),t._v(" "),i("div",{staticClass:"selection-container"},[i("div",{staticClass:"block"},[i("h3",[t._v(t._s(t.t("mediadc","Custom exclude mask")))]),t._v(" "),t.customExcludeList.length>0?i("div",{staticClass:"custom-masks-list"},t._l(t.customExcludeList,(function(e,n){return i("div",{key:n,staticClass:"custom-mask"},[i("span",[t._v(t._s(e))]),t._v(" "),i("span",{staticClass:"icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.deleteCustomMask(e)}}})])})),0):i("div",[i("span",[t._v(t._s(t.t("mediadc","Not added")))])]),t._v(" "),t.addingCustomMask?i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.customExcludeMask,expression:"customExcludeMask"}],ref:"customExcludeMask",attrs:{id:"custom-exclude-mask",type:"text"},domProps:{value:t.customExcludeMask},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addCustomMask.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancelAddingCustomMask.apply(null,arguments)}],input:function(e){e.target.composing||(t.customExcludeMask=e.target.value)}}}),t._v(" "),i("span",{staticClass:"icon-checkmark",staticStyle:{width:"18px",height:"18px",margin:"0 5px",display:"inline-block",cursor:"pointer"},on:{click:t.addCustomMask}}),t._v(" "),i("span",{staticClass:"icon-close",staticStyle:{width:"18px",height:"18px",margin:"0 5px",display:"inline-block",cursor:"pointer"},on:{click:t.cancelAddingCustomMask}})]):t._e(),t._v(" "),i("div",{staticStyle:{display:"flex","align-items":"center",margin:"20px 0"}},[i("button",{on:{click:t.addNewMask}},[i("span",{staticClass:"icon-add"}),t._v(" "),i("span",[t._v(t._s(t.t("mediadc","Add mask")))])])])]),t._v(" "),i("div",{staticClass:"block"},[i("h3",{staticStyle:{margin:"5px 0"}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Target Mime Type"))+"\n\t\t\t\t")]),t._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.targetMimeType,expression:"targetMimeType"}],attrs:{id:"target_mtype",name:"target_mtype"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.targetMimeType=e.target.multiple?i:i[0]}}},[i("option",{domProps:{value:0}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Photos"))+"\n\t\t\t\t\t")]),t._v(" "),i("option",{domProps:{value:1}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Videos"))+"\n\t\t\t\t\t")]),t._v(" "),i("option",{domProps:{value:2}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Photos and Videos"))+"\n\t\t\t\t\t")])]),t._v(" "),i("h3",{staticStyle:{margin:"5px 0"}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Similarity threshold"))+"\n\t\t\t\t")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.similarity_threshold,expression:"similarity_threshold"}],staticStyle:{margin:"0 0 10px"},attrs:{type:"number",min:"50",max:"100"},domProps:{value:t.similarity_threshold},on:{input:function(e){e.target.composing||(t.similarity_threshold=e.target.value)}}})])]),t._v(" "),t.runningTask?i("button",{attrs:{disabled:""}},[i("span",{staticClass:"icon-loading"})]):i("button",{staticStyle:{margin:"10px 5px 0"},attrs:{disabled:0===Object.keys(t.targetDirectoriesPaths).length},on:{click:t.restartTask}},[t._v("\n\t\t\t"+t._s(t.t("mediadc","Restart task"))+"\n\t\t")])])])}),[],!1,null,"17c25fb8",null).exports;var W=n(25108);const Y={name:"CollectorDetails",components:{DetailsList:z,TasksEdit:R},mixins:[l.Z,U.Z],props:{rootTitle:{type:String,required:!0},loading:{type:Boolean,required:!0}},data:()=>({updater:null,statsUpdater:null,filessize:0,filestotal:0,actionsOpened:!1,collapsedStatus:!1,editingTask:!1}),computed:{...(0,a.Se)(["task","taskInfo","details","settingByName"]),isValidUser(){return(0,r.getCurrentUser)().uid===this.task.owner},currentUser:()=>(0,r.getCurrentUser)().uid},beforeMount(){this.$emit("update:loading",!0),this.getTaskDetails(),this.getTaskInfo(),(0,c.subscribe)("restartTask",this.onRestartTaskEvent),(0,c.subscribe)("updateTaskInfo",this.getDetailFilesTotalSize),this.updater=setInterval(this.getTaskDetails,5e3)},beforeDestroy(){clearInterval(this.updater),(0,c.unsubscribe)("updateTaskInfo",this.getTaskInfo),(0,c.unsubscribe)("restartTask",this.onRestartTaskEvent)},methods:{terminateTask(t){this.toggleActionsPopup(),this.isValidUser?(this.terminating=!0,s.default.post((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t.id,"/terminate"))).then((t=>{(0,o.s$)(this.t("mediadc","Task terminated")),this.terminating=!1,this.getTaskDetails()}))):(0,o.K2)(this.t("mediadc","You are not allowed to terminate this task"))},restartTask(t){this.toggleActionsPopup(),this.isValidUser?(this.restarting=!0,this.getSettings().then((()=>{s.default.post((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/restart"),{taskId:t.id,targetDirectoryIds:t.target_directory_ids,excludeList:{user:JSON.parse(t.exclude_list).user,admin:JSON.parse(this.settingByName("exclude_list").value)},collectorSettings:{hashing_algorithm:JSON.parse(this.settingByName("hashing_algorithm").value)||"dhash",similarity_threshold:Number(JSON.parse(this.task.collector_settings).similarity_threshold),hash_size:Number(this.settingByName("hash_size").value)||16,target_mtype:Number(JSON.parse(this.task.collector_settings).target_mtype)}}).then((t=>{this.restarting=!1,t.data.success?((0,o.s$)(this.t("mediadc","Task successfully restarted with previous settings!")),this.getTaskDetails(),this.filessize=0,this.filestotal=0):t.data.limit?(0,o.K2)(this.t("mediadc","Running tasks limit exceed. Try again later.")):(0,o.K2)(this.t("medaidc","Some error occured while running Collector Task. Try again."))})).catch((t=>{this.restarting=!1,W.debug(t),(0,o.x2)("Some error occured while running Collector Task. Try again.")}))}))):(0,o.K2)(this.t("mediadc","You are not allowed to restart this task"))},deleteTask(t){this.toggleActionsPopup(),this.isValidUser?confirm(this.t("mediadc","Are sure, you want delete this task?"))&&(this.deleting=!0,s.default.delete((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(t.id))).then((t=>{this.$router.push({name:"collector"}),(0,o.s$)(this.t("mediadc","Task successfully deleted")),this.deleting=!1}))):(0,o.K2)(this.t("mediadc","You are not allowed to delete this task"))},async getTaskDetails(){s.default.get((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(this.$route.params.taskId))).then((t=>{"success"in t.data&&t.data.success&&(this.$store.dispatch("setTask",t.data.collectorTask),this.$store.dispatch("setDetails",t.data.collectorTaskDetails),"finished"===this.getStatusBadge(this.task)&&0===this.filestotal&&0===this.filessize&&this.getDetailFilesTotalSize()),this.$emit("update:loading",!1)}))},async getTaskInfo(){s.default.get((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(this.$route.params.taskId,"/info"))).then((t=>{this.$store.dispatch("setTaskInfo",t.data.collectorTaskInfo)}))},async getDetailFilesTotalSize(){s.default.get((0,d.generateUrl)("/apps/mediadc/api/v1/tasks/".concat(this.$route.params.taskId,"/filestotal"))).then((t=>{this.filessize=t.data.filessize,this.filestotal=t.data.filestotal}))},openActionsPopup(){document.addEventListener("click",this.toggleActionsPopup)},toggleActionsPopup(){this.actionsOpened&&document.removeEventListener("click",this.toggleActionsPopup),this.actionsOpened=!this.actionsOpened},collapseTaskStatus(){this.collapsedStatus=!this.collapsedStatus},openEditTaskDialog(){this.editingTask=!0},filesDirLink(t){if(t){const e=""!==t.filepath.replace("/".concat(t.fileowner,"/files"),"").replace("/".concat(this.currentUser,"/files"),"")?t.filepath.replace("/".concat(t.fileowner,"/files"),"").replace("/".concat(this.currentUser,"/files"),""):"/";return(0,d.generateUrl)("/apps/files?dir=".concat(e))}return"#"},onRestartTaskEvent(){this.getTaskInfo(),this.getTaskDetails(),this.filessize=0,this.filestotal=0}}};var J=n(46583),q={insert:"head",singleton:!1};m()(J.Z,q);J.Z.locals;const Z=(0,v.Z)(Y,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.loading?t._e():i("div",{staticClass:"container"},[t.editingTask?i("TasksEdit",{attrs:{opened:t.editingTask},on:{"update:opened":function(e){t.editingTask=e}}}):t._e(),t._v(" "),i("div",{staticClass:"task-details"},[i("div",{staticClass:"task-details-heading"},[i("h2",[t._v("\n\t\t\t\t"+t._s(t.rootTitle)+"\n\t\t\t\t"),t.isValidUser?i("span",{class:t.collapsedStatus?"icon-triangle-s collapse-task-status-btn":"icon-triangle-n collapse-task-status-btn",attrs:{title:t.t("mediadc","Collapse task status")},on:{click:t.collapseTaskStatus}}):t._e()]),t._v(" "),t.isValidUser?i("div",{directives:[{name:"show",rawName:"v-show",value:!t.collapsedStatus,expression:"!collapsedStatus"}],staticClass:"task-details-description"},[i("p",[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Here you can view task details, manage task (stop or restart), delete found duplicated photos and videos."))+"\n\t\t\t\t")]),t._v(" "),i("p",[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Deleted files are placed in the trashbin, so that they can be restored in case of need."))+"\n\t\t\t\t")])]):t._e()]),t._v(" "),t.isValidUser?i("div",{directives:[{name:"show",rawName:"v-show",value:!t.collapsedStatus,expression:"!collapsedStatus"}],staticClass:"task-status-row"},[i("div",{staticClass:"task-status"},[i("span",{class:"badge "+t.getStatusBadge(t.task)},[t._v(t._s(t.getStatusBadge(t.task)))]),t._v(" "),i("div",{staticStyle:{display:"flex","flex-direction":"column"}},[i("span",[i("b",[t._v(t._s(t.parseTargetMtype(t.task)))]),t._v(" "+t._s(t.task.files_scanned!==t.task.files_total?t.task.files_scanned+"/":"")+t._s(t.task.files_total)+" "+t._s(t.translatePlural("mediadc","file","files",t.task.files_total))+"\n\t\t\t\t\t\t("+t._s(t.formatBytes(Number(t.task.files_total_size)))+")\n\t\t\t\t\t\t("+t._s(null!==t.task&&"collector_settings"in t.task?t.t("mediadc","precision: ")+JSON.parse(t.task.collector_settings).similarity_threshold+"%":"")+")\n\t\t\t\t\t\t"),i("br"),t._v(" "),i("b",[t._v(t._s(t.t("mediadc","Deleted: "))+" ")]),t._v("\n\t\t\t\t\t\t"+t._s(t.task.deleted_files_count)+" "+t._s(t.translatePlural("mediadc","file","files",t.task.deleted_files_count))+"\n\t\t\t\t\t\t("+t._s(t.formatBytes(Number(t.task.deleted_files_size)))+")\n\t\t\t\t\t")]),t._v(" "),i("span",[t._v("\n\t\t\t\t\t\t"+t._s(t.parseUnixTimestamp(t.task.created_time))+"\n\t\t\t\t\t\t"+t._s(Number(t.task.finished_time)>0?" - "+t.parseUnixTimestamp(t.task.finished_time):"")+"\n\t\t\t\t\t")])]),t._v(" "),i("div",{staticClass:"app-content-list-menu",staticStyle:{margin:"0 0 0 10px",position:"relative"}},[i("div",{staticClass:"icon-more actions-menu-button",on:{click:t.openActionsPopup}}),t._v(" "),i("div",{class:t.actionsOpened?"popovermenu open":"popovermenu",staticStyle:{right:"-1px"}},[i("ul",[i("li",[i("a",{staticClass:"icon-history",on:{click:function(e){return t.restartTask(t.task)}}},[i("span",[t._v(t._s(t.t("mediadc","Restart")))])])]),t._v(" "),i("li",[i("a",{staticClass:"icon-rename",on:{click:function(e){return t.openEditTaskDialog(t.task)}}},[i("span",[t._v(t._s(t.t("mediadc","Edit")))])])]),t._v(" "),i("li",[i("a",{staticClass:"icon-pause",on:{click:function(e){return t.terminateTask(t.task)}}},[i("span",[t._v(t._s(t.t("mediadc","Stop")))])])]),t._v(" "),i("li",[i("a",{staticClass:"icon-delete",on:{click:function(e){return t.deleteTask(t.task)}}},[i("span",[t._v(t._s(t.t("mediadc","Delete")))])])])])])])]),t._v(" "),i("div",{staticClass:"task-info"},[i("h3",[t._v(t._s(t.t("mediadc","Target directories")))]),t._v(" "),i("div",{staticClass:"target-directories-list"},t._l(t.taskInfo.target_directories,(function(e){return i("div",{key:e.fileid,staticClass:"target-directory-row"},[i("div",{staticClass:"owner-tooltip"},[i("div",{staticClass:"tooltip-title"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.t("mediadc","onwer:"))+" "+t._s(e.fileowner)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"tooltip-content"},[i("a",{attrs:{href:t.filesDirLink(e),target:"_blank"}},[i("b",[t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(""!==e.filepath.replace("/"+e.fileowner+"/files","").replace("/"+t.currentUser+"/files","")?e.filepath.replace("/"+e.fileowner+"/files","").replace("/"+t.currentUser+"/files",""):"/")+"\n\t\t\t\t\t\t\t\t\t")]),t._v("\n\t\t\t\t\t\t\t\t\t("+t._s(t.formatBytes(e.filesize))+")\n\t\t\t\t\t\t\t\t")])])])])})),0)])]):t._e(),t._v(" "),t.isValidUser?i("div",{staticClass:"details-row"},["finished"===t.getStatusBadge(t.task)?i("DetailsList",{attrs:{filessize:t.filessize,filestotal:t.filestotal}}):t._e()],1):i("div",[i("p",{staticStyle:{"text-align":"center"}},[i("b",[t._v(t._s(t.t("mediadc","You are not allowed to manage other user's tasks.")))])])]),t._v(" "),void 0!==t.task.errors&&t.task.errors.length>0?i("div",{staticClass:"errors"},[i("h3",[t._v(t._s(t.t("mediadc","Task errors")))]),t._v(" "),t._l(t.task.errors.split("\\n"),(function(e){return i("div",{key:e,staticClass:"error-row"},[t._v("\n\t\t\t\t"+t._s(e)+"\n\t\t\t")])}))],2):t._e()])],1)}),[],!1,null,"855bf63a",null).exports}}]);
//# sourceMappingURL=mediadc-node_modules_moment_locale_sync_recursive_-src_views_CollectorDetails_vue.js.map?v=4974e06fbb0b0b6c2ffb